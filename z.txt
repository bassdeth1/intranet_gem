Listado del proyecto en: /workspaces/intranet_gem
Generado el: 2025-05-15 19:42:43
============================================

â”œâ”€â”€ README.md
â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (README.md):
â”‚     # intranet_gem
â”‚   --- FIN CONTENIDO (README.md) ---

â”œâ”€â”€ intranet_core
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   ðŸ“„ (Archivo vacÃ­o)

â”‚   â”œâ”€â”€ admin.py
â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (admin.py):
â”‚   â”‚     # UbicaciÃ³n: /workspaces/intranet_gem/intranet_core/admin.py
â”‚   â”‚     from django.contrib import admin
â”‚   â”‚     from .models import Archivo, Carpeta, ArticuloWiki, Notificacion # AÃ±adir ArticuloWiki y Notificacion
â”‚   â”‚     
â”‚   â”‚     @admin.register(Archivo)
â”‚   â”‚     class ArchivoAdmin(admin.ModelAdmin):
â”‚   â”‚         list_display = ('nombre_descriptivo', 'nombre_original_archivo', 'fecha_subida', 'subido_por', 'carpeta')
â”‚   â”‚         list_filter = ('fecha_subida', 'subido_por', 'carpeta')
â”‚   â”‚         search_fields = ('nombre_descriptivo', 'nombre_original_archivo', 'subido_por__username', 'carpeta__nombre')
â”‚   â”‚         readonly_fields = ('fecha_subida',) # 'nombre_original_archivo' si se setea siempre en save
â”‚   â”‚     
â”‚   â”‚         def save_model(self, request, obj, form, change):
â”‚   â”‚             if not obj.subido_por_id:
â”‚   â”‚                 obj.subido_por = request.user
â”‚   â”‚             # Para setear nombre_original_archivo si no se hizo en la vista/form al crear/editar
â”‚   â”‚             if obj.archivo_subido and not obj.nombre_original_archivo:
â”‚   â”‚                  obj.nombre_original_archivo = obj.archivo_subido.name
â”‚   â”‚             super().save_model(request, obj, form, change)
â”‚   â”‚     
â”‚   â”‚     @admin.register(Carpeta)
â”‚   â”‚     class CarpetaAdmin(admin.ModelAdmin):
â”‚   â”‚         list_display = ('nombre', 'subido_por', 'fecha_creacion')
â”‚   â”‚         list_filter = ('fecha_creacion', 'subido_por')
â”‚   â”‚         search_fields = ('nombre', 'subido_por__username')
â”‚   â”‚         readonly_fields = ('fecha_creacion',)
â”‚   â”‚     
â”‚   â”‚     @admin.register(ArticuloWiki)
â”‚   â”‚     class ArticuloWikiAdmin(admin.ModelAdmin):
â”‚   â”‚         list_display = ('titulo', 'autor', 'actualizado_el', 'creado_el', 'slug')
â”‚   â”‚         search_fields = ('titulo', 'contenido', 'autor__username')
â”‚   â”‚         prepopulated_fields = {'slug': ('titulo',)}
â”‚   â”‚         list_filter = ('actualizado_el', 'creado_el', 'autor')
â”‚   â”‚         readonly_fields = ('creado_el', 'actualizado_el')
â”‚   â”‚     
â”‚   â”‚         def save_model(self, request, obj, form, change):
â”‚   â”‚             if not change and not obj.autor_id and request.user.is_authenticated: # Solo al crear y si no tiene autor
â”‚   â”‚                 obj.autor = request.user
â”‚   â”‚             super().save_model(request, obj, form, change)
â”‚   â”‚     
â”‚   â”‚     @admin.register(Notificacion)
â”‚   â”‚     class NotificacionAdmin(admin.ModelAdmin):
â”‚   â”‚         list_display = ('destinatario', 'mensaje_corto', 'leida', 'fecha_creacion', 'url_destino')
â”‚   â”‚         list_filter = ('leida', 'fecha_creacion', 'destinatario')
â”‚   â”‚         search_fields = ('destinatario__username', 'mensaje')
â”‚   â”‚         readonly_fields = ('fecha_creacion',)
â”‚   â”‚         actions = ['marcar_como_leida', 'marcar_como_no_leida']
â”‚   â”‚     
â”‚   â”‚         def mensaje_corto(self, obj):
â”‚   â”‚             return (obj.mensaje[:75] + '...') if len(obj.mensaje) > 75 else obj.mensaje
â”‚   â”‚         mensaje_corto.short_description = 'Mensaje'
â”‚   â”‚     
â”‚   â”‚         def marcar_como_leida(self, request, queryset):
â”‚   â”‚             queryset.update(leida=True)
â”‚   â”‚         marcar_como_leida.short_description = "Marcar seleccionadas como leÃ­das"
â”‚   â”‚     
â”‚   â”‚         def marcar_como_no_leida(self, request, queryset):
â”‚   â”‚             queryset.update(leida=False)
â”‚   â”‚         marcar_como_no_leida.short_description = "Marcar seleccionadas como no leÃ­das"
â”‚   â”‚   --- FIN CONTENIDO (admin.py) ---

â”‚   â”œâ”€â”€ apps.py
â”‚   â”‚   ðŸ“„ (Archivo vacÃ­o)

â”‚   â”œâ”€â”€ forms.py
â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (forms.py):
â”‚   â”‚     # intranet_core/forms.py
â”‚   â”‚     from django import forms
â”‚   â”‚     from django.contrib.auth.models import User, Group
â”‚   â”‚     from django.contrib.auth.forms import PasswordChangeForm
â”‚   â”‚     
â”‚   â”‚     from .models import (
â”‚   â”‚         Archivo, Carpeta, ArticuloWiki,
â”‚   â”‚         Formulario, CampoFormulario, # Modelos de Formularios
â”‚   â”‚         EventoCalendario, # Modelo de Calendario
â”‚   â”‚         Tarea, # Modelo de Tareas/Responsabilidades
â”‚   â”‚         PerfilUsuario, # Modelo de Perfil
â”‚   â”‚         TipoRecurso, Recurso, Reserva # Modelos de Reservas
â”‚   â”‚     )
â”‚   â”‚     
â”‚   â”‚     # Clases CSS comunes para los widgets de formulario para mantener la consistencia
â”‚   â”‚     COMMON_TEXT_INPUT_CLASSES = 'mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 shadow-sm focus:border-main-primary focus:ring-main-primary sm:text-sm'
â”‚   â”‚     COMMON_TEXTAREA_CLASSES = COMMON_TEXT_INPUT_CLASSES + ' min-h-[100px]' # AÃ±adir altura mÃ­nima
â”‚   â”‚     COMMON_SELECT_CLASSES = COMMON_TEXT_INPUT_CLASSES
â”‚   â”‚     COMMON_FILE_INPUT_CLASSES = 'mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-main-primary file:text-main-white hover:file:bg-main-primary-dark dark:file:bg-main-primary-dark dark:hover:file:bg-main-primary'
â”‚   â”‚     COMMON_CHECKBOX_CLASSES = 'h-4 w-4 text-main-primary border-gray-300 dark:border-gray-600 rounded focus:ring-main-primary'
â”‚   â”‚     
â”‚   â”‚     
â”‚   â”‚     # --- Formularios Existentes ---
â”‚   â”‚     
â”‚   â”‚     class CarpetaForm(forms.ModelForm):
â”‚   â”‚         class Meta:
â”‚   â”‚             model = Carpeta
â”‚   â”‚             fields = ['nombre']
â”‚   â”‚             widgets = {
â”‚   â”‚                 'nombre': forms.TextInput(attrs={
â”‚   â”‚                     'class': COMMON_TEXT_INPUT_CLASSES,
â”‚   â”‚                     'placeholder': 'Nombre de la nueva carpeta'
â”‚   â”‚                 })
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'nombre': 'Nombre de la Carpeta'
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚     class ArchivoForm(forms.ModelForm):
â”‚   â”‚         def __init__(self, *args, **kwargs):
â”‚   â”‚             user = kwargs.pop('user', None)
â”‚   â”‚             super().__init__(*args, **kwargs)
â”‚   â”‚             if user:
â”‚   â”‚                 # Solo mostrar carpetas creadas por el usuario actual
â”‚   â”‚                 self.fields['carpeta'].queryset = Carpeta.objects.filter(subido_por=user).order_by('nombre')
â”‚   â”‚                 self.fields['carpeta'].empty_label = "RaÃ­z (sin carpeta)" # Opcional: o "Seleccione una carpeta..."
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             model = Archivo
â”‚   â”‚             fields = ['nombre_descriptivo', 'archivo_subido', 'carpeta']
â”‚   â”‚             widgets = {
â”‚   â”‚                 'nombre_descriptivo': forms.TextInput(attrs={
â”‚   â”‚                     'class': COMMON_TEXT_INPUT_CLASSES,
â”‚   â”‚                     'placeholder': 'TÃ­tulo o descripciÃ³n breve del archivo'
â”‚   â”‚                 }),
â”‚   â”‚                 'archivo_subido': forms.ClearableFileInput(attrs={
â”‚   â”‚                     'class': COMMON_FILE_INPUT_CLASSES
â”‚   â”‚                 }),
â”‚   â”‚                 'carpeta': forms.Select(attrs={
â”‚   â”‚                     'class': COMMON_SELECT_CLASSES,
â”‚   â”‚                 })
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'nombre_descriptivo': 'Nombre Descriptivo',
â”‚   â”‚                 'archivo_subido': 'Archivo',
â”‚   â”‚                 'carpeta': 'Guardar en Carpeta'
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚     class ArchivoEditForm(forms.ModelForm):
â”‚   â”‚         def __init__(self, *args, **kwargs):
â”‚   â”‚             user = kwargs.pop('user', None)
â”‚   â”‚             super().__init__(*args, **kwargs)
â”‚   â”‚             if user:
â”‚   â”‚                 self.fields['carpeta'].queryset = Carpeta.objects.filter(subido_por=user).order_by('nombre')
â”‚   â”‚                 self.fields['carpeta'].empty_label = "RaÃ­z (sin carpeta)"
â”‚   â”‚             # Hacer el campo de archivo no obligatorio para la ediciÃ³n (se puede editar solo el nombre/carpeta)
â”‚   â”‚             self.fields['archivo_subido'].required = False
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             model = Archivo
â”‚   â”‚             fields = ['nombre_descriptivo', 'carpeta', 'archivo_subido'] # El orden puede ser importante
â”‚   â”‚             widgets = {
â”‚   â”‚                 'nombre_descriptivo': forms.TextInput(attrs={
â”‚   â”‚                     'class': COMMON_TEXT_INPUT_CLASSES,
â”‚   â”‚                 }),
â”‚   â”‚                 'carpeta': forms.Select(attrs={
â”‚   â”‚                     'class': COMMON_SELECT_CLASSES,
â”‚   â”‚                 }),
â”‚   â”‚                 'archivo_subido': forms.ClearableFileInput(attrs={ # Permite limpiar el archivo actual o subir uno nuevo
â”‚   â”‚                     'class': COMMON_FILE_INPUT_CLASSES
â”‚   â”‚                 }),
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'nombre_descriptivo': 'Nombre Descriptivo',
â”‚   â”‚                 'carpeta': 'Carpeta',
â”‚   â”‚                 'archivo_subido': 'Reemplazar Archivo (opcional)'
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚     class ArticuloWikiForm(forms.ModelForm):
â”‚   â”‚         class Meta:
â”‚   â”‚             model = ArticuloWiki
â”‚   â”‚             fields = ['titulo', 'contenido', 'slug'] # Autor se setea en la vista
â”‚   â”‚             widgets = {
â”‚   â”‚                 'titulo': forms.TextInput(attrs={
â”‚   â”‚                     'class': COMMON_TEXT_INPUT_CLASSES,
â”‚   â”‚                     'placeholder': 'TÃ­tulo del artÃ­culo'
â”‚   â”‚                 }),
â”‚   â”‚                 'contenido': forms.Textarea(attrs={
â”‚   â”‚                     'class': COMMON_TEXTAREA_CLASSES,
â”‚   â”‚                     'rows': 15,
â”‚   â”‚                     'placeholder': 'Escribe el contenido del artÃ­culo aquÃ­. Se recomienda usar Markdown.'
â”‚   â”‚                 }),
â”‚   â”‚                 'slug': forms.TextInput(attrs={
â”‚   â”‚                     'class': COMMON_TEXT_INPUT_CLASSES,
â”‚   â”‚                     'placeholder': 'URL amigable (ej: como-usar-la-wiki)'
â”‚   â”‚                 }),
â”‚   â”‚             }
â”‚   â”‚             help_texts = {
â”‚   â”‚                 'slug': 'Dejar en blanco para autogenerar basado en el tÃ­tulo. Usa solo letras, nÃºmeros, guiones o guiones bajos. Si lo modificas, asegÃºrate que sea Ãºnico.',
â”‚   â”‚                 'contenido': 'Puedes usar sintaxis Markdown para dar formato al texto (encabezados, listas, negritas, etc.). Se recomienda instalar Pygments (`pip install Pygments`) para el resaltado de cÃ³digo.'
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'titulo': 'TÃ­tulo del ArtÃ­culo',
â”‚   â”‚                 'contenido': 'Contenido (Markdown)',
â”‚   â”‚                 'slug': 'Fragmento de URL (Slug)'
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚         def clean_slug(self):
â”‚   â”‚             slug = self.cleaned_data.get('slug')
â”‚   â”‚             if slug:
â”‚   â”‚                 from django.utils.text import slugify as django_slugify
â”‚   â”‚                 if not django_slugify(slug) == slug:
â”‚   â”‚                     raise forms.ValidationError("El slug solo puede contener letras, nÃºmeros, guiones y guiones bajos.")
â”‚   â”‚             return slug
â”‚   â”‚     
â”‚   â”‚     # --- Nuevos Formularios ---
â”‚   â”‚     
â”‚   â”‚     # 1. Formularios para el MÃ³dulo de "Formularios DinÃ¡micos"
â”‚   â”‚     class FormularioModelForm(forms.ModelForm): # Para crear la metadata del formulario
â”‚   â”‚         class Meta:
â”‚   â”‚             model = Formulario
â”‚   â”‚             fields = ['titulo', 'descripcion', 'activo', 'fecha_limite']
â”‚   â”‚             widgets = {
â”‚   â”‚                 'titulo': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'placeholder': 'TÃ­tulo principal del formulario'}),
â”‚   â”‚                 'descripcion': forms.Textarea(attrs={'class': COMMON_TEXTAREA_CLASSES, 'rows': 3, 'placeholder': 'DescripciÃ³n o instrucciones (opcional)'}),
â”‚   â”‚                 'activo': forms.CheckboxInput(attrs={'class': COMMON_CHECKBOX_CLASSES + ' ml-2'}),
â”‚   â”‚                 'fecha_limite': forms.DateTimeInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'type': 'datetime-local'}),
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'titulo': 'TÃ­tulo del Formulario',
â”‚   â”‚                 'descripcion': 'DescripciÃ³n',
â”‚   â”‚                 'activo': 'Â¿Formulario activo para recibir respuestas?',
â”‚   â”‚                 'fecha_limite': 'Fecha LÃ­mite para Responder (opcional)'
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚     class CampoFormularioModelForm(forms.ModelForm): # Para aÃ±adir campos a un formulario (usado en formsets)
â”‚   â”‚         class Meta:
â”‚   â”‚             model = CampoFormulario
â”‚   â”‚             fields = ['etiqueta', 'tipo_campo', 'ayuda_texto', 'es_obligatorio', 'opciones_choices', 'orden'] # 'orden' se manejarÃ¡ en la vista o con JS
â”‚   â”‚             widgets = {
â”‚   â”‚                 'etiqueta': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'placeholder': 'Pregunta o etiqueta del campo'}),
â”‚   â”‚                 'tipo_campo': forms.Select(attrs={'class': COMMON_SELECT_CLASSES}),
â”‚   â”‚                 'ayuda_texto': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'placeholder': 'Ayuda adicional (opcional)'}),
â”‚   â”‚                 'es_obligatorio': forms.CheckboxInput(attrs={'class': COMMON_CHECKBOX_CLASSES}),
â”‚   â”‚                 'opciones_choices': forms.Textarea(attrs={'class': COMMON_TEXTAREA_CLASSES, 'rows': 3, 'placeholder': 'Una opciÃ³n por lÃ­nea (para opciÃ³n mÃºltiple, casillas, desplegable)'}),
â”‚   â”‚                 'orden': forms.HiddenInput(), # El orden se gestionarÃ¡ dinÃ¡micamente
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'etiqueta': 'Etiqueta/Pregunta',
â”‚   â”‚                 'tipo_campo': 'Tipo de Campo',
â”‚   â”‚                 'ayuda_texto': 'Texto de Ayuda',
â”‚   â”‚                 'es_obligatorio': 'Â¿Campo Obligatorio?',
â”‚   â”‚                 'opciones_choices': 'Opciones (si aplica)',
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚     # Nota: El formulario para *llenar* un 'Formulario' dinÃ¡mico se construye en la vista o el template,
â”‚   â”‚     # no como una clase estÃ¡tica aquÃ­, ya que sus campos dependen de las instancias de 'CampoFormulario'.
â”‚   â”‚     
â”‚   â”‚     # 2. Formulario para el MÃ³dulo de Calendario
â”‚   â”‚     class EventoCalendarioModelForm(forms.ModelForm):
â”‚   â”‚         class Meta:
â”‚   â”‚             model = EventoCalendario
â”‚   â”‚             fields = ['titulo', 'descripcion', 'fecha_inicio', 'fecha_fin'] # AÃ±adir 'participantes', 'color_evento' si los usas
â”‚   â”‚             widgets = {
â”‚   â”‚                 'titulo': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'placeholder': 'TÃ­tulo del evento'}),
â”‚   â”‚                 'descripcion': forms.Textarea(attrs={'class': COMMON_TEXTAREA_CLASSES, 'rows': 4, 'placeholder': 'DescripciÃ³n detallada (opcional)'}),
â”‚   â”‚                 'fecha_inicio': forms.DateTimeInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'type': 'datetime-local'}),
â”‚   â”‚                 'fecha_fin': forms.DateTimeInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'type': 'datetime-local'}),
â”‚   â”‚                 # 'color_evento': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'type': 'color'}), # Si usas color_evento
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'titulo': 'TÃ­tulo',
â”‚   â”‚                 'descripcion': 'DescripciÃ³n',
â”‚   â”‚                 'fecha_inicio': 'Fecha y Hora de Inicio',
â”‚   â”‚                 'fecha_fin': 'Fecha y Hora de Fin (opcional)',
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚         def clean(self):
â”‚   â”‚             cleaned_data = super().clean()
â”‚   â”‚             fecha_inicio = cleaned_data.get("fecha_inicio")
â”‚   â”‚             fecha_fin = cleaned_data.get("fecha_fin")
â”‚   â”‚     
â”‚   â”‚             if fecha_inicio and fecha_fin and fecha_fin < fecha_inicio:
â”‚   â”‚                 raise forms.ValidationError("La fecha de fin no puede ser anterior a la fecha de inicio.")
â”‚   â”‚             return cleaned_data
â”‚   â”‚     
â”‚   â”‚     # 3. Formulario para el MÃ³dulo de Tareas/Responsabilidades
â”‚   â”‚     class TareaModelForm(forms.ModelForm):
â”‚   â”‚         class Meta:
â”‚   â”‚             model = Tarea
â”‚   â”‚             fields = ['titulo', 'descripcion', 'asignado_a', 'fecha_limite', 'estado', 'prioridad']
â”‚   â”‚             widgets = {
â”‚   â”‚                 'titulo': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'placeholder': 'TÃ­tulo de la tarea'}),
â”‚   â”‚                 'descripcion': forms.Textarea(attrs={'class': COMMON_TEXTAREA_CLASSES, 'rows': 4, 'placeholder': 'DescripciÃ³n detallada (opcional)'}),
â”‚   â”‚                 'asignado_a': forms.Select(attrs={'class': COMMON_SELECT_CLASSES}),
â”‚   â”‚                 'fecha_limite': forms.DateTimeInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'type': 'datetime-local'}),
â”‚   â”‚                 'estado': forms.Select(attrs={'class': COMMON_SELECT_CLASSES}),
â”‚   â”‚                 'prioridad': forms.Select(attrs={'class': COMMON_SELECT_CLASSES}),
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'titulo': 'TÃ­tulo',
â”‚   â”‚                 'descripcion': 'DescripciÃ³n',
â”‚   â”‚                 'asignado_a': 'Asignar a',
â”‚   â”‚                 'fecha_limite': 'Fecha LÃ­mite (opcional)',
â”‚   â”‚                 'estado': 'Estado Actual',
â”‚   â”‚                 'prioridad': 'Prioridad',
â”‚   â”‚             }
â”‚   â”‚         
â”‚   â”‚         def __init__(self, *args, **kwargs):
â”‚   â”‚             super().__init__(*args, **kwargs)
â”‚   â”‚             # Limitar el queryset de 'asignado_a' a usuarios activos, por ejemplo
â”‚   â”‚             self.fields['asignado_a'].queryset = User.objects.filter(is_active=True).order_by('username')
â”‚   â”‚             self.fields['asignado_a'].empty_label = "Sin asignar"
â”‚   â”‚             self.fields['asignado_a'].required = False # Hacer opcional la asignaciÃ³n directa
â”‚   â”‚     
â”‚   â”‚     # 4. Formularios para Perfil de Usuario
â”‚   â”‚     class UserUpdateForm(forms.ModelForm): # Para campos del modelo User
â”‚   â”‚         email = forms.EmailField(required=True, widget=forms.EmailInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}))
â”‚   â”‚         class Meta:
â”‚   â”‚             model = User
â”‚   â”‚             fields = ['first_name', 'last_name', 'email']
â”‚   â”‚             widgets = {
â”‚   â”‚                 'first_name': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'last_name': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'first_name': 'Nombres',
â”‚   â”‚                 'last_name': 'Apellidos',
â”‚   â”‚                 'email': 'Correo ElectrÃ³nico Institucional',
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚     class PerfilUsuarioModelForm(forms.ModelForm): # Para campos del modelo PerfilUsuario
â”‚   â”‚         class Meta:
â”‚   â”‚             model = PerfilUsuario
â”‚   â”‚             fields = ['departamento', 'cargo', 'telefono_extension', 'foto_perfil', 'fecha_nacimiento', 'biografia_corta']
â”‚   â”‚             widgets = {
â”‚   â”‚                 'departamento': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'cargo': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'telefono_extension': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'foto_perfil': forms.ClearableFileInput(attrs={'class': COMMON_FILE_INPUT_CLASSES}),
â”‚   â”‚                 'fecha_nacimiento': forms.DateInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'type': 'date'}),
â”‚   â”‚                 'biografia_corta': forms.Textarea(attrs={'class': COMMON_TEXTAREA_CLASSES, 'rows': 3}),
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'departamento': 'Departamento o Unidad',
â”‚   â”‚                 'cargo': 'Cargo / Puesto',
â”‚   â”‚                 'telefono_extension': 'TelÃ©fono / ExtensiÃ³n',
â”‚   â”‚                 'foto_perfil': 'Foto de Perfil',
â”‚   â”‚                 'fecha_nacimiento': 'Fecha de Nacimiento',
â”‚   â”‚                 'biografia_corta': 'Sobre mÃ­ (breve)',
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚     # 5. Formularios para Reserva de Recursos
â”‚   â”‚     class TipoRecursoModelForm(forms.ModelForm):
â”‚   â”‚         class Meta:
â”‚   â”‚             model = TipoRecurso
â”‚   â”‚             fields = ['nombre', 'icono_fa']
â”‚   â”‚             widgets = {
â”‚   â”‚                 'nombre': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'icono_fa': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'placeholder': 'ej: fas fa-projector'}),
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚     class RecursoModelForm(forms.ModelForm):
â”‚   â”‚         class Meta:
â”‚   â”‚             model = Recurso
â”‚   â”‚             fields = ['nombre', 'tipo_recurso', 'descripcion', 'ubicacion', 'capacidad', 'esta_activo'] # 'responsable', 'requiere_aprobacion'
â”‚   â”‚             widgets = {
â”‚   â”‚                 'nombre': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'tipo_recurso': forms.Select(attrs={'class': COMMON_SELECT_CLASSES}),
â”‚   â”‚                 'descripcion': forms.Textarea(attrs={'class': COMMON_TEXTAREA_CLASSES, 'rows': 3}),
â”‚   â”‚                 'ubicacion': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'capacidad': forms.NumberInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'esta_activo': forms.CheckboxInput(attrs={'class': COMMON_CHECKBOX_CLASSES + ' ml-2'}),
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚     class ReservaModelForm(forms.ModelForm):
â”‚   â”‚         class Meta:
â”‚   â”‚             model = Reserva
â”‚   â”‚             fields = ['recurso', 'fecha_inicio', 'fecha_fin', 'motivo'] # 'estado' se maneja en la vista
â”‚   â”‚             widgets = {
â”‚   â”‚                 'recurso': forms.Select(attrs={'class': COMMON_SELECT_CLASSES}),
â”‚   â”‚                 'fecha_inicio': forms.DateTimeInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'type': 'datetime-local'}),
â”‚   â”‚                 'fecha_fin': forms.DateTimeInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES, 'type': 'datetime-local'}),
â”‚   â”‚                 'motivo': forms.Textarea(attrs={'class': COMMON_TEXTAREA_CLASSES, 'rows': 3, 'placeholder': 'Motivo de la reserva (opcional)'}),
â”‚   â”‚             }
â”‚   â”‚             labels = {
â”‚   â”‚                 'recurso': 'Recurso a Reservar',
â”‚   â”‚                 'fecha_inicio': 'Inicio de la Reserva',
â”‚   â”‚                 'fecha_fin': 'Fin de la Reserva',
â”‚   â”‚                 'motivo': 'Motivo',
â”‚   â”‚             }
â”‚   â”‚         
â”‚   â”‚         def __init__(self, *args, **kwargs):
â”‚   â”‚             super().__init__(*args, **kwargs)
â”‚   â”‚             # Mostrar solo recursos activos
â”‚   â”‚             self.fields['recurso'].queryset = Recurso.objects.filter(esta_activo=True)
â”‚   â”‚     
â”‚   â”‚         def clean(self):
â”‚   â”‚             cleaned_data = super().clean()
â”‚   â”‚             fecha_inicio = cleaned_data.get("fecha_inicio")
â”‚   â”‚             fecha_fin = cleaned_data.get("fecha_fin")
â”‚   â”‚             recurso = cleaned_data.get("recurso")
â”‚   â”‚     
â”‚   â”‚             if fecha_inicio and fecha_fin:
â”‚   â”‚                 if fecha_fin <= fecha_inicio:
â”‚   â”‚                     self.add_error('fecha_fin', "La fecha de fin debe ser posterior a la fecha de inicio.")
â”‚   â”‚                 
â”‚   â”‚                 if recurso:
â”‚   â”‚                     # Validar solapamientos (versiÃ³n simplificada, puede ser mÃ¡s robusta)
â”‚   â”‚                     solapamientos = Reserva.objects.filter(
â”‚   â”‚                         recurso=recurso,
â”‚   â”‚                         estado=Reserva.EstadoReserva.APROBADA, # Solo contra aprobadas
â”‚   â”‚                         fecha_inicio__lt=fecha_fin, # La nueva reserva no puede empezar antes de que termine una existente
â”‚   â”‚                         fecha_fin__gt=fecha_inicio  # Y no puede terminar despuÃ©s de que empiece una existente
â”‚   â”‚                     )
â”‚   â”‚                     if self.instance and self.instance.pk: # Excluir la propia reserva si se estÃ¡ editando
â”‚   â”‚                         solapamientos = solapamientos.exclude(pk=self.instance.pk)
â”‚   â”‚                     
â”‚   â”‚                     if solapamientos.exists():
â”‚   â”‚                         self.add_error(None, f"El recurso '{recurso.nombre}' ya estÃ¡ reservado o se solapa con otra reserva en el horario solicitado.")
â”‚   â”‚             return cleaned_data
â”‚   â”‚     
â”‚   â”‚     # 6. Formularios para GestiÃ³n de Usuarios (Staff)
â”‚   â”‚     class UserEditStaffForm(forms.ModelForm): # Para que el staff edite usuarios
â”‚   â”‚         grupos = forms.ModelMultipleChoiceField(
â”‚   â”‚             queryset=Group.objects.all(), # ESTA ES LA LÃNEA PROBLEMÃTICA
â”‚   â”‚             widget=forms.CheckboxSelectMultiple,
â”‚   â”‚             required=False,
â”‚   â”‚             label="Grupos de Permisos"
â”‚   â”‚         )
â”‚   â”‚         class Meta:
â”‚   â”‚             model = User
â”‚   â”‚             fields = ['username', 'first_name', 'last_name', 'email', 'is_active', 'is_staff', 'grupos']
â”‚   â”‚             widgets = {
â”‚   â”‚                 'username': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'first_name': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'last_name': forms.TextInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'email': forms.EmailInput(attrs={'class': COMMON_TEXT_INPUT_CLASSES}),
â”‚   â”‚                 'is_active': forms.CheckboxInput(attrs={'class': COMMON_CHECKBOX_CLASSES + ' ml-2'}),
â”‚   â”‚                 'is_staff': forms.CheckboxInput(attrs={'class': COMMON_CHECKBOX_CLASSES + ' ml-2'}),
â”‚   â”‚             }
â”‚   â”‚             help_texts = {
â”‚   â”‚                 'username': 'Requerido. 150 caracteres o menos. Letras, dÃ­gitos y @/./+/-/_ solamente.',
â”‚   â”‚                 'is_staff': 'Designa si el usuario puede iniciar sesiÃ³n en el sitio de administraciÃ³n (Django Admin).',
â”‚   â”‚                 'is_active': 'Designa si este usuario debe ser tratado como activo. Desmarcar esto en lugar de borrar cuentas.'
â”‚   â”‚             }
â”‚   â”‚     
â”‚   â”‚         def __init__(self, *args, **kwargs):
â”‚   â”‚             super().__init__(*args, **kwargs)
â”‚   â”‚             if self.instance and self.instance.pk:
â”‚   â”‚                 self.fields['grupos'].initial = self.instance.groups.all()
â”‚   â”‚     
â”‚   â”‚         def save(self, commit=True):
â”‚   â”‚             user = super().save(commit=False)
â”‚   â”‚             if commit:
â”‚   â”‚                 user.save()
â”‚   â”‚                 if hasattr(self, 'cleaned_data'): # Asegurarse de que cleaned_data existe
â”‚   â”‚                     user.groups.set(self.cleaned_data['grupos'])
â”‚   â”‚             return user
â”‚   â”‚   --- FIN CONTENIDO (forms.py) ---

â”‚   â”œâ”€â”€ migrations
â”‚   â”‚   â”œâ”€â”€ 0001_initial.py
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (0001_initial.py):
â”‚   â”‚   â”‚     # Generated by Django 5.2.1 on 2025-05-15 14:40
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     import django.db.models.deletion
â”‚   â”‚   â”‚     import django.utils.timezone
â”‚   â”‚   â”‚     import intranet_core.models
â”‚   â”‚   â”‚     from django.conf import settings
â”‚   â”‚   â”‚     from django.db import migrations, models
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     class Migration(migrations.Migration):
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         initial = True
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         dependencies = [
â”‚   â”‚   â”‚             migrations.swappable_dependency(settings.AUTH_USER_MODEL),
â”‚   â”‚   â”‚         ]
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         operations = [
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="Archivo",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "nombre_descriptivo",
â”‚   â”‚   â”‚                         models.CharField(
â”‚   â”‚   â”‚                             default="",
â”‚   â”‚   â”‚                             help_text="Nombre descriptivo o tÃ­tulo del archivo",
â”‚   â”‚   â”‚                             max_length=255,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "archivo_subido",
â”‚   â”‚   â”‚                         models.FileField(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                             upload_to=intranet_core.models.user_directory_path,
â”‚   â”‚   â”‚                             verbose_name="Archivo",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "fecha_subida",
â”‚   â”‚   â”‚                         models.DateTimeField(default=django.utils.timezone.now),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "subido_por",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.SET_NULL,
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Archivo",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Archivos",
â”‚   â”‚   â”‚                     "ordering": ["-fecha_subida"],
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚         ]
â”‚   â”‚   â”‚   --- FIN CONTENIDO (0001_initial.py) ---

â”‚   â”‚   â”œâ”€â”€ 0002_alter_archivo_options_and_more.py
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (0002_alter_archivo_options_and_more.py):
â”‚   â”‚   â”‚     # Generated by Django 5.2.1 on 2025-05-15 15:10
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     import django.db.models.deletion
â”‚   â”‚   â”‚     import django.utils.timezone
â”‚   â”‚   â”‚     import intranet_core.models
â”‚   â”‚   â”‚     from django.conf import settings
â”‚   â”‚   â”‚     from django.db import migrations, models
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     class Migration(migrations.Migration):
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         dependencies = [
â”‚   â”‚   â”‚             ("intranet_core", "0001_initial"),
â”‚   â”‚   â”‚             migrations.swappable_dependency(settings.AUTH_USER_MODEL),
â”‚   â”‚   â”‚         ]
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         operations = [
â”‚   â”‚   â”‚             migrations.AlterModelOptions(
â”‚   â”‚   â”‚                 name="archivo",
â”‚   â”‚   â”‚                 options={},
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.AddField(
â”‚   â”‚   â”‚                 model_name="archivo",
â”‚   â”‚   â”‚                 name="nombre_original_archivo",
â”‚   â”‚   â”‚                 field=models.CharField(default="", max_length=255),
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.AlterField(
â”‚   â”‚   â”‚                 model_name="archivo",
â”‚   â”‚   â”‚                 name="archivo_subido",
â”‚   â”‚   â”‚                 field=models.FileField(
â”‚   â”‚   â”‚                     default="",
â”‚   â”‚   â”‚                     upload_to=intranet_core.models.user_directory_path,
â”‚   â”‚   â”‚                     verbose_name="Archivo",
â”‚   â”‚   â”‚                 ),
â”‚   â”‚   â”‚                 preserve_default=False,
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.AlterField(
â”‚   â”‚   â”‚                 model_name="archivo",
â”‚   â”‚   â”‚                 name="subido_por",
â”‚   â”‚   â”‚                 field=models.ForeignKey(
â”‚   â”‚   â”‚                     default=1,
â”‚   â”‚   â”‚                     on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                     related_name="archivos_subidos",
â”‚   â”‚   â”‚                     to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                 ),
â”‚   â”‚   â”‚                 preserve_default=False,
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="Carpeta",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("nombre", models.CharField(max_length=100)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "fecha_creacion",
â”‚   â”‚   â”‚                         models.DateTimeField(default=django.utils.timezone.now),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "subido_por",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="carpetas_creadas",
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "ordering": ["nombre"],
â”‚   â”‚   â”‚                     "unique_together": {("nombre", "subido_por")},
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.AddField(
â”‚   â”‚   â”‚                 model_name="archivo",
â”‚   â”‚   â”‚                 name="carpeta",
â”‚   â”‚   â”‚                 field=models.ForeignKey(
â”‚   â”‚   â”‚                     blank=True,
â”‚   â”‚   â”‚                     null=True,
â”‚   â”‚   â”‚                     on_delete=django.db.models.deletion.SET_NULL,
â”‚   â”‚   â”‚                     related_name="archivos_contenidos",
â”‚   â”‚   â”‚                     to="intranet_core.carpeta",
â”‚   â”‚   â”‚                 ),
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚         ]
â”‚   â”‚   â”‚   --- FIN CONTENIDO (0002_alter_archivo_options_and_more.py) ---

â”‚   â”‚   â”œâ”€â”€ 0003_articulowiki_notificacion.py
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (0003_articulowiki_notificacion.py):
â”‚   â”‚   â”‚     # Generated by Django 5.2.1 on 2025-05-15 15:58
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     import django.db.models.deletion
â”‚   â”‚   â”‚     from django.conf import settings
â”‚   â”‚   â”‚     from django.db import migrations, models
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     class Migration(migrations.Migration):
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         dependencies = [
â”‚   â”‚   â”‚             ("intranet_core", "0002_alter_archivo_options_and_more"),
â”‚   â”‚   â”‚             migrations.swappable_dependency(settings.AUTH_USER_MODEL),
â”‚   â”‚   â”‚         ]
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         operations = [
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="ArticuloWiki",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("titulo", models.CharField(max_length=255, unique=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "slug",
â”‚   â”‚   â”‚                         models.SlugField(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             help_text="Dejar en blanco para autogenerar o especificar uno.",
â”‚   â”‚   â”‚                             max_length=255,
â”‚   â”‚   â”‚                             unique=True,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "contenido",
â”‚   â”‚   â”‚                         models.TextField(
â”‚   â”‚   â”‚                             help_text="Contenido del artÃ­culo en formato Markdown."
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("creado_el", models.DateTimeField(auto_now_add=True)),
â”‚   â”‚   â”‚                     ("actualizado_el", models.DateTimeField(auto_now=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "autor",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.SET_NULL,
â”‚   â”‚   â”‚                             related_name="articulos_wiki",
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "ArtÃ­culo de Wiki",
â”‚   â”‚   â”‚                     "verbose_name_plural": "ArtÃ­culos de Wiki",
â”‚   â”‚   â”‚                     "ordering": ["-actualizado_el", "titulo"],
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="Notificacion",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("mensaje", models.TextField()),
â”‚   â”‚   â”‚                     ("leida", models.BooleanField(default=False)),
â”‚   â”‚   â”‚                     ("fecha_creacion", models.DateTimeField(auto_now_add=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "url_destino",
â”‚   â”‚   â”‚                         models.URLField(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             help_text="URL opcional a la que se dirigirÃ¡ al hacer clic.",
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "destinatario",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="notificaciones",
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "NotificaciÃ³n",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Notificaciones",
â”‚   â”‚   â”‚                     "ordering": ["-fecha_creacion"],
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚         ]
â”‚   â”‚   â”‚   --- FIN CONTENIDO (0003_articulowiki_notificacion.py) ---

â”‚   â”‚   â”œâ”€â”€ 0004_recurso_tiporecurso_eventocalendario_formulario_and_more.py
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (0004_recurso_tiporecurso_eventocalendario_formulario_and_more.py):
â”‚   â”‚   â”‚     # Generated by Django 5.2.1 on 2025-05-15 16:05
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     import django.db.models.deletion
â”‚   â”‚   â”‚     import intranet_core.models
â”‚   â”‚   â”‚     from django.conf import settings
â”‚   â”‚   â”‚     from django.db import migrations, models
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     class Migration(migrations.Migration):
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         dependencies = [
â”‚   â”‚   â”‚             ("intranet_core", "0003_articulowiki_notificacion"),
â”‚   â”‚   â”‚             migrations.swappable_dependency(settings.AUTH_USER_MODEL),
â”‚   â”‚   â”‚         ]
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         operations = [
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="Recurso",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("nombre", models.CharField(max_length=100)),
â”‚   â”‚   â”‚                     ("descripcion", models.TextField(blank=True, null=True)),
â”‚   â”‚   â”‚                     ("ubicacion", models.CharField(blank=True, max_length=150, null=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "capacidad",
â”‚   â”‚   â”‚                         models.PositiveIntegerField(
â”‚   â”‚   â”‚                             blank=True, help_text="Ej: para salas de reuniones.", null=True
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "esta_activo",
â”‚   â”‚   â”‚                         models.BooleanField(
â”‚   â”‚   â”‚                             default=True,
â”‚   â”‚   â”‚                             help_text="Indica si el recurso estÃ¡ disponible para ser reservado.",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Recurso",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Recursos",
â”‚   â”‚   â”‚                     "ordering": ["tipo_recurso", "nombre"],
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="TipoRecurso",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("nombre", models.CharField(max_length=100, unique=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "icono_fa",
â”‚   â”‚   â”‚                         models.CharField(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             help_text="Ej: 'fas fa-building', 'fas fa-desktop'",
â”‚   â”‚   â”‚                             max_length=50,
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Tipo de Recurso",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Tipos de Recursos",
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="EventoCalendario",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("titulo", models.CharField(max_length=200)),
â”‚   â”‚   â”‚                     ("descripcion", models.TextField(blank=True, null=True)),
â”‚   â”‚   â”‚                     ("fecha_inicio", models.DateTimeField()),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "fecha_fin",
â”‚   â”‚   â”‚                         models.DateTimeField(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             help_text="Dejar en blanco si es un evento de dÃ­a completo o sin duraciÃ³n especÃ­fica en hora.",
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("creado_el", models.DateTimeField(auto_now_add=True)),
â”‚   â”‚   â”‚                     ("actualizado_el", models.DateTimeField(auto_now=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "creado_por",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="eventos_calendario",
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Evento de Calendario",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Eventos de Calendario",
â”‚   â”‚   â”‚                     "ordering": ["fecha_inicio"],
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="Formulario",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("titulo", models.CharField(max_length=255)),
â”‚   â”‚   â”‚                     ("descripcion", models.TextField(blank=True, null=True)),
â”‚   â”‚   â”‚                     ("creado_el", models.DateTimeField(auto_now_add=True)),
â”‚   â”‚   â”‚                     ("activo", models.BooleanField(default=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "fecha_limite",
â”‚   â”‚   â”‚                         models.DateTimeField(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             help_text="Opcional: Fecha y hora lÃ­mite para enviar respuestas.",
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "creado_por",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="formularios_creados",
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Formulario",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Formularios",
â”‚   â”‚   â”‚                     "ordering": ["-creado_el"],
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="CampoFormulario",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "etiqueta",
â”‚   â”‚   â”‚                         models.CharField(
â”‚   â”‚   â”‚                             help_text="Pregunta o tÃ­tulo del campo.", max_length=255
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "tipo_campo",
â”‚   â”‚   â”‚                         models.CharField(
â”‚   â”‚   â”‚                             choices=[
â”‚   â”‚   â”‚                                 ("TEXTO_CORTO", "Texto Corto"),
â”‚   â”‚   â”‚                                 ("TEXTO_LARGO", "Texto Largo (Ãrea de texto)"),
â”‚   â”‚   â”‚                                 ("NUMERO", "NÃºmero"),
â”‚   â”‚   â”‚                                 ("EMAIL", "Correo ElectrÃ³nico"),
â”‚   â”‚   â”‚                                 ("FECHA", "Fecha"),
â”‚   â”‚   â”‚                                 ("HORA", "Hora"),
â”‚   â”‚   â”‚                                 ("OPCION_MULTIPLE", "OpciÃ³n MÃºltiple (una respuesta)"),
â”‚   â”‚   â”‚                                 (
â”‚   â”‚   â”‚                                     "CASILLAS",
â”‚   â”‚   â”‚                                     "Casillas de VerificaciÃ³n (mÃºltiples respuestas)",
â”‚   â”‚   â”‚                                 ),
â”‚   â”‚   â”‚                                 ("DESPLEGABLE", "Desplegable (una respuesta)"),
â”‚   â”‚   â”‚                                 ("ARCHIVO", "Subir Archivo"),
â”‚   â”‚   â”‚                             ],
â”‚   â”‚   â”‚                             max_length=50,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "ayuda_texto",
â”‚   â”‚   â”‚                         models.CharField(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             help_text="Texto de ayuda o descripciÃ³n adicional para el campo.",
â”‚   â”‚   â”‚                             max_length=255,
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("es_obligatorio", models.BooleanField(default=False)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "orden",
â”‚   â”‚   â”‚                         models.PositiveIntegerField(
â”‚   â”‚   â”‚                             default=0,
â”‚   â”‚   â”‚                             help_text="Orden en que aparecerÃ¡ el campo en el formulario.",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "opciones_choices",
â”‚   â”‚   â”‚                         models.TextField(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             help_text="Para campos de opciÃ³n mÃºltiple, casillas o desplegable. Ingrese las opciones separadas por un salto de lÃ­nea (una opciÃ³n por lÃ­nea).",
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "formulario",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="campos",
â”‚   â”‚   â”‚                             to="intranet_core.formulario",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Campo de Formulario",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Campos de Formularios",
â”‚   â”‚   â”‚                     "ordering": ["formulario", "orden"],
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="PerfilUsuario",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "departamento",
â”‚   â”‚   â”‚                         models.CharField(blank=True, max_length=100, null=True),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("cargo", models.CharField(blank=True, max_length=100, null=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "telefono_extension",
â”‚   â”‚   â”‚                         models.CharField(blank=True, max_length=20, null=True),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "foto_perfil",
â”‚   â”‚   â”‚                         models.ImageField(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             default="perfiles_usuarios/default_avatar.png",
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                             upload_to=intranet_core.models.user_directory_path,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("fecha_nacimiento", models.DateField(blank=True, null=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "biografia_corta",
â”‚   â”‚   â”‚                         models.TextField(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             help_text="Una breve descripciÃ³n sobre ti.",
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "usuario",
â”‚   â”‚   â”‚                         models.OneToOneField(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="perfil",
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Perfil de Usuario",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Perfiles de Usuarios",
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="Reserva",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("fecha_inicio", models.DateTimeField()),
â”‚   â”‚   â”‚                     ("fecha_fin", models.DateTimeField()),
â”‚   â”‚   â”‚                     ("motivo", models.TextField(blank=True, null=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "estado",
â”‚   â”‚   â”‚                         models.CharField(
â”‚   â”‚   â”‚                             choices=[
â”‚   â”‚   â”‚                                 ("PENDIENTE", "Pendiente de AprobaciÃ³n"),
â”‚   â”‚   â”‚                                 ("APROBADA", "Aprobada"),
â”‚   â”‚   â”‚                                 ("RECHAZADA", "Rechazada"),
â”‚   â”‚   â”‚                                 ("CANCELADA", "Cancelada por Usuario"),
â”‚   â”‚   â”‚                             ],
â”‚   â”‚   â”‚                             default="APROBADA",
â”‚   â”‚   â”‚                             max_length=20,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("creado_el", models.DateTimeField(auto_now_add=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "recurso",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="reservas",
â”‚   â”‚   â”‚                             to="intranet_core.recurso",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "reservado_por",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="mis_reservas",
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Reserva",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Reservas",
â”‚   â”‚   â”‚                     "ordering": ["fecha_inicio"],
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="RespuestaFormulario",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("enviado_el", models.DateTimeField(auto_now_add=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "formulario",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="respuestas_recibidas",
â”‚   â”‚   â”‚                             to="intranet_core.formulario",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "respondido_por",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.SET_NULL,
â”‚   â”‚   â”‚                             related_name="respuestas_enviadas",
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Respuesta de Formulario",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Respuestas de Formularios",
â”‚   â”‚   â”‚                     "ordering": ["-enviado_el"],
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="DatoRespuesta",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("valor", models.TextField(blank=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "campo_formulario",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             to="intranet_core.campoformulario",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "respuesta_formulario",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="datos",
â”‚   â”‚   â”‚                             to="intranet_core.respuestaformulario",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Dato de Respuesta",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Datos de Respuestas",
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.CreateModel(
â”‚   â”‚   â”‚                 name="Tarea",
â”‚   â”‚   â”‚                 fields=[
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "id",
â”‚   â”‚   â”‚                         models.BigAutoField(
â”‚   â”‚   â”‚                             auto_created=True,
â”‚   â”‚   â”‚                             primary_key=True,
â”‚   â”‚   â”‚                             serialize=False,
â”‚   â”‚   â”‚                             verbose_name="ID",
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     ("titulo", models.CharField(max_length=255)),
â”‚   â”‚   â”‚                     ("descripcion", models.TextField(blank=True, null=True)),
â”‚   â”‚   â”‚                     ("fecha_creacion", models.DateTimeField(auto_now_add=True)),
â”‚   â”‚   â”‚                     ("fecha_limite", models.DateTimeField(blank=True, null=True)),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "estado",
â”‚   â”‚   â”‚                         models.CharField(
â”‚   â”‚   â”‚                             choices=[
â”‚   â”‚   â”‚                                 ("PENDIENTE", "Pendiente"),
â”‚   â”‚   â”‚                                 ("EN_PROGRESO", "En Progreso"),
â”‚   â”‚   â”‚                                 ("COMPLETADA", "Completada"),
â”‚   â”‚   â”‚                                 ("CANCELADA", "Cancelada"),
â”‚   â”‚   â”‚                                 ("EN_ESPERA", "En Espera"),
â”‚   â”‚   â”‚                             ],
â”‚   â”‚   â”‚                             default="PENDIENTE",
â”‚   â”‚   â”‚                             max_length=20,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "prioridad",
â”‚   â”‚   â”‚                         models.CharField(
â”‚   â”‚   â”‚                             choices=[
â”‚   â”‚   â”‚                                 ("BAJA", "Baja"),
â”‚   â”‚   â”‚                                 ("MEDIA", "Media"),
â”‚   â”‚   â”‚                                 ("ALTA", "Alta"),
â”‚   â”‚   â”‚                                 ("URGENTE", "Urgente"),
â”‚   â”‚   â”‚                             ],
â”‚   â”‚   â”‚                             default="MEDIA",
â”‚   â”‚   â”‚                             max_length=10,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "asignado_a",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             blank=True,
â”‚   â”‚   â”‚                             null=True,
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.SET_NULL,
â”‚   â”‚   â”‚                             related_name="tareas_asignadas",
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                     (
â”‚   â”‚   â”‚                         "creado_por",
â”‚   â”‚   â”‚                         models.ForeignKey(
â”‚   â”‚   â”‚                             on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                             related_name="tareas_creadas",
â”‚   â”‚   â”‚                             to=settings.AUTH_USER_MODEL,
â”‚   â”‚   â”‚                         ),
â”‚   â”‚   â”‚                     ),
â”‚   â”‚   â”‚                 ],
â”‚   â”‚   â”‚                 options={
â”‚   â”‚   â”‚                     "verbose_name": "Tarea",
â”‚   â”‚   â”‚                     "verbose_name_plural": "Tareas",
â”‚   â”‚   â”‚                     "ordering": ["-prioridad", "fecha_limite", "fecha_creacion"],
â”‚   â”‚   â”‚                 },
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.AddField(
â”‚   â”‚   â”‚                 model_name="recurso",
â”‚   â”‚   â”‚                 name="tipo_recurso",
â”‚   â”‚   â”‚                 field=models.ForeignKey(
â”‚   â”‚   â”‚                     on_delete=django.db.models.deletion.PROTECT,
â”‚   â”‚   â”‚                     to="intranet_core.tiporecurso",
â”‚   â”‚   â”‚                 ),
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚         ]
â”‚   â”‚   â”‚   --- FIN CONTENIDO (0004_recurso_tiporecurso_eventocalendario_formulario_and_more.py) ---

â”‚   â”‚   â”œâ”€â”€ 0005_alter_carpeta_unique_together_carpeta_carpeta_padre_and_more.py
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (0005_alter_carpeta_unique_together_carpeta_carpeta_padre_and_more.py):
â”‚   â”‚   â”‚     # Generated by Django 5.2.1 on 2025-05-15 16:19
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     import django.db.models.deletion
â”‚   â”‚   â”‚     from django.conf import settings
â”‚   â”‚   â”‚     from django.db import migrations, models
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     class Migration(migrations.Migration):
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         dependencies = [
â”‚   â”‚   â”‚             (
â”‚   â”‚   â”‚                 "intranet_core",
â”‚   â”‚   â”‚                 "0004_recurso_tiporecurso_eventocalendario_formulario_and_more",
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.swappable_dependency(settings.AUTH_USER_MODEL),
â”‚   â”‚   â”‚         ]
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         operations = [
â”‚   â”‚   â”‚             migrations.AlterUniqueTogether(
â”‚   â”‚   â”‚                 name="carpeta",
â”‚   â”‚   â”‚                 unique_together=set(),
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.AddField(
â”‚   â”‚   â”‚                 model_name="carpeta",
â”‚   â”‚   â”‚                 name="carpeta_padre",
â”‚   â”‚   â”‚                 field=models.ForeignKey(
â”‚   â”‚   â”‚                     blank=True,
â”‚   â”‚   â”‚                     null=True,
â”‚   â”‚   â”‚                     on_delete=django.db.models.deletion.CASCADE,
â”‚   â”‚   â”‚                     related_name="subcarpetas",
â”‚   â”‚   â”‚                     to="intranet_core.carpeta",
â”‚   â”‚   â”‚                 ),
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚             migrations.AlterUniqueTogether(
â”‚   â”‚   â”‚                 name="carpeta",
â”‚   â”‚   â”‚                 unique_together={("nombre", "subido_por", "carpeta_padre")},
â”‚   â”‚   â”‚             ),
â”‚   â”‚   â”‚         ]
â”‚   â”‚   â”‚   --- FIN CONTENIDO (0005_alter_carpeta_unique_together_carpeta_carpeta_padre_and_more.py) ---

â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   ðŸ“„ (Archivo vacÃ­o)


â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (models.py):
â”‚   â”‚     # intranet_core/models.py
â”‚   â”‚     import os
â”‚   â”‚     from django.db import models
â”‚   â”‚     from django.contrib.auth.models import User # Mantenido, aunque settings.AUTH_USER_MODEL es mÃ¡s flexible
â”‚   â”‚     from django.utils import timezone
â”‚   â”‚     from django.urls import reverse
â”‚   â”‚     from django.utils.text import slugify
â”‚   â”‚     from django.conf import settings # Importante para referenciar al modelo User de forma flexible
â”‚   â”‚     
â”‚   â”‚     # --- Funciones Auxiliares ---
â”‚   â”‚     def user_directory_path(instance, filename):
â”‚   â”‚         # instance.subido_por puede ser None si el usuario fue eliminado y se seteÃ³ a SET_NULL
â”‚   â”‚         # o si el modelo es diferente y 'subido_por' no es el campo de usuario.
â”‚   â”‚         # Ajustaremos para que sea mÃ¡s genÃ©rico o especÃ­fico por modelo si es necesario.
â”‚   â”‚         # Para el modelo Archivo, instance.subido_por es correcto.
â”‚   â”‚         user_id_folder = "unknown_user"
â”‚   â”‚         if hasattr(instance, 'subido_por') and instance.subido_por:
â”‚   â”‚             user_id_folder = f"user_{instance.subido_por.id}"
â”‚   â”‚         elif hasattr(instance, 'creado_por') and instance.creado_por: # Para otros modelos
â”‚   â”‚             user_id_folder = f"user_{instance.creado_por.id}"
â”‚   â”‚         elif hasattr(instance, 'usuario') and instance.usuario: # Para PerfilUsuario
â”‚   â”‚             user_id_folder = f"user_{instance.usuario.id}"
â”‚   â”‚     
â”‚   â”‚         # Determinar la subcarpeta segÃºn el tipo de instancia para organizar mejor los archivos
â”‚   â”‚         if isinstance(instance, Archivo):
â”‚   â”‚             return f'archivos_gestionados/{user_id_folder}/{filename}'
â”‚   â”‚         elif isinstance(instance, PerfilUsuario) and 'foto_perfil' in filename: # Asumiendo que filename se pasa desde el campo
â”‚   â”‚             return f'perfiles_usuarios/{user_id_folder}/{filename}'
â”‚   â”‚         # AÃ±adir mÃ¡s condiciones para otros modelos que suban archivos si es necesario
â”‚   â”‚         return f'uploads_generales/{user_id_folder}/{filename}'
â”‚   â”‚     
â”‚   â”‚     # --- Modelos Existentes ---
â”‚   â”‚     
â”‚   â”‚     class Carpeta(models.Model):
â”‚   â”‚         nombre = models.CharField(max_length=100)
â”‚   â”‚         subido_por = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='carpetas_creadas')
â”‚   â”‚         fecha_creacion = models.DateTimeField(default=timezone.now)
â”‚   â”‚         carpeta_padre = models.ForeignKey('self', null=True, blank=True, on_delete=models.CASCADE, related_name='subcarpetas') # DESCOMENTAR O AÃ‘ADIR
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             # Ajustar unique_together si carpeta_padre se aÃ±ade y debe ser Ãºnico en ese contexto
â”‚   â”‚             unique_together = ('nombre', 'subido_por', 'carpeta_padre')
â”‚   â”‚             ordering = ['nombre']
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return self.nombre
â”‚   â”‚     
â”‚   â”‚     class Archivo(models.Model):
â”‚   â”‚         nombre_descriptivo = models.CharField(
â”‚   â”‚             max_length=255,
â”‚   â”‚             help_text="Nombre descriptivo o tÃ­tulo del archivo",
â”‚   â”‚             default=''
â”‚   â”‚         )
â”‚   â”‚         archivo_subido = models.FileField(
â”‚   â”‚             upload_to=user_directory_path, # Reutilizamos la funciÃ³n pero podrÃ­a ser mÃ¡s especÃ­fica
â”‚   â”‚             verbose_name="Archivo",
â”‚   â”‚             null=False,
â”‚   â”‚             blank=False
â”‚   â”‚         )
â”‚   â”‚         nombre_original_archivo = models.CharField(max_length=255, default='')
â”‚   â”‚         fecha_subida = models.DateTimeField(default=timezone.now)
â”‚   â”‚         subido_por = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='archivos_subidos')
â”‚   â”‚         carpeta = models.ForeignKey(
â”‚   â”‚             Carpeta,
â”‚   â”‚             null=True,
â”‚   â”‚             blank=True,
â”‚   â”‚             on_delete=models.SET_NULL,
â”‚   â”‚             related_name='archivos_contenidos'
â”‚   â”‚         )
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return self.nombre_descriptivo or self.nombre_original_archivo
â”‚   â”‚     
â”‚   â”‚         def delete(self, *args, **kwargs):
â”‚   â”‚             if self.archivo_subido and hasattr(self.archivo_subido, 'path'):
â”‚   â”‚                 file_path = self.archivo_subido.path
â”‚   â”‚                 if os.path.isfile(file_path):
â”‚   â”‚                     try:
â”‚   â”‚                         os.remove(file_path)
â”‚   â”‚                     except OSError as e:
â”‚   â”‚                         print(f"Error al eliminar el archivo fÃ­sico {file_path}: {e}")
â”‚   â”‚                 else:
â”‚   â”‚                     print(f"Advertencia: El archivo fÃ­sico no se encontrÃ³ en {file_path} para el objeto Archivo ID {self.id}")
â”‚   â”‚             super().delete(*args, **kwargs)
â”‚   â”‚     
â”‚   â”‚         def get_file_extension(self):
â”‚   â”‚             if self.archivo_subido and self.archivo_subido.name:
â”‚   â”‚                 name, extension = os.path.splitext(self.archivo_subido.name)
â”‚   â”‚                 return extension.lower()
â”‚   â”‚             return ''
â”‚   â”‚     
â”‚   â”‚         def is_viewable_in_browser(self):
â”‚   â”‚             viewable_extensions = [
â”‚   â”‚                 '.txt', '.md', '.py', '.js', '.json', '.css', '.html', '.xml',
â”‚   â”‚                 '.jpg', '.jpeg', '.png', '.gif', '.svg', '.webp',
â”‚   â”‚                 '.pdf'
â”‚   â”‚             ]
â”‚   â”‚             return self.get_file_extension() in viewable_extensions
â”‚   â”‚     
â”‚   â”‚         def get_view_url(self):
â”‚   â”‚             return reverse('intranet_core:ver_archivo', args=[self.id])
â”‚   â”‚     
â”‚   â”‚         def get_edit_url(self):
â”‚   â”‚             return reverse('intranet_core:editar_archivo', args=[self.id])
â”‚   â”‚     
â”‚   â”‚     class ArticuloWiki(models.Model):
â”‚   â”‚         titulo = models.CharField(max_length=255, unique=True)
â”‚   â”‚         slug = models.SlugField(max_length=255, unique=True, blank=True, help_text="Dejar en blanco para autogenerar o especificar uno.")
â”‚   â”‚         contenido = models.TextField(help_text="Contenido del artÃ­culo en formato Markdown.")
â”‚   â”‚         autor = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, related_name='articulos_wiki')
â”‚   â”‚         creado_el = models.DateTimeField(auto_now_add=True)
â”‚   â”‚         actualizado_el = models.DateTimeField(auto_now=True)
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             ordering = ['-actualizado_el', 'titulo']
â”‚   â”‚             verbose_name = "ArtÃ­culo de Wiki"
â”‚   â”‚             verbose_name_plural = "ArtÃ­culos de Wiki"
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return self.titulo
â”‚   â”‚     
â”‚   â”‚         def save(self, *args, **kwargs):
â”‚   â”‚             original_slug_base = slugify(self.titulo)
â”‚   â”‚             if not self.slug or (hasattr(self, '_original_titulo') and self._original_titulo != self.titulo and self.slug == slugify(self._original_titulo)):
â”‚   â”‚                 self.slug = original_slug_base
â”‚   â”‚     
â”‚   â”‚             final_slug = self.slug
â”‚   â”‚             counter = 1
â”‚   â”‚             while ArticuloWiki.objects.filter(slug=final_slug).exclude(pk=self.pk).exists():
â”‚   â”‚                 final_slug = f"{original_slug_base}-{counter}"
â”‚   â”‚                 counter += 1
â”‚   â”‚             self.slug = final_slug
â”‚   â”‚             
â”‚   â”‚             self._original_titulo = self.titulo
â”‚   â”‚             super().save(*args, **kwargs)
â”‚   â”‚     
â”‚   â”‚         def get_absolute_url(self):
â”‚   â”‚             return reverse('intranet_core:wiki_articulo_detalle', kwargs={'slug': self.slug})
â”‚   â”‚     
â”‚   â”‚         @classmethod
â”‚   â”‚         def from_db(cls, db, field_names, values):
â”‚   â”‚             instance = super().from_db(db, field_names, values)
â”‚   â”‚             instance._original_titulo = instance.titulo
â”‚   â”‚             return instance
â”‚   â”‚     
â”‚   â”‚     class Notificacion(models.Model):
â”‚   â”‚         destinatario = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='notificaciones')
â”‚   â”‚         mensaje = models.TextField()
â”‚   â”‚         leida = models.BooleanField(default=False)
â”‚   â”‚         fecha_creacion = models.DateTimeField(auto_now_add=True)
â”‚   â”‚         url_destino = models.URLField(blank=True, null=True, help_text="URL opcional a la que se dirigirÃ¡ al hacer clic.")
â”‚   â”‚         # tipo_notificacion = models.CharField(max_length=50, blank=True, null=True) # Opcional para categorizar
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             ordering = ['-fecha_creacion']
â”‚   â”‚             verbose_name = "NotificaciÃ³n"
â”‚   â”‚             verbose_name_plural = "Notificaciones"
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return f"NotificaciÃ³n para {self.destinatario.username}: {self.mensaje[:50]}"
â”‚   â”‚     
â”‚   â”‚     # --- Nuevos Modelos para Funcionalidades Faltantes ---
â”‚   â”‚     
â”‚   â”‚     # 1. Modelos para el MÃ³dulo de Formularios
â”‚   â”‚     class Formulario(models.Model):
â”‚   â”‚         titulo = models.CharField(max_length=255)
â”‚   â”‚         descripcion = models.TextField(blank=True, null=True)
â”‚   â”‚         creado_por = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='formularios_creados')
â”‚   â”‚         creado_el = models.DateTimeField(auto_now_add=True)
â”‚   â”‚         activo = models.BooleanField(default=True)
â”‚   â”‚         fecha_limite = models.DateTimeField(blank=True, null=True, help_text="Opcional: Fecha y hora lÃ­mite para enviar respuestas.")
â”‚   â”‚         # permite_anonimo = models.BooleanField(default=False, help_text="Permitir respuestas sin iniciar sesiÃ³n.")
â”‚   â”‚         # permite_multiples_respuestas_usuario = models.BooleanField(default=False, help_text="Permitir que un usuario envÃ­e mÃºltiples respuestas.")
â”‚   â”‚     
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             verbose_name = "Formulario"
â”‚   â”‚             verbose_name_plural = "Formularios"
â”‚   â”‚             ordering = ['-creado_el']
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return self.titulo
â”‚   â”‚     
â”‚   â”‚         def get_absolute_url(self): # Ejemplo de URL, ajusta segÃºn tus urls.py
â”‚   â”‚             return reverse('intranet_core:llenar_formulario', kwargs={'formulario_id': self.id})
â”‚   â”‚     
â”‚   â”‚     class CampoFormulario(models.Model):
â”‚   â”‚         class TipoCampo(models.TextChoices):
â”‚   â”‚             TEXTO_CORTO = 'TEXTO_CORTO', 'Texto Corto'
â”‚   â”‚             TEXTO_LARGO = 'TEXTO_LARGO', 'Texto Largo (Ãrea de texto)'
â”‚   â”‚             NUMERO = 'NUMERO', 'NÃºmero'
â”‚   â”‚             EMAIL = 'EMAIL', 'Correo ElectrÃ³nico'
â”‚   â”‚             FECHA = 'FECHA', 'Fecha'
â”‚   â”‚             HORA = 'HORA', 'Hora'
â”‚   â”‚             OPCION_MULTIPLE = 'OPCION_MULTIPLE', 'OpciÃ³n MÃºltiple (una respuesta)'
â”‚   â”‚             CASILLAS = 'CASILLAS', 'Casillas de VerificaciÃ³n (mÃºltiples respuestas)'
â”‚   â”‚             DESPLEGABLE = 'DESPLEGABLE', 'Desplegable (una respuesta)'
â”‚   â”‚             ARCHIVO = 'ARCHIVO', 'Subir Archivo' # Considerar cÃ³mo manejar estos archivos
â”‚   â”‚             # Separador/Texto informativo, etc.
â”‚   â”‚     
â”‚   â”‚         formulario = models.ForeignKey(Formulario, on_delete=models.CASCADE, related_name='campos')
â”‚   â”‚         etiqueta = models.CharField(max_length=255, help_text="Pregunta o tÃ­tulo del campo.")
â”‚   â”‚         tipo_campo = models.CharField(max_length=50, choices=TipoCampo.choices)
â”‚   â”‚         ayuda_texto = models.CharField(max_length=255, blank=True, null=True, help_text="Texto de ayuda o descripciÃ³n adicional para el campo.")
â”‚   â”‚         es_obligatorio = models.BooleanField(default=False)
â”‚   â”‚         orden = models.PositiveIntegerField(default=0, help_text="Orden en que aparecerÃ¡ el campo en el formulario.")
â”‚   â”‚         opciones_choices = models.TextField(blank=True, null=True, help_text="Para campos de opciÃ³n mÃºltiple, casillas o desplegable. Ingrese las opciones separadas por un salto de lÃ­nea (una opciÃ³n por lÃ­nea).")
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             verbose_name = "Campo de Formulario"
â”‚   â”‚             verbose_name_plural = "Campos de Formularios"
â”‚   â”‚             ordering = ['formulario', 'orden']
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return f"{self.formulario.titulo} - {self.etiqueta} ({self.get_tipo_campo_display()})"
â”‚   â”‚     
â”‚   â”‚         def get_opciones_lista(self):
â”‚   â”‚             if self.opciones_choices and self.tipo_campo in [self.TipoCampo.OPCION_MULTIPLE, self.TipoCampo.CASILLAS, self.TipoCampo.DESPLEGABLE]:
â”‚   â”‚                 return [opt.strip() for opt in self.opciones_choices.splitlines() if opt.strip()]
â”‚   â”‚             return []
â”‚   â”‚     
â”‚   â”‚     class RespuestaFormulario(models.Model):
â”‚   â”‚         formulario = models.ForeignKey(Formulario, on_delete=models.CASCADE, related_name='respuestas_recibidas')
â”‚   â”‚         respondido_por = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, blank=True, related_name='respuestas_enviadas') # SET_NULL si el usuario es eliminado
â”‚   â”‚         # ip_address = models.GenericIPAddressField(blank=True, null=True) # Si se permiten respuestas anÃ³nimas
â”‚   â”‚         enviado_el = models.DateTimeField(auto_now_add=True)
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             verbose_name = "Respuesta de Formulario"
â”‚   â”‚             verbose_name_plural = "Respuestas de Formularios"
â”‚   â”‚             ordering = ['-enviado_el']
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             usuario = self.respondido_por.username if self.respondido_por else "AnÃ³nimo"
â”‚   â”‚             return f"Respuesta de {usuario} para '{self.formulario.titulo}' el {self.enviado_el.strftime('%d/%m/%Y %H:%M')}"
â”‚   â”‚     
â”‚   â”‚     class DatoRespuesta(models.Model):
â”‚   â”‚         respuesta_formulario = models.ForeignKey(RespuestaFormulario, on_delete=models.CASCADE, related_name='datos')
â”‚   â”‚         campo_formulario = models.ForeignKey(CampoFormulario, on_delete=models.CASCADE) # Considerar on_delete=models.PROTECT o SET_NULL si no se deben borrar datos si se borra un campo
â”‚   â”‚         valor = models.TextField(blank=True) # Para mÃºltiples opciones en casillas, se pueden guardar separadas por un delimitador especial
â”‚   â”‚         # archivo_adjunto = models.FileField(upload_to='respuestas_formularios_archivos/', blank=True, null=True) # Si el campo es de tipo ARCHIVO
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             verbose_name = "Dato de Respuesta"
â”‚   â”‚             verbose_name_plural = "Datos de Respuestas"
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return f"Para '{self.campo_formulario.etiqueta}': {self.valor[:50]}"
â”‚   â”‚     
â”‚   â”‚     # 2. Modelo para el MÃ³dulo de Calendario
â”‚   â”‚     class EventoCalendario(models.Model):
â”‚   â”‚         titulo = models.CharField(max_length=200)
â”‚   â”‚         descripcion = models.TextField(blank=True, null=True)
â”‚   â”‚         fecha_inicio = models.DateTimeField()
â”‚   â”‚         fecha_fin = models.DateTimeField(blank=True, null=True, help_text="Dejar en blanco si es un evento de dÃ­a completo o sin duraciÃ³n especÃ­fica en hora.")
â”‚   â”‚         creado_por = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='eventos_calendario')
â”‚   â”‚         creado_el = models.DateTimeField(auto_now_add=True)
â”‚   â”‚         actualizado_el = models.DateTimeField(auto_now=True)
â”‚   â”‚         # color_evento = models.CharField(max_length=7, blank=True, null=True, help_text="Color en formato hexadecimal, ej: #FF5733") # Para FullCalendar
â”‚   â”‚         # recurrencia_regla = models.CharField(max_length=255, blank=True, null=True, help_text="Regla de recurrencia (ej. iCalendar RRULE)")
â”‚   â”‚         # participantes = models.ManyToManyField(settings.AUTH_USER_MODEL, blank=True, related_name='eventos_participa')
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             verbose_name = "Evento de Calendario"
â”‚   â”‚             verbose_name_plural = "Eventos de Calendario"
â”‚   â”‚             ordering = ['fecha_inicio']
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return self.titulo
â”‚   â”‚     
â”‚   â”‚     # 3. Modelo para el MÃ³dulo de Responsabilidades (GestiÃ³n de Tareas)
â”‚   â”‚     class Tarea(models.Model):
â”‚   â”‚         class EstadoTarea(models.TextChoices):
â”‚   â”‚             PENDIENTE = 'PENDIENTE', 'Pendiente'
â”‚   â”‚             EN_PROGRESO = 'EN_PROGRESO', 'En Progreso'
â”‚   â”‚             COMPLETADA = 'COMPLETADA', 'Completada'
â”‚   â”‚             CANCELADA = 'CANCELADA', 'Cancelada'
â”‚   â”‚             EN_ESPERA = 'EN_ESPERA', 'En Espera'
â”‚   â”‚     
â”‚   â”‚         class PrioridadTarea(models.TextChoices):
â”‚   â”‚             BAJA = 'BAJA', 'Baja'
â”‚   â”‚             MEDIA = 'MEDIA', 'Media'
â”‚   â”‚             ALTA = 'ALTA', 'Alta'
â”‚   â”‚             URGENTE = 'URGENTE', 'Urgente'
â”‚   â”‚     
â”‚   â”‚         titulo = models.CharField(max_length=255)
â”‚   â”‚         descripcion = models.TextField(blank=True, null=True)
â”‚   â”‚         asignado_a = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, blank=True, related_name='tareas_asignadas')
â”‚   â”‚         creado_por = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='tareas_creadas')
â”‚   â”‚         fecha_creacion = models.DateTimeField(auto_now_add=True)
â”‚   â”‚         fecha_limite = models.DateTimeField(blank=True, null=True)
â”‚   â”‚         estado = models.CharField(max_length=20, choices=EstadoTarea.choices, default=EstadoTarea.PENDIENTE)
â”‚   â”‚         prioridad = models.CharField(max_length=10, choices=PrioridadTarea.choices, default=PrioridadTarea.MEDIA)
â”‚   â”‚         # proyecto = models.ForeignKey('Proyecto', on_delete=models.SET_NULL, null=True, blank=True) # Si tienes un modelo Proyecto
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             verbose_name = "Tarea"
â”‚   â”‚             verbose_name_plural = "Tareas"
â”‚   â”‚             ordering = ['-prioridad', 'fecha_limite', 'fecha_creacion']
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return self.titulo
â”‚   â”‚     
â”‚   â”‚     # 4. Modelo para Perfil de Usuario (Opcional, para Directorio y Perfil)
â”‚   â”‚     class PerfilUsuario(models.Model):
â”‚   â”‚         usuario = models.OneToOneField(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='perfil')
â”‚   â”‚         departamento = models.CharField(max_length=100, blank=True, null=True)
â”‚   â”‚         cargo = models.CharField(max_length=100, blank=True, null=True)
â”‚   â”‚         telefono_extension = models.CharField(max_length=20, blank=True, null=True)
â”‚   â”‚         foto_perfil = models.ImageField(upload_to=user_directory_path, null=True, blank=True, default='perfiles_usuarios/default_avatar.png')
â”‚   â”‚         fecha_nacimiento = models.DateField(null=True, blank=True)
â”‚   â”‚         biografia_corta = models.TextField(blank=True, null=True, help_text="Una breve descripciÃ³n sobre ti.")
â”‚   â”‚     
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             verbose_name = "Perfil de Usuario"
â”‚   â”‚             verbose_name_plural = "Perfiles de Usuarios"
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return f"Perfil de {self.usuario.username}"
â”‚   â”‚     
â”‚   â”‚         # PodrÃ­as usar signals para crear PerfilUsuario automÃ¡ticamente cuando se crea un User.
â”‚   â”‚         # from django.db.models.signals import post_save
â”‚   â”‚         # from django.dispatch import receiver
â”‚   â”‚         # @receiver(post_save, sender=settings.AUTH_USER_MODEL)
â”‚   â”‚         # def create_or_update_user_profile(sender, instance, created, **kwargs):
â”‚   â”‚         #     if created:
â”‚   â”‚         #         PerfilUsuario.objects.create(usuario=instance)
â”‚   â”‚         #     # instance.perfilusuario.save() # Si es una actualizaciÃ³n y quieres guardar tambiÃ©n el perfil
â”‚   â”‚     
â”‚   â”‚     # 5. Modelos para Reserva de Recursos
â”‚   â”‚     class TipoRecurso(models.Model):
â”‚   â”‚         nombre = models.CharField(max_length=100, unique=True)
â”‚   â”‚         icono_fa = models.CharField(max_length=50, blank=True, null=True, help_text="Ej: 'fas fa-building', 'fas fa-desktop'") # Para mostrar un icono
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             verbose_name = "Tipo de Recurso"
â”‚   â”‚             verbose_name_plural = "Tipos de Recursos"
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return self.nombre
â”‚   â”‚     
â”‚   â”‚     class Recurso(models.Model):
â”‚   â”‚         nombre = models.CharField(max_length=100)
â”‚   â”‚         tipo_recurso = models.ForeignKey(TipoRecurso, on_delete=models.PROTECT) # Evitar borrar tipo si hay recursos asociados
â”‚   â”‚         descripcion = models.TextField(blank=True, null=True)
â”‚   â”‚         ubicacion = models.CharField(max_length=150, blank=True, null=True)
â”‚   â”‚         capacidad = models.PositiveIntegerField(blank=True, null=True, help_text="Ej: para salas de reuniones.")
â”‚   â”‚         esta_activo = models.BooleanField(default=True, help_text="Indica si el recurso estÃ¡ disponible para ser reservado.")
â”‚   â”‚         # responsable = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, blank=True, help_text="Usuario responsable del recurso.")
â”‚   â”‚         # requiere_aprobacion = models.BooleanField(default=False, help_text="Si las reservas para este recurso necesitan aprobaciÃ³n.")
â”‚   â”‚     
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             verbose_name = "Recurso"
â”‚   â”‚             verbose_name_plural = "Recursos"
â”‚   â”‚             ordering = ['tipo_recurso', 'nombre']
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return f"{self.nombre} ({self.tipo_recurso.nombre})"
â”‚   â”‚     
â”‚   â”‚     class Reserva(models.Model):
â”‚   â”‚         class EstadoReserva(models.TextChoices):
â”‚   â”‚             PENDIENTE = 'PENDIENTE', 'Pendiente de AprobaciÃ³n'
â”‚   â”‚             APROBADA = 'APROBADA', 'Aprobada'
â”‚   â”‚             RECHAZADA = 'RECHAZADA', 'Rechazada'
â”‚   â”‚             CANCELADA = 'CANCELADA', 'Cancelada por Usuario'
â”‚   â”‚     
â”‚   â”‚         recurso = models.ForeignKey(Recurso, on_delete=models.CASCADE, related_name='reservas')
â”‚   â”‚         reservado_por = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='mis_reservas')
â”‚   â”‚         fecha_inicio = models.DateTimeField()
â”‚   â”‚         fecha_fin = models.DateTimeField()
â”‚   â”‚         motivo = models.TextField(blank=True, null=True)
â”‚   â”‚         estado = models.CharField(max_length=20, choices=EstadoReserva.choices, default=EstadoReserva.APROBADA) # Cambiar si se implementa flujo de aprobaciÃ³n
â”‚   â”‚         # aprobado_por = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, blank=True, related_name='reservas_aprobadas')
â”‚   â”‚         # fecha_aprobacion = models.DateTimeField(null=True, blank=True)
â”‚   â”‚         creado_el = models.DateTimeField(auto_now_add=True)
â”‚   â”‚     
â”‚   â”‚     
â”‚   â”‚         class Meta:
â”‚   â”‚             verbose_name = "Reserva"
â”‚   â”‚             verbose_name_plural = "Reservas"
â”‚   â”‚             ordering = ['fecha_inicio']
â”‚   â”‚             # unique_together = ('recurso', 'fecha_inicio', 'fecha_fin') # Considerar para evitar solapamientos a nivel BD, aunque es mejor validar en el form/view
â”‚   â”‚     
â”‚   â”‚         def __str__(self):
â”‚   â”‚             return f"Reserva de '{self.recurso.nombre}' por {self.reservado_por.username} ({self.fecha_inicio.strftime('%d/%m %H:%M')} - {self.fecha_fin.strftime('%d/%m %H:%M')})"
â”‚   â”‚     
â”‚   â”‚         # AquÃ­ podrÃ­as aÃ±adir un clean() method para validar que fecha_fin > fecha_inicio
â”‚   â”‚         # y para validar solapamientos de reservas para el mismo recurso.
â”‚   â”‚         # Ejemplo bÃ¡sico (se puede mejorar y hacer mÃ¡s robusto):
â”‚   â”‚         # def clean(self):
â”‚   â”‚         #     from django.core.exceptions import ValidationError
â”‚   â”‚         #     if self.fecha_inicio and self.fecha_fin and self.fecha_inicio >= self.fecha_fin:
â”‚   â”‚         #         raise ValidationError("La fecha de fin debe ser posterior a la fecha de inicio.")
â”‚   â”‚         #
â”‚   â”‚         #     # Chequear solapamientos
â”‚   â”‚         #     solapamientos = Reserva.objects.filter(
â”‚   â”‚         #         recurso=self.recurso,
â”‚   â”‚         #         fecha_inicio__lt=self.fecha_fin,
â”‚   â”‚         #         fecha_fin__gt=self.fecha_inicio
â”‚   â”‚         #     ).exclude(pk=self.pk) # Excluir la propia reserva si se estÃ¡ editando
â”‚   â”‚         #
â”‚   â”‚         #     if solapamientos.exists():
â”‚   â”‚         #         raise ValidationError(f"El recurso '{self.recurso.nombre}' ya estÃ¡ reservado en el horario solicitado.")
â”‚   â”‚   --- FIN CONTENIDO (models.py) ---

â”‚   â”œâ”€â”€ tests.py
â”‚   â”‚   ðŸ“„ (Archivo vacÃ­o)

â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (urls.py):
â”‚   â”‚     # /workspaces/intranet_gem/intranet_core/urls.py
â”‚   â”‚     from django.urls import path
â”‚   â”‚     from . import views # AsegÃºrate que esto importa tus vistas correctamente
â”‚   â”‚     
â”‚   â”‚     app_name = 'intranet_core'
â”‚   â”‚     
â”‚   â”‚     urlpatterns = [
â”‚   â”‚         path('', views.dashboard_view, name='dashboard'),
â”‚   â”‚     
â”‚   â”‚         # GestiÃ³n de Archivos
â”‚   â”‚         path('archivos/', views.carga_archivos_view, name='carga_archivos'),
â”‚   â”‚         path('archivos/carpeta/<int:carpeta_id>/', views.carga_archivos_view, name='carga_archivos_carpeta'),
â”‚   â”‚         path('archivos/ver/<int:archivo_id>/', views.ver_archivo_view, name='ver_archivo'),
â”‚   â”‚         path('archivos/editar/<int:archivo_id>/', views.editar_archivo_view, name='editar_archivo'),
â”‚   â”‚     
â”‚   â”‚         # Formularios DinÃ¡micos
â”‚   â”‚         path('formularios/', views.formularios_view, name='formularios'),
â”‚   â”‚         path('formularios/crear/', views.formulario_crear_view, name='formulario_crear'),
â”‚   â”‚         path('formularios/<int:formulario_id>/disenar/', views.formulario_disenar_view, name='formulario_disenar'),
â”‚   â”‚         path('formularios/<int:formulario_id>/llenar/', views.formulario_llenar_view, name='formulario_llenar'),
â”‚   â”‚         path('formularios/<int:formulario_id>/respuestas/', views.formulario_respuestas_view, name='formulario_respuestas'),
â”‚   â”‚         # path('formularios/<int:formulario_id>/editar/', views.formulario_editar_view, name='formulario_editar_config'),
â”‚   â”‚         # path('formularios/<int:formulario_id>/eliminar/', views.formulario_eliminar_view, name='formulario_eliminar'),
â”‚   â”‚     
â”‚   â”‚         # Calendario de Actividades
â”‚   â”‚         path('calendario/', views.calendario_view, name='calendario'),
â”‚   â”‚         path('calendario/eventos.json/', views.calendario_eventos_json_view, name='calendario_eventos_json'),
â”‚   â”‚         path('calendario/evento/crear/', views.evento_calendario_crear_view, name='evento_calendario_crear'),
â”‚   â”‚         path('calendario/evento/<int:evento_id>/', views.evento_calendario_detalle_view, name='evento_calendario_detalle'),
â”‚   â”‚         path('calendario/evento/<int:evento_id>/editar/', views.evento_calendario_editar_view, name='evento_calendario_editar'),
â”‚   â”‚         path('calendario/evento/<int:evento_id>/eliminar/', views.evento_calendario_eliminar_view, name='evento_calendario_eliminar'),
â”‚   â”‚     
â”‚   â”‚         # GestiÃ³n de Responsabilidades (Tareas)
â”‚   â”‚         path('responsabilidades/', views.responsabilidades_view, name='responsabilidades'),
â”‚   â”‚         path('responsabilidades/crear/', views.tarea_crear_view, name='tarea_crear'),
â”‚   â”‚         path('responsabilidades/<int:tarea_id>/', views.tarea_detalle_view, name='tarea_detalle'),
â”‚   â”‚         path('responsabilidades/<int:tarea_id>/editar/', views.tarea_editar_view, name='tarea_editar'),
â”‚   â”‚         path('responsabilidades/<int:tarea_id>/eliminar/', views.tarea_eliminar_view, name='tarea_eliminar'),
â”‚   â”‚     
â”‚   â”‚         # Directorio de Usuarios
â”‚   â”‚         path('directorio/', views.directorio_view, name='directorio'),
â”‚   â”‚         path('directorio/usuario/<str:username>/', views.directorio_usuario_detalle_view, name='directorio_usuario_detalle'),
â”‚   â”‚     
â”‚   â”‚         # Reserva de Recursos
â”‚   â”‚         path('reservas/', views.reservas_view, name='reservas'),
â”‚   â”‚         path('reservas/eventos.json/', views.reservas_eventos_json_view, name='reservas_eventos_json'),
â”‚   â”‚         path('reservas/crear/', views.reserva_crear_view, name='reserva_crear'),
â”‚   â”‚         path('reservas/crear/<int:recurso_id>/', views.reserva_crear_view, name='reserva_crear_para_recurso'),
â”‚   â”‚     
â”‚   â”‚         # Wiki
â”‚   â”‚         path('wiki/', views.wiki_view, name='wiki'),
â”‚   â”‚         path('wiki/crear/', views.wiki_crear_articulo_view, name='wiki_crear_articulo'),
â”‚   â”‚         path('wiki/<slug:slug>/', views.wiki_articulo_detalle_view, name='wiki_articulo_detalle'),
â”‚   â”‚         path('wiki/<slug:slug>/editar/', views.wiki_editar_articulo_view, name='wiki_editar_articulo'),
â”‚   â”‚         path('wiki/<slug:slug>/eliminar/', views.wiki_eliminar_articulo_view, name='wiki_eliminar_articulo'),
â”‚   â”‚     
â”‚   â”‚         # Notificaciones
â”‚   â”‚         path('notificaciones/', views.notificaciones_page_view, name='notificaciones_page'),
â”‚   â”‚         path('notificaciones/marcar-leida/<int:notificacion_id>/', views.marcar_notificacion_leida_view, name='marcar_notificacion_leida'),
â”‚   â”‚         path('notificaciones/marcar-todas-leidas/', views.marcar_todas_notificaciones_leidas_view, name='marcar_todas_notificaciones_leidas'),
â”‚   â”‚     
â”‚   â”‚         # Perfil y ConfiguraciÃ³n de Usuario
â”‚   â”‚         path('perfil/', views.perfil_view, name='perfil'),
â”‚   â”‚         path('configuracion/', views.configuracion_view, name='configuracion'),
â”‚   â”‚     
â”‚   â”‚         # GestiÃ³n de Usuarios (Staff)
â”‚   â”‚         path('gestion-usuarios/', views.usuarios_gestion_view, name='usuarios_gestion'),
â”‚   â”‚         path('gestion-usuarios/<int:user_id>/editar/', views.usuario_gestion_editar_view, name='usuario_gestion_editar'),
â”‚   â”‚     ]
â”‚   â”‚   --- FIN CONTENIDO (urls.py) ---

â”‚   â””â”€â”€ views.py
â”‚       ðŸ“„ CONTENIDO DEL ARCHIVO (views.py):
â”‚         # intranet_core/views.py
â”‚         import os
â”‚         import mimetypes
â”‚         from django.shortcuts import render, redirect, get_object_or_404
â”‚         from django.contrib.auth.decorators import login_required, user_passes_test
â”‚         from django.contrib.auth.mixins import LoginRequiredMixin, UserPassesTestMixin # Para Class-Based Views
â”‚         from django.views import View # Para Class-Based Views
â”‚         from django.contrib import messages
â”‚         from django.http import JsonResponse, FileResponse, HttpResponse, Http404, HttpResponseForbidden, HttpResponseRedirect
â”‚         from django.urls import reverse, reverse_lazy
â”‚         from django.db.models import Q
â”‚         from django.utils import timezone # Para manejo de fechas
â”‚         from django.contrib.auth import update_session_auth_hash # Para cambio de contraseÃ±a
â”‚         from django.contrib.auth.forms import PasswordChangeForm
â”‚         from django.contrib.auth.models import User, Group # Para gestiÃ³n de usuarios
â”‚         from django.core.paginator import Paginator, EmptyPage, PageNotAnInteger
â”‚         from django.forms import modelformset_factory # Cambiamos a modelformset_factory para mejor manejo de instancias
â”‚         from django.shortcuts import render, redirect, get_object_or_404
â”‚         import json
â”‚         # Modelos
â”‚         from .models import (
â”‚             Archivo, Carpeta, ArticuloWiki, Notificacion,
â”‚             Formulario, CampoFormulario, RespuestaFormulario, DatoRespuesta,
â”‚             EventoCalendario,
â”‚             Tarea,
â”‚             PerfilUsuario,
â”‚             TipoRecurso, Recurso, Reserva
â”‚         )
â”‚         
â”‚         # Formularios
â”‚         from .forms import (
â”‚             ArchivoForm, CarpetaForm, ArchivoEditForm, ArticuloWikiForm,
â”‚             FormularioModelForm, CampoFormularioModelForm,
â”‚             EventoCalendarioModelForm,
â”‚             TareaModelForm,
â”‚             PerfilUsuarioModelForm, UserUpdateForm, # Para perfil de usuario
â”‚             ReservaModelForm, UserEditStaffForm # UserEditStaffForm aÃ±adido
â”‚         )
â”‚         from django.forms import formset_factory, modelformset_factory # Para CampoFormulario
â”‚         
â”‚         # --- Funciones Auxiliares ---
â”‚         def es_staff(user):
â”‚             return user.is_staff
â”‚         
â”‚         def crear_notificacion_global(usuario_destinatario, mensaje, url_destino_nombre=None, url_destino_args=None, url_destino_kwargs=None):
â”‚             url = None
â”‚             if url_destino_nombre:
â”‚                 try:
â”‚                     # Asegurar que args y kwargs sean iterables o diccionarios, incluso si son None
â”‚                     args_to_pass = url_destino_args if url_destino_args is not None else []
â”‚                     kwargs_to_pass = url_destino_kwargs if url_destino_kwargs is not None else {}
â”‚                     url = reverse(url_destino_nombre, args=args_to_pass, kwargs=kwargs_to_pass)
â”‚                 except Exception as e:
â”‚                     print(f"Error al generar URL para notificaciÃ³n: {e}")
â”‚             Notificacion.objects.create(destinatario=usuario_destinatario, mensaje=mensaje, url_destino=url)
â”‚         
â”‚         @login_required
â”‚         def dashboard_view(request):
â”‚             numero_total_archivos = Archivo.objects.filter(subido_por=request.user).count()
â”‚             numero_total_carpetas = Carpeta.objects.filter(subido_por=request.user).count()
â”‚             notificaciones_no_leidas_count = Notificacion.objects.filter(destinatario=request.user, leida=False).count()
â”‚             
â”‚             # Nuevas estadÃ­sticas (ejemplos)
â”‚             tareas_pendientes_count = Tarea.objects.filter(asignado_a=request.user, estado__in=[Tarea.EstadoTarea.PENDIENTE, Tarea.EstadoTarea.EN_PROGRESO]).count()
â”‚             eventos_proximos_count = EventoCalendario.objects.filter(
â”‚                 Q(creado_por=request.user) | Q(participantes=request.user) if hasattr(EventoCalendario, 'participantes') else Q(creado_por=request.user), # Ajustar si tienes M2M 'participantes'
â”‚                 fecha_inicio__gte=timezone.now(),
â”‚                 fecha_inicio__lte=timezone.now() + timezone.timedelta(days=7)
â”‚             ).count()
â”‚         
â”‚         
â”‚             context = {
â”‚                 'page_title_for_header': 'Panel Principal',
â”‚                 'active_nav': 'dashboard',
â”‚                 'numero_archivos_totales': numero_total_archivos,
â”‚                 'numero_carpetas_totales': numero_total_carpetas,
â”‚                 'numero_formularios_creados': Formulario.objects.filter(creado_por=request.user).count(), # Actualizado
â”‚                 'numero_notificaciones_nuevas': notificaciones_no_leidas_count,
â”‚                 'numero_responsabilidades': tareas_pendientes_count, # Actualizado
â”‚                 'eventos_proximos_count': eventos_proximos_count,
â”‚             }
â”‚             return render(request, 'intranet_core/dashboard.html', context)
â”‚         
â”‚         @login_required
â”‚         def carga_archivos_view(request, carpeta_id=None): # Modificado para aceptar carpeta_id
â”‚             form_carga_archivo_instance = ArchivoForm(user=request.user)
â”‚             form_crear_carpeta_instance = CarpetaForm()
â”‚             
â”‚             current_folder = None
â”‚             if carpeta_id:
â”‚                 current_folder = get_object_or_404(Carpeta, id=carpeta_id, subido_por=request.user)
â”‚         
â”‚             if request.method == 'POST':
â”‚                 action = request.POST.get('action')
â”‚                 is_ajax = request.headers.get('X-Requested-With') == 'XMLHttpRequest'
â”‚         
â”‚                 if action == 'create_folder':
â”‚                     form_crear_carpeta_instance = CarpetaForm(request.POST)
â”‚                     if form_crear_carpeta_instance.is_valid():
â”‚                         nueva_carpeta = form_crear_carpeta_instance.save(commit=False)
â”‚                         nueva_carpeta.subido_por = request.user
â”‚                         # nueva_carpeta.carpeta_padre = current_folder # Si implementas subcarpetas
â”‚                         try:
â”‚                             nueva_carpeta.save()
â”‚                             messages.success(request, f"Carpeta '{nueva_carpeta.nombre}' creada exitosamente.")
â”‚                             # Redirigir a la carpeta actual si existe, sino a la raÃ­z
â”‚                             return redirect('intranet_core:carga_archivos', carpeta_id=current_folder.id) if current_folder else redirect('intranet_core:carga_archivos')
â”‚                         except Exception as e: # Captura IntegrityError por unique_together
â”‚                             messages.error(request, f"Error al crear la carpeta: El nombre '{nueva_carpeta.nombre}' ya existe en esta ubicaciÃ³n o hubo otro problema.")
â”‚                     else:
â”‚                         messages.error(request, "No se pudo crear la carpeta. Revisa los errores en el formulario.")
â”‚                 
â”‚                 elif action == 'delete_file':
â”‚                     file_id_to_delete = request.POST.get('file_id')
â”‚                     try:
â”‚                         archivo_a_eliminar = Archivo.objects.get(id=file_id_to_delete, subido_por=request.user)
â”‚                         nombre_archivo_eliminado = archivo_a_eliminar.nombre_descriptivo or archivo_a_eliminar.nombre_original_archivo
â”‚                         archivo_a_eliminar.delete()
â”‚                         if is_ajax:
â”‚                             return JsonResponse({
â”‚                                 'status': 'success',
â”‚                                 'message': f"Archivo '{nombre_archivo_eliminado}' eliminado correctamente.",
â”‚                                 'file_id': file_id_to_delete
â”‚                             })
â”‚                         messages.success(request, f"Archivo '{nombre_archivo_eliminado}' eliminado correctamente.")
â”‚                     except Archivo.DoesNotExist:
â”‚                         if is_ajax:
â”‚                             return JsonResponse({'status': 'error', 'message': "Archivo no encontrado o sin permiso para eliminar."}, status=404)
â”‚                         messages.error(request, "Archivo no encontrado o sin permiso para eliminar.")
â”‚                     except Exception as e:
â”‚                         error_message_user = "OcurriÃ³ un error al intentar eliminar el archivo."
â”‚                         print(f"Error en delete_file: {str(e)}")
â”‚                         if is_ajax:
â”‚                             return JsonResponse({'status': 'error', 'message': error_message_user}, status=500)
â”‚                         messages.error(request, error_message_user)
â”‚                     
â”‚                     if not is_ajax: # Redirigir a la carpeta actual si existe, sino a la raÃ­z
â”‚                         return redirect('intranet_core:carga_archivos', carpeta_id=current_folder.id) if current_folder else redirect('intranet_core:carga_archivos')
â”‚         
â”‚                 else: # Asumimos subida de archivo
â”‚                     form_carga_archivo_instance = ArchivoForm(request.POST, request.FILES, user=request.user)
â”‚                     if form_carga_archivo_instance.is_valid():
â”‚                         archivo_instancia = form_carga_archivo_instance.save(commit=False)
â”‚                         archivo_instancia.subido_por = request.user
â”‚                         if request.FILES.get('archivo_subido'):
â”‚                             archivo_instancia.nombre_original_archivo = request.FILES['archivo_subido'].name
â”‚                         
â”‚                         # Asignar a la carpeta actual si estamos dentro de una
â”‚                         if current_folder:
â”‚                             archivo_instancia.carpeta = current_folder
â”‚                         # Si no, se asigna a la carpeta seleccionada en el formulario, o a la raÃ­z si no se selecciona ninguna.
â”‚                         # Esto es manejado por el 'empty_label' del ArchivoForm y la lÃ³gica del SET_NULL
â”‚         
â”‚                         archivo_instancia.save()
â”‚                         messages.success(request, f"Archivo '{archivo_instancia.nombre_descriptivo or archivo_instancia.nombre_original_archivo}' subido exitosamente.")
â”‚                         return redirect('intranet_core:carga_archivos', carpeta_id=current_folder.id) if current_folder else redirect('intranet_core:carga_archivos')
â”‚                     else:
â”‚                         messages.error(request, "Error al subir el archivo. Por favor, revise los campos.")
â”‚                         
â”‚             # Filtrar carpetas y archivos segÃºn la carpeta actual
â”‚             if current_folder:
â”‚                 carpetas_a_mostrar = Carpeta.objects.filter(subido_por=request.user, carpeta_padre=current_folder).order_by('nombre') # Si usas carpeta_padre
â”‚                 archivos_a_mostrar = Archivo.objects.filter(subido_por=request.user, carpeta=current_folder).order_by('-fecha_subida')
â”‚             else: # RaÃ­z
â”‚                 carpetas_a_mostrar = Carpeta.objects.filter(subido_por=request.user, carpeta_padre__isnull=True).order_by('nombre') # Si usas carpeta_padre
â”‚                 archivos_a_mostrar = Archivo.objects.filter(subido_por=request.user, carpeta__isnull=True).order_by('-fecha_subida')
â”‚         
â”‚             # Breadcrumbs (ejemplo bÃ¡sico)
â”‚             breadcrumbs = []
â”‚             temp_folder = current_folder
â”‚             while temp_folder:
â”‚                 breadcrumbs.insert(0, {'nombre': temp_folder.nombre, 'id': temp_folder.id})
â”‚                 temp_folder = temp_folder.carpeta_padre # Si usas carpeta_padre
â”‚             
â”‚             context = {
â”‚                 'page_title_for_header': f'Gestor de Archivos{" / " + current_folder.nombre if current_folder else ""}',
â”‚                 'active_nav': 'archivos',
â”‚                 'form_carga_archivo': form_carga_archivo_instance,
â”‚                 'form_crear_carpeta': form_crear_carpeta_instance,
â”‚                 'carpetas': carpetas_a_mostrar, # Ajustar si se implementan subcarpetas
â”‚                 'archivos_subidos': archivos_a_mostrar,
â”‚                 'current_folder': current_folder,
â”‚                 'breadcrumbs': breadcrumbs,
â”‚             }
â”‚             return render(request, 'intranet_core/carga_archivos.html', context)
â”‚         
â”‚         
â”‚         @login_required
â”‚         def editar_archivo_view(request, archivo_id):
â”‚             archivo = get_object_or_404(Archivo, id=archivo_id, subido_por=request.user)
â”‚             nombre_original_previo = archivo.nombre_original_archivo
â”‚             path_previo = archivo.archivo_subido.path if archivo.archivo_subido else None
â”‚         
â”‚             if request.method == 'POST':
â”‚                 form = ArchivoEditForm(request.POST, request.FILES, instance=archivo, user=request.user)
â”‚                 if form.is_valid():
â”‚                     archivo_editado = form.save(commit=False)
â”‚                     if request.FILES.get('archivo_subido'): # Si se subiÃ³ un nuevo archivo
â”‚                         # Eliminar el archivo fÃ­sico antiguo si existe y es diferente del nuevo
â”‚                         if path_previo and os.path.isfile(path_previo) and path_previo != archivo_editado.archivo_subido.path :
â”‚                             try:
â”‚                                 os.remove(path_previo)
â”‚                             except OSError as e:
â”‚                                 print(f"Error eliminando archivo antiguo {path_previo}: {e}")
â”‚                         archivo_editado.nombre_original_archivo = request.FILES['archivo_subido'].name
â”‚                     else: # Si no se subiÃ³ un nuevo archivo, mantener el existente
â”‚                         archivo_editado.archivo_subido = archivo.archivo_subido # Corregido el typo
â”‚                         archivo_editado.nombre_original_archivo = nombre_original_previo
â”‚                     
â”‚                     archivo_editado.save()
â”‚                     form.save_m2m() # Si hubiera campos M2M
â”‚                     messages.success(request, f"Archivo '{archivo_editado.nombre_descriptivo or archivo_editado.nombre_original_archivo}' actualizado.")
â”‚                     return redirect('intranet_core:carga_archivos', carpeta_id=archivo.carpeta.id if archivo.carpeta else None)
â”‚             else:
â”‚                 form = ArchivoEditForm(instance=archivo, user=request.user)
â”‚             
â”‚             context = {
â”‚                 'page_title_for_header': f'Editar Archivo: {archivo.nombre_descriptivo or archivo.nombre_original_archivo}',
â”‚                 'active_nav': 'archivos',
â”‚                 'form': form,
â”‚                 'archivo': archivo,
â”‚             }
â”‚             return render(request, 'intranet_core/editar_archivo.html', context)
â”‚         
â”‚         @login_required
â”‚         def ver_archivo_view(request, archivo_id):
â”‚             archivo = get_object_or_404(Archivo, id=archivo_id)
â”‚             # PodrÃ­as aÃ±adir lÃ³gica de permisos mÃ¡s compleja aquÃ­ (ej. si el archivo es compartido)
â”‚             if archivo.subido_por != request.user and not request.user.is_staff: # Ejemplo: staff puede ver todos
â”‚                 return HttpResponseForbidden("No tienes permiso para ver este archivo.")
â”‚             if not archivo.archivo_subido or not archivo.archivo_subido.path:
â”‚                 raise Http404("El archivo no tiene un fichero fÃ­sico asociado o la ruta no es vÃ¡lida.")
â”‚             try:
â”‚                 file_path = archivo.archivo_subido.path
â”‚                 if not os.path.exists(file_path):
â”‚                     raise Http404("Archivo fÃ­sico no encontrado en el servidor.")
â”‚         
â”‚                 content_type, encoding = mimetypes.guess_type(file_path)
â”‚                 content_type = content_type or 'application/octet-stream'
â”‚                 
â”‚                 if archivo.is_viewable_in_browser():
â”‚                     # Para archivos de texto, leer y mostrar como HttpResponse para evitar problemas de codificaciÃ³n con FileResponse
â”‚                     if archivo.get_file_extension() in ['.txt', '.md', '.py', '.js', '.json', '.css', '.html', '.xml']:
â”‚                         with open(file_path, 'r', encoding='utf-8', errors='replace') as f:
â”‚                             content = f.read()
â”‚                         return HttpResponse(content, content_type=f"{content_type}; charset=utf-8")
â”‚                     return FileResponse(open(file_path, 'rb'), content_type=content_type, as_attachment=False)
â”‚                 else:
â”‚                     return FileResponse(open(file_path, 'rb'), as_attachment=True, filename=archivo.nombre_original_archivo)
â”‚             except FileNotFoundError:
â”‚                 raise Http404("Archivo no encontrado en el servidor.")
â”‚             except Exception as e:
â”‚                 print(f"Error al intentar ver el archivo {archivo_id}: {e}")
â”‚                 messages.error(request, "No se pudo mostrar el archivo debido a un error.")
â”‚                 return redirect('intranet_core:carga_archivos') # O a donde sea apropiado
â”‚         
â”‚         # --- Vistas de Wiki (ya estaban bastante completas) ---
â”‚         @login_required
â”‚         def wiki_view(request):
â”‚             search_query = request.GET.get('q', '')
â”‚             articulos_qs = ArticuloWiki.objects.all()
â”‚             if search_query:
â”‚                 articulos_qs = articulos_qs.filter(
â”‚                     Q(titulo__icontains=search_query) | Q(contenido__icontains=search_query)
â”‚                 )
â”‚                 if not articulos_qs.exists():
â”‚                     messages.info(request, f"No se encontraron artÃ­culos para: '{search_query}'.")
â”‚                 else:
â”‚                     messages.success(request, f"Mostrando resultados para: '{search_query}'.")
â”‚             
â”‚             articulos = articulos_qs.order_by('-actualizado_el', 'titulo')
â”‚             context = {
â”‚                 'page_title_for_header': 'Base de Conocimiento (Wiki)',
â”‚                 'active_nav': 'wiki',
â”‚                 'articulos': articulos,
â”‚                 'search_query': search_query,
â”‚             }
â”‚             return render(request, 'intranet_core/wiki_lista.html', context)
â”‚         
â”‚         @login_required
â”‚         def wiki_articulo_detalle_view(request, slug):
â”‚             articulo = get_object_or_404(ArticuloWiki, slug=slug)
â”‚             html_content = ""
â”‚             try:
â”‚                 import markdown
â”‚                 extensions = ['fenced_code', 'tables', 'attr_list', 'md_in_html', 'codehilite', 'toc']
â”‚                 md = markdown.Markdown(extensions=extensions, extension_configs={'codehilite': {'css_class': 'codehilite'}})
â”‚                 html_content = md.convert(articulo.contenido)
â”‚                 toc = getattr(md, 'toc', '') if 'toc' in extensions else '' # Extraer TOC si la extensiÃ³n estÃ¡ habilitada
â”‚             except ImportError:
â”‚                 html_content = f"<p class='text-red-500'>La librerÃ­a 'markdown' no estÃ¡ instalada. Por favor, instÃ¡lala (<code>pip install markdown pygments</code>) para ver el contenido formateado.</p><pre>{articulo.contenido}</pre>"
â”‚                 messages.warning(request, "La librerÃ­a Markdown (y Pygments para resaltado) no estÃ¡ instalada.")
â”‚                 toc = ''
â”‚             except Exception as e:
â”‚                 html_content = f"<p class='text-red-500'>Error renderizando Markdown: {e}</p><pre>{articulo.contenido}</pre>"
â”‚                 messages.error(request, f"Error al renderizar el contenido Markdown: {e}")
â”‚                 toc = ''
â”‚             
â”‚             context = {
â”‚                 'page_title_for_header': articulo.titulo,
â”‚                 'active_nav': 'wiki',
â”‚                 'articulo': articulo,
â”‚                 'html_content': html_content,
â”‚                 'toc_content': toc, # Pasar el TOC al template
â”‚             }
â”‚             return render(request, 'intranet_core/wiki_articulo_detalle.html', context)
â”‚         
â”‚         @login_required
â”‚         def wiki_crear_articulo_view(request):
â”‚             if request.method == 'POST':
â”‚                 form = ArticuloWikiForm(request.POST)
â”‚                 if form.is_valid():
â”‚                     articulo = form.save(commit=False)
â”‚                     articulo.autor = request.user
â”‚                     articulo.save() 
â”‚                     messages.success(request, f"ArtÃ­culo '{articulo.titulo}' creado exitosamente.")
â”‚                     crear_notificacion_global(
â”‚                         usuario_destinatario=request.user, 
â”‚                         mensaje=f"Nuevo artÃ­culo en la Wiki: '{articulo.titulo}' por {request.user.username}.",
â”‚                         url_destino_nombre='intranet_core:wiki_articulo_detalle',
â”‚                         url_destino_kwargs={'slug': articulo.slug} # Usar el nombre correcto del parÃ¡metro
â”‚                     )
â”‚                     return redirect(articulo.get_absolute_url())
â”‚             else:
â”‚                 form = ArticuloWikiForm()
â”‚             
â”‚             context = {
â”‚                 'page_title_for_header': 'Crear Nuevo ArtÃ­culo Wiki',
â”‚                 'active_nav': 'wiki',
â”‚                 'form': form,
â”‚                 'edit_mode': False,
â”‚             }
â”‚             return render(request, 'intranet_core/wiki_articulo_form.html', context)
â”‚         
â”‚         @login_required
â”‚         def wiki_editar_articulo_view(request, slug):
â”‚             articulo = get_object_or_404(ArticuloWiki, slug=slug)
â”‚             if articulo.autor != request.user and not request.user.is_staff:
â”‚                 messages.error(request, "No tienes permiso para editar este artÃ­culo.")
â”‚                 return redirect(articulo.get_absolute_url())
â”‚             
â”‚             if request.method == 'POST':
â”‚                 form = ArticuloWikiForm(request.POST, instance=articulo)
â”‚                 if form.is_valid():
â”‚                     form.save()
â”‚                     messages.success(request, f"ArtÃ­culo '{articulo.titulo}' actualizado exitosamente.")
â”‚                     return redirect(articulo.get_absolute_url())
â”‚             else:
â”‚                 form = ArticuloWikiForm(instance=articulo)
â”‚             
â”‚             context = {
â”‚                 'page_title_for_header': f'Editar: {articulo.titulo}',
â”‚                 'active_nav': 'wiki',
â”‚                 'form': form,
â”‚                 'articulo': articulo,
â”‚                 'edit_mode': True,
â”‚             }
â”‚             return render(request, 'intranet_core/wiki_articulo_form.html', context)
â”‚         
â”‚         @login_required
â”‚         def wiki_eliminar_articulo_view(request, slug):
â”‚             articulo = get_object_or_404(ArticuloWiki, slug=slug)
â”‚             if articulo.autor != request.user and not request.user.is_staff:
â”‚                 messages.error(request, "No tienes permiso para eliminar este artÃ­culo.")
â”‚                 return redirect(articulo.get_absolute_url())
â”‚             
â”‚             if request.method == 'POST':
â”‚                 titulo_articulo = articulo.titulo
â”‚                 articulo.delete()
â”‚                 messages.success(request, f"ArtÃ­culo '{titulo_articulo}' eliminado exitosamente.")
â”‚                 return redirect('intranet_core:wiki')
â”‚             
â”‚             context = {
â”‚                 'page_title_for_header': f'Confirmar EliminaciÃ³n: {articulo.titulo}',
â”‚                 'active_nav': 'wiki',
â”‚                 'articulo': articulo
â”‚             }
â”‚             return render(request, 'intranet_core/wiki_articulo_confirm_delete.html', context)
â”‚         
â”‚         # --- Vistas de Notificaciones (ya estaban bastante completas) ---
â”‚         @login_required
â”‚         def notificaciones_page_view(request):
â”‚             notificaciones_no_leidas = Notificacion.objects.filter(destinatario=request.user, leida=False).order_by('-fecha_creacion')
â”‚             notificaciones_leidas = Notificacion.objects.filter(destinatario=request.user, leida=True).order_by('-fecha_creacion')[:20] # Limitar historial
â”‚             context = {
â”‚                 'page_title_for_header': 'Notificaciones y Anuncios',
â”‚                 'active_nav': 'notificaciones_page',
â”‚                 'notificaciones_no_leidas': notificaciones_no_leidas,
â”‚                 'notificaciones_leidas': notificaciones_leidas,
â”‚             }
â”‚             return render(request, 'intranet_core/notificaciones_page.html', context)
â”‚         
â”‚         @login_required
â”‚         def marcar_notificacion_leida_view(request, notificacion_id):
â”‚             notificacion = get_object_or_404(Notificacion, id=notificacion_id, destinatario=request.user)
â”‚             notificacion.leida = True
â”‚             notificacion.save()
â”‚             if request.headers.get('X-Requested-With') == 'XMLHttpRequest':
â”‚                 return JsonResponse({'status': 'success', 'message': 'NotificaciÃ³n marcada como leÃ­da.'})
â”‚             if notificacion.url_destino:
â”‚                 return redirect(notificacion.url_destino)
â”‚             return redirect(request.GET.get('next', reverse('intranet_core:notificaciones_page')))
â”‚         
â”‚         
â”‚         @login_required
â”‚         def marcar_todas_notificaciones_leidas_view(request):
â”‚             if request.method == 'POST': # Asegurar que sea por POST
â”‚                 Notificacion.objects.filter(destinatario=request.user, leida=False).update(leida=True)
â”‚                 messages.success(request, "Todas las notificaciones han sido marcadas como leÃ­das.")
â”‚             return redirect('intranet_core:notificaciones_page')
â”‚         
â”‚         # --- ImplementaciÃ³n de Vistas Placeholder ---
â”‚         
â”‚         # 1. MÃ³dulo de Formularios
â”‚         @login_required
â”‚         def formularios_view(request): # Lista de formularios creados por el usuario
â”‚             formularios_usuario = Formulario.objects.filter(creado_por=request.user).order_by('-creado_el')
â”‚             context = {
â”‚                 'page_title_for_header': 'Mis Formularios',
â”‚                 'active_nav': 'formularios',
â”‚                 'formularios': formularios_usuario,
â”‚             }
â”‚             return render(request, 'intranet_core/formularios_lista.html', context) # Nuevo template
â”‚         
â”‚         @login_required
â”‚         def formulario_crear_view(request):
â”‚             if request.method == 'POST':
â”‚                 form = FormularioModelForm(request.POST) # Asume que tienes este form en forms.py
â”‚                 if form.is_valid():
â”‚                     formulario = form.save(commit=False)
â”‚                     formulario.creado_por = request.user
â”‚                     formulario.save()
â”‚                     messages.success(request, f"Formulario '{formulario.titulo}' creado. Ahora puedes aÃ±adir campos.")
â”‚                     return redirect('intranet_core:formulario_disenar', formulario_id=formulario.id) # Redirigir a diseÃ±ar
â”‚             else:
â”‚                 form = FormularioModelForm()
â”‚             context = {
â”‚                 'page_title_for_header': 'Crear Nuevo Formulario',
â”‚                 'active_nav': 'formularios',
â”‚                 'form': form,
â”‚             }
â”‚             return render(request, 'intranet_core/formulario_crear.html', context) # Nuevo template
â”‚         
â”‚         @login_required
â”‚         def formulario_disenar_view(request, formulario_id):
â”‚             formulario = get_object_or_404(Formulario, id=formulario_id, creado_por=request.user)
â”‚             
â”‚             CampoFormSet = modelformset_factory(
â”‚                 CampoFormulario,
â”‚                 form=CampoFormularioModelForm,
â”‚                 fields=['etiqueta', 'tipo_campo', 'ayuda_texto', 'es_obligatorio', 'opciones_choices', 'orden'],
â”‚                 extra=0,
â”‚                 can_delete=True,
â”‚                 can_order=False
â”‚             )
â”‚         
â”‚             if request.method == 'POST':
â”‚                 formset = CampoFormSet(request.POST, request.FILES, queryset=formulario.campos.all().order_by('orden'), prefix='campos')
â”‚                 
â”‚                 if formset.is_valid():
â”‚                     instances_to_save = []
â”‚                     
â”‚                     for form_idx, form in enumerate(formset.forms):
â”‚                         if formset.can_delete and form.cleaned_data.get('DELETE', False):
â”‚                             if form.instance.pk:
â”‚                                 form.instance.delete()
â”‚                             continue 
â”‚                         if form.has_changed() or not form.instance.pk: # Guardar si cambiÃ³ o es nuevo (y no estÃ¡ marcado para eliminar)
â”‚                             # Asegurar que la instancia tiene el formulario padre asignado antes de aÃ±adirla
â”‚                             form.instance.formulario = formulario 
â”‚                             instances_to_save.append(form.instance)
â”‚                     
â”‚                     current_order = 0
â”‚                     for instance in instances_to_save:
â”‚                         instance.orden = current_order
â”‚                         instance.save() 
â”‚                         current_order += 1
â”‚                     
â”‚                     messages.success(request, f"Campos del formulario '{formulario.titulo}' actualizados exitosamente.")
â”‚                     return redirect('intranet_core:formulario_disenar', formulario_id=formulario.id)
â”‚                 else:
â”‚                     messages.error(request, "Por favor corrige los errores en los campos del formulario.")
â”‚                     # Para depuraciÃ³n en consola del servidor:
â”‚                     # for i, form_errors in enumerate(formset.errors):
â”‚                     #     if form_errors:
â”‚                     #         print(f"Errores en el subformulario de campo {i}: {form_errors}")
â”‚                     # if formset.non_form_errors():
â”‚                     #     print(f"Errores generales del formset: {formset.non_form_errors()}")
â”‚         
â”‚             else: # GET request
â”‚                 formset = CampoFormSet(queryset=formulario.campos.all().order_by('orden'), prefix='campos')
â”‚         
â”‚             context = {
â”‚                 'page_title_for_header': f'DiseÃ±ar Formulario: {formulario.titulo}',
â”‚                 'active_nav': 'formularios',
â”‚                 'formulario': formulario,
â”‚                 'formset': formset,
â”‚                 'campo_tipos': CampoFormulario.TipoCampo.choices,
â”‚                 # Cambio aquÃ­: Convertir a string JSON en la vista
â”‚                 'campo_tipos_json_string': json.dumps(dict(CampoFormulario.TipoCampo.choices)) 
â”‚             }
â”‚             return render(request, 'intranet_core/formulario_disenar.html', context)
â”‚         
â”‚         @login_required
â”‚         def formulario_llenar_view(request, formulario_id):
â”‚             formulario = get_object_or_404(Formulario, id=formulario_id, activo=True)
â”‚             # AquÃ­ construirÃ­as un formulario dinÃ¡micamente basado en `formulario.campos.all()`
â”‚             # Esto es complejo y generalmente se hace iterando los campos en el template y creando los inputs.
â”‚             # El procesamiento del POST requerirÃ¡ guardar una `RespuestaFormulario` y mÃºltiples `DatoRespuesta`.
â”‚             # Por simplicidad, este es un placeholder mÃ¡s detallado:
â”‚             if request.method == 'POST':
â”‚                 # LÃ³gica para procesar los datos de cada campo
â”‚                 respuesta = RespuestaFormulario.objects.create(formulario=formulario, respondido_por=request.user)
â”‚                 for campo in formulario.campos.all():
â”‚                     valor_campo = request.POST.get(f'campo_{campo.id}')
â”‚                     if valor_campo is not None: # O manejar casillas de verificaciÃ³n mÃºltiples
â”‚                         DatoRespuesta.objects.create(respuesta_formulario=respuesta, campo_formulario=campo, valor=valor_campo)
â”‚                 messages.success(request, f"Gracias por completar el formulario '{formulario.titulo}'.")
â”‚                 return redirect('intranet_core:dashboard') # O a una pÃ¡gina de agradecimiento
â”‚                 
â”‚             context = {
â”‚                 'page_title_for_header': f'Llenar: {formulario.titulo}',
â”‚                 'active_nav': 'formularios', # O ninguna si es una pÃ¡gina pÃºblica
â”‚                 'formulario': formulario,
â”‚                 'campos': formulario.campos.all().order_by('orden')
â”‚             }
â”‚             return render(request, 'intranet_core/formulario_llenar.html', context) # Nuevo template
â”‚         
â”‚         @login_required
â”‚         def formulario_respuestas_view(request, formulario_id):
â”‚             formulario = get_object_or_404(Formulario, id=formulario_id)
â”‚             # Permitir solo al creador o staff ver respuestas
â”‚             if not (request.user == formulario.creado_por or request.user.is_staff):
â”‚                 return HttpResponseForbidden("No tienes permiso para ver estas respuestas.")
â”‚             respuestas_qs = RespuestaFormulario.objects.filter(formulario=formulario).prefetch_related('datos', 'datos__campo_formulario')
â”‚             # PaginaciÃ³n para muchas respuestas
â”‚             paginator = Paginator(respuestas_qs, 20)  # 20 por pÃ¡gina
â”‚             page = request.GET.get('page')
â”‚             try:
â”‚                 respuestas = paginator.page(page)
â”‚             except PageNotAnInteger:
â”‚                 respuestas = paginator.page(1)
â”‚             except EmptyPage:
â”‚                 respuestas = paginator.page(paginator.num_pages)
â”‚             context = {
â”‚                 'page_title_for_header': f'Respuestas para: {formulario.titulo}',
â”‚                 'active_nav': 'formularios',
â”‚                 'formulario': formulario,
â”‚                 'respuestas': respuestas,
â”‚             }
â”‚             return render(request, 'intranet_core/formulario_respuestas.html', context) # Nuevo template
â”‚         
â”‚         # 2. MÃ³dulo de Calendario
â”‚         @login_required
â”‚         def calendario_view(request):
â”‚             # Esta vista puede renderizar la pÃ¡gina principal del calendario.
â”‚             # Los eventos se cargarÃ­an vÃ­a AJAX o se pasarÃ­an directamente si no son demasiados.
â”‚             eventos = EventoCalendario.objects.filter(Q(creado_por=request.user) | Q(participantes=request.user) if hasattr(EventoCalendario, 'participantes') else Q(creado_por=request.user)).distinct() # Ejemplo
â”‚             context = {
â”‚                 'page_title_for_header': 'Calendario de Actividades',
â”‚                 'active_nav': 'calendario',
â”‚                 'eventos_json_url': reverse('intranet_core:calendario_eventos_json'), # URL para FullCalendar
â”‚             }
â”‚             # El template `calendario.html` necesitarÃ­a JS para FullCalendar.
â”‚             return render(request, 'intranet_core/calendario.html', context)
â”‚         
â”‚         @login_required
â”‚         def calendario_eventos_json_view(request):
â”‚             # Filtra eventos por usuario y por rango de fechas si se proveen
â”‚             eventos_qs = EventoCalendario.objects.filter(
â”‚                 Q(creado_por=request.user) | Q(participantes=request.user) if hasattr(EventoCalendario, 'participantes') else Q(creado_por=request.user)
â”‚             ).distinct()
â”‚             # Validar parÃ¡metros de fecha
â”‚             start_param = request.GET.get('start')
â”‚             end_param = request.GET.get('end')
â”‚             try:
â”‚                 if start_param:
â”‚                     start_dt = timezone.datetime.fromisoformat(start_param)
â”‚                     eventos_qs = eventos_qs.filter(fecha_inicio__gte=start_dt)
â”‚                 if end_param:
â”‚                     end_dt = timezone.datetime.fromisoformat(end_param)
â”‚                     eventos_qs = eventos_qs.filter(fecha_fin__lte=end_dt)
â”‚             except Exception:
â”‚                 pass  # Si hay error en el formato, ignorar el filtro
â”‚             eventos_list = []
â”‚             for evento in eventos_qs:
â”‚                 eventos_list.append({
â”‚                     'id': evento.id,
â”‚                     'title': evento.titulo,
â”‚                     'start': evento.fecha_inicio.isoformat(),
â”‚                     'end': evento.fecha_fin.isoformat() if evento.fecha_fin else None,
â”‚                     'description': evento.descripcion,
â”‚                     'color': getattr(evento, 'color_evento', None),
â”‚                     'url': reverse('intranet_core:evento_calendario_detalle', args=[evento.id])
â”‚                 })
â”‚             return JsonResponse(eventos_list, safe=False)
â”‚         
â”‚         @login_required
â”‚         def evento_calendario_crear_view(request):
â”‚             if request.method == 'POST':
â”‚                 form = EventoCalendarioModelForm(request.POST) # Asume este form
â”‚                 if form.is_valid():
â”‚                     evento = form.save(commit=False)
â”‚                     evento.creado_por = request.user
â”‚                     evento.save()
â”‚                     messages.success(request, "Evento creado exitosamente.")
â”‚                     return redirect('intranet_core:calendario')
â”‚             else:
â”‚                 # Pre-llenar fecha_inicio si viene por GET (ej. desde FullCalendar al hacer clic en un dÃ­a)
â”‚                 initial_data = {}
â”‚                 date_str = request.GET.get('date')
â”‚                 if date_str:
â”‚                     try:
â”‚                         initial_data['fecha_inicio'] = timezone.datetime.fromisoformat(date_str)
â”‚                     except ValueError:
â”‚                         pass # Ignorar si la fecha no es vÃ¡lida
â”‚                 form = EventoCalendarioModelForm(initial=initial_data)
â”‚                 
â”‚             context = {'form': form, 'page_title_for_header': 'Crear Evento', 'active_nav': 'calendario'}
â”‚             return render(request, 'intranet_core/evento_calendario_form.html', context) # Nuevo template
â”‚         
â”‚         @login_required
â”‚         def evento_calendario_detalle_view(request, evento_id):
â”‚             evento = get_object_or_404(EventoCalendario, id=evento_id)
â”‚             # AÃ±adir verificaciÃ³n de permisos si es necesario
â”‚             context = {'evento': evento, 'page_title_for_header': evento.titulo, 'active_nav': 'calendario'}
â”‚             return render(request, 'intranet_core/evento_calendario_detalle.html', context) # Nuevo template
â”‚         
â”‚         @login_required
â”‚         def evento_calendario_editar_view(request, evento_id):
â”‚             evento = get_object_or_404(EventoCalendario, id=evento_id, creado_por=request.user) # Solo el creador edita
â”‚             if request.method == 'POST':
â”‚                 form = EventoCalendarioModelForm(request.POST, instance=evento)
â”‚                 if form.is_valid():
â”‚                     form.save()
â”‚                     messages.success(request, "Evento actualizado.")
â”‚                     return redirect('intranet_core:calendario')
â”‚             else:
â”‚                 form = EventoCalendarioModelForm(instance=evento)
â”‚             context = {'form': form, 'evento': evento, 'page_title_for_header': f'Editar: {evento.titulo}', 'active_nav': 'calendario'}
â”‚             return render(request, 'intranet_core/evento_calendario_form.html', context)
â”‚         
â”‚         @login_required
â”‚         def evento_calendario_eliminar_view(request, evento_id):
â”‚             evento = get_object_or_404(EventoCalendario, id=evento_id, creado_por=request.user) # Solo el creador elimina
â”‚             if request.method == 'POST':
â”‚                 evento.delete()
â”‚                 messages.success(request, "Evento eliminado.")
â”‚                 return redirect('intranet_core:calendario')
â”‚             context = {'evento': evento, 'page_title_for_header': f'Eliminar: {evento.titulo}', 'active_nav': 'calendario'}
â”‚             return render(request, 'intranet_core/evento_calendario_confirm_delete.html', context) # Nuevo template
â”‚         
â”‚         # 3. MÃ³dulo de Responsabilidades (Tareas)
â”‚         @login_required
â”‚         def responsabilidades_view(request): # Lista de tareas
â”‚             # Filtros (ej. mis tareas, tareas que creÃ©, todas si es staff)
â”‚             filter_type = request.GET.get('filter', 'mis_tareas')
â”‚             tareas_qs = Tarea.objects.all()
â”‚         
â”‚             if filter_type == 'mis_tareas':
â”‚                 tareas_qs = tareas_qs.filter(asignado_a=request.user)
â”‚                 page_subtitle = "Mis Tareas Asignadas"
â”‚             elif filter_type == 'creadas_por_mi':
â”‚                 tareas_qs = tareas_qs.filter(creado_por=request.user)
â”‚                 page_subtitle = "Tareas Creadas por MÃ­"
â”‚             elif filter_type == 'todas' and request.user.is_staff:
â”‚                 page_subtitle = "Todas las Tareas"
â”‚             else: # Por defecto o si no es staff y pide 'todas'
â”‚                 tareas_qs = tareas_qs.filter(Q(asignado_a=request.user) | Q(creado_por=request.user)).distinct()
â”‚                 page_subtitle = "Mis Tareas y Creadas por MÃ­"
â”‚                 
â”‚             tareas_pendientes = tareas_qs.filter(estado__in=[Tarea.EstadoTarea.PENDIENTE, Tarea.EstadoTarea.EN_PROGRESO]).order_by('fecha_limite', 'prioridad')
â”‚             tareas_completadas = tareas_qs.filter(estado=Tarea.EstadoTarea.COMPLETADA).order_by('-fecha_limite')[:20] # Limitar
â”‚         
â”‚             context = {
â”‚                 'page_title_for_header': f'GestiÃ³n de Responsabilidades: {page_subtitle}',
â”‚                 'active_nav': 'responsabilidades',
â”‚                 'tareas_pendientes': tareas_pendientes,
â”‚                 'tareas_completadas': tareas_completadas,
â”‚                 'current_filter': filter_type,
â”‚             }
â”‚             return render(request, 'intranet_core/responsabilidades_lista.html', context) # Nuevo template
â”‚         
â”‚         @login_required
â”‚         def tarea_crear_view(request):
â”‚             if request.method == 'POST':
â”‚                 form = TareaModelForm(request.POST) # Asume este form
â”‚                 if form.is_valid():
â”‚                     tarea = form.save(commit=False)
â”‚                     tarea.creado_por = request.user
â”‚                     tarea.save()
â”‚                     # Notificar al asignado_a si es diferente del creador
â”‚                     if tarea.asignado_a and tarea.asignado_a != request.user:
â”‚                          crear_notificacion_global(
â”‚                             tarea.asignado_a,
â”‚                             f"Nueva tarea asignada: '{tarea.titulo}' por {request.user.username}.",
â”‚                             'intranet_core:tarea_detalle', kwargs={'tarea_id': tarea.id} # Ajusta el nombre de la URL de detalle
â”‚                         )
â”‚                     messages.success(request, "Tarea creada exitosamente.")
â”‚                     return redirect('intranet_core:responsabilidades')
â”‚             else:
â”‚                 form = TareaModelForm(initial={'asignado_a': request.user}) # Pre-asignar al usuario actual
â”‚             context = {'form': form, 'page_title_for_header': 'Crear Nueva Tarea', 'active_nav': 'responsabilidades'}
â”‚             return render(request, 'intranet_core/tarea_form.html', context) # Nuevo template
â”‚         
â”‚         @login_required
â”‚         def tarea_detalle_view(request, tarea_id):
â”‚             tarea = get_object_or_404(Tarea, id=tarea_id)
â”‚             # Verificar permisos: asignado, creador o staff
â”‚             if not (request.user == tarea.asignado_a or request.user == tarea.creado_por or request.user.is_staff):
â”‚                 return HttpResponseForbidden("No tienes permiso para ver esta tarea.")
â”‚             context = {'tarea': tarea, 'page_title_for_header': f'Tarea: {tarea.titulo}', 'active_nav': 'responsabilidades'}
â”‚             return render(request, 'intranet_core/tarea_detalle.html', context) # Nuevo template
â”‚         
â”‚         @login_required
â”‚         def tarea_editar_view(request, tarea_id):
â”‚             tarea = get_object_or_404(Tarea, id=tarea_id)
â”‚             # Verificar permisos: solo creador o staff (o asignado si se permite)
â”‚             if not (request.user == tarea.creado_por or request.user.is_staff):
â”‚                 return HttpResponseForbidden("No tienes permiso para editar esta tarea.")
â”‚                 
â”‚             if request.method == 'POST':
â”‚                 form = TareaModelForm(request.POST, instance=tarea)
â”‚                 if form.is_valid():
â”‚                     form.save()
â”‚                     messages.success(request, "Tarea actualizada.")
â”‚                     return redirect('intranet_core:tarea_detalle', tarea_id=tarea.id)
â”‚             else:
â”‚                 form = TareaModelForm(instance=tarea)
â”‚             context = {'form': form, 'tarea': tarea, 'page_title_for_header': f'Editar Tarea: {tarea.titulo}', 'active_nav': 'responsabilidades'}
â”‚             return render(request, 'intranet_core/tarea_form.html', context)
â”‚         
â”‚         @login_required
â”‚         def tarea_eliminar_view(request, tarea_id):
â”‚             tarea = get_object_or_404(Tarea, id=tarea_id)
â”‚             if not (request.user == tarea.creado_por or request.user.is_staff):
â”‚                 return HttpResponseForbidden("No tienes permiso para eliminar esta tarea.")
â”‚             
â”‚             if request.method == 'POST':
â”‚                 tarea.delete()
â”‚                 messages.success(request, "Tarea eliminada.")
â”‚                 return redirect('intranet_core:responsabilidades')
â”‚             context = {'tarea': tarea, 'page_title_for_header': f'Eliminar Tarea: {tarea.titulo}', 'active_nav': 'responsabilidades'}
â”‚             return render(request, 'intranet_core/tarea_confirm_delete.html', context)
â”‚         
â”‚         # 4. MÃ³dulo de Directorio de Usuarios
â”‚         @login_required
â”‚         def directorio_view(request):
â”‚             search_query = request.GET.get('q', '').strip()
â”‚             usuarios_qs = User.objects.filter(is_active=True).select_related('perfil').order_by('last_name', 'first_name')
â”‚             if search_query:
â”‚                 usuarios_qs = usuarios_qs.filter(
â”‚                     Q(username__icontains=search_query) |
â”‚                     Q(first_name__icontains=search_query) |
â”‚                     Q(last_name__icontains=search_query) |
â”‚                     Q(email__icontains=search_query) |
â”‚                     Q(perfil__departamento__icontains=search_query) |
â”‚                     Q(perfil__cargo__icontains=search_query)
â”‚                 ).distinct()
â”‚                 
â”‚             paginator = Paginator(usuarios_qs, 25)
â”‚             page_number = request.GET.get('page')
â”‚             try:
â”‚                 usuarios_paginados = paginator.page(page_number)
â”‚             except PageNotAnInteger:
â”‚                 usuarios_paginados = paginator.page(1)
â”‚             except EmptyPage:
â”‚                 usuarios_paginados = paginator.page(paginator.num_pages)
â”‚                 
â”‚             context = {
â”‚                 'page_title_for_header': 'Directorio de Usuarios',
â”‚                 'active_nav': 'directorio',
â”‚                 'usuarios': usuarios_paginados, # Pasa el objeto Page
â”‚                 'search_query': search_query,
â”‚             }
â”‚             return render(request, 'intranet_core/directorio_lista.html', context)
â”‚         
â”‚         @login_required
â”‚         def directorio_usuario_detalle_view(request, username):
â”‚             usuario_perfil = get_object_or_404(User.objects.select_related('perfil'), username=username, is_active=True)
â”‚             context = {
â”‚                 'page_title_for_header': f'Perfil de {usuario_perfil.get_full_name() or usuario_perfil.username}',
â”‚                 'active_nav': 'directorio',
â”‚                 'perfil_usuario_obj': usuario_perfil, # El template debe acceder a usuario_perfil.perfil
â”‚             }
â”‚             return render(request, 'intranet_core/directorio_usuario_detalle.html', context)
â”‚         
â”‚         # 5. MÃ³dulo de Reserva de Recursos
â”‚         @login_required
â”‚         def reservas_view(request):
â”‚             recursos = Recurso.objects.filter(esta_activo=True).select_related('tipo_recurso')
â”‚             tipos_recurso = TipoRecurso.objects.all()
â”‚             context = {
â”‚                 'page_title_for_header': 'Reserva de Recursos',
â”‚                 'active_nav': 'reservas',
â”‚                 'recursos': recursos,
â”‚                 'tipos_recurso': tipos_recurso,
â”‚                 'reservas_json_url': reverse('intranet_core:reservas_eventos_json'),
â”‚                 'form_reserva': ReservaModelForm() # Para un modal
â”‚             }
â”‚             return render(request, 'intranet_core/reservas_lista_recursos.html', context)
â”‚         
â”‚         @login_required
â”‚         def reservas_eventos_json_view(request):
â”‚             reservas_qs = Reserva.objects.filter(estado=Reserva.EstadoReserva.APROBADA).select_related('recurso', 'reservado_por')
â”‚             
â”‚             recurso_id = request.GET.get('recurso_id')
â”‚             if recurso_id:
â”‚                 reservas_qs = reservas_qs.filter(recurso_id=recurso_id)
â”‚             
â”‚             start_param = request.GET.get('start')
â”‚             end_param = request.GET.get('end')
â”‚             if start_param:
â”‚                 reservas_qs = reservas_qs.filter(fecha_fin__gte=start_param)
â”‚             if end_param:
â”‚                 reservas_qs = reservas_qs.filter(fecha_inicio__lte=end_param)
â”‚         
â”‚             eventos_list = []
â”‚             for reserva in reservas_qs:
â”‚                 eventos_list.append({
â”‚                     'id': reserva.id,
â”‚                     'title': f"{reserva.recurso.nombre} ({reserva.reservado_por.username})",
â”‚                     'start': reserva.fecha_inicio.isoformat(),
â”‚                     'end': reserva.fecha_fin.isoformat(),
â”‚                     'resourceId': reserva.recurso.id,
â”‚                     'description': reserva.motivo or '',
â”‚                     'color': reserva.recurso.tipo_recurso.icono_fa.split(' ')[1] if reserva.recurso.tipo_recurso.icono_fa else None # Usar color de tipo si existe
â”‚                 })
â”‚             return JsonResponse(eventos_list, safe=False)
â”‚         
â”‚         @login_required
â”‚         def reserva_crear_view(request, recurso_id=None):
â”‚             recurso = None
â”‚             initial_data = {}
â”‚             if recurso_id:
â”‚                 recurso = get_object_or_404(Recurso, id=recurso_id, esta_activo=True)
â”‚                 initial_data['recurso'] = recurso
â”‚         
â”‚             # Pre-llenar fechas si vienen por GET (ej. desde FullCalendar)
â”‚             start_str = request.GET.get('start')
â”‚             end_str = request.GET.get('end')
â”‚             if start_str: 
â”‚                 try: initial_data['fecha_inicio'] = timezone.datetime.fromisoformat(start_str)
â”‚                 except: pass
â”‚             if end_str: 
â”‚                 try: initial_data['fecha_fin'] = timezone.datetime.fromisoformat(end_str)
â”‚                 except: pass
â”‚         
â”‚             if request.method == 'POST':
â”‚                 form = ReservaModelForm(request.POST)
â”‚                 if form.is_valid():
â”‚                     reserva = form.save(commit=False)
â”‚                     reserva.reservado_por = request.user
â”‚                     # LÃ³gica de aprobaciÃ³n si 'requiere_aprobacion' estÃ¡ en el modelo Recurso
â”‚                     # if reserva.recurso.requiere_aprobacion:
â”‚                     #     reserva.estado = Reserva.EstadoReserva.PENDIENTE
â”‚                     #     messages.info(request, f"Solicitud de reserva para '{reserva.recurso.nombre}' enviada para aprobaciÃ³n.")
â”‚                     # else:
â”‚                     reserva.estado = Reserva.EstadoReserva.APROBADA # Por ahora, aprobaciÃ³n automÃ¡tica
â”‚                     messages.success(request, f"Reserva para '{reserva.recurso.nombre}' creada exitosamente.")
â”‚                     reserva.save()
â”‚                     
â”‚                     if request.headers.get('X-Requested-With') == 'XMLHttpRequest':
â”‚                          return JsonResponse({'status': 'success', 'message': 'Reserva creada.', 'evento_id': reserva.id}) # Adaptar para FullCalendar
â”‚                     return redirect('intranet_core:reservas')
â”‚                 else:
â”‚                     if request.headers.get('X-Requested-With') == 'XMLHttpRequest':
â”‚                         return JsonResponse({'status': 'error', 'errors': form.errors}, status=400)
â”‚             else:
â”‚                 form = ReservaModelForm(initial=initial_data)
â”‚                 if recurso:
â”‚                     form.fields['recurso'].disabled = True
â”‚             
â”‚             context = {
â”‚                 'form': form, 
â”‚                 'recurso': recurso,
â”‚                 'page_title_for_header': f'Crear Reserva {"para " + recurso.nombre if recurso else ""}',
â”‚                 'active_nav': 'reservas',
â”‚                 'edit_mode': False
â”‚             }
â”‚             return render(request, 'intranet_core/reserva_form.html', context)
â”‚         
â”‚         # 6. MÃ³dulo de GestiÃ³n de Usuarios (Staff)
â”‚         @login_required
â”‚         @user_passes_test(es_staff, login_url=reverse_lazy('intranet_core:dashboard'))
â”‚         def usuarios_gestion_view(request):
â”‚             search_query = request.GET.get('q', '')
â”‚             usuarios_qs = User.objects.all().select_related('perfil').prefetch_related('groups').order_by('username')
â”‚             
â”‚             if search_query:
â”‚                 usuarios_qs = usuarios_qs.filter(
â”‚                     Q(username__icontains=search_query) |
â”‚                     Q(first_name__icontains=search_query) |
â”‚                     Q(last_name__icontains=search_query) |
â”‚                     Q(email__icontains=search_query)
â”‚                 )
â”‚             
â”‚             paginator = Paginator(usuarios_qs, 25)
â”‚             page_number = request.GET.get('page')
â”‚             try:
â”‚                 usuarios_paginados = paginator.page(page_number)
â”‚             except PageNotAnInteger:
â”‚                 usuarios_paginados = paginator.page(1)
â”‚             except EmptyPage:
â”‚                 usuarios_paginados = paginator.page(paginator.num_pages)
â”‚         
â”‚             context = {
â”‚                 'page_title_for_header': 'GestiÃ³n de Usuarios',
â”‚                 'active_nav': 'usuarios_gestion',
â”‚                 'usuarios': usuarios_paginados,
â”‚                 'search_query': search_query,
â”‚             }
â”‚             return render(request, 'intranet_core/usuarios_gestion_lista.html', context)
â”‚         
â”‚         @login_required
â”‚         @user_passes_test(es_staff)
â”‚         def usuario_gestion_editar_view(request, user_id):
â”‚             usuario_a_editar = get_object_or_404(User, id=user_id)
â”‚             perfil_usuario, created = PerfilUsuario.objects.get_or_create(usuario=usuario_a_editar)
â”‚         
â”‚             if request.method == 'POST':
â”‚                 user_form = UserEditStaffForm(request.POST, instance=usuario_a_editar)
â”‚                 perfil_form = PerfilUsuarioModelForm(request.POST, request.FILES, instance=perfil_usuario)
â”‚                 if user_form.is_valid() and perfil_form.is_valid():
â”‚                     user_form.save() # El save() de UserEditStaffForm maneja los grupos
â”‚                     perfil_form.save()
â”‚                     messages.success(request, f"Usuario '{usuario_a_editar.username}' actualizado exitosamente.")
â”‚                     return redirect('intranet_core:usuarios_gestion')
â”‚                 else:
â”‚                     messages.error(request, "Error al actualizar el usuario. Revisa los campos.")
â”‚             else:
â”‚                 user_form = UserEditStaffForm(instance=usuario_a_editar)
â”‚                 perfil_form = PerfilUsuarioModelForm(instance=perfil_usuario)
â”‚             
â”‚             context = {
â”‚                 'page_title_for_header': f'Editar Usuario: {usuario_a_editar.username}',
â”‚                 'active_nav': 'usuarios_gestion',
â”‚                 'usuario_a_editar': usuario_a_editar,
â”‚                 'user_form': user_form,
â”‚                 'perfil_form': perfil_form,
â”‚             }
â”‚             return render(request, 'intranet_core/usuario_gestion_form.html', context)
â”‚         
â”‚         # 7. MÃ³dulo de Perfil de Usuario
â”‚         @login_required
â”‚         def perfil_view(request):
â”‚             user_profile, created = PerfilUsuario.objects.get_or_create(usuario=request.user)
â”‚             
â”‚             user_form = UserUpdateForm(instance=request.user)
â”‚             profile_form = PerfilUsuarioModelForm(instance=user_profile)
â”‚             password_form = PasswordChangeForm(request.user)
â”‚         
â”‚             if request.method == 'POST':
â”‚                 if 'update_profile' in request.POST:
â”‚                     user_form = UserUpdateForm(request.POST, instance=request.user)
â”‚                     profile_form = PerfilUsuarioModelForm(request.POST, request.FILES, instance=user_profile)
â”‚                     if user_form.is_valid() and profile_form.is_valid():
â”‚                         user_form.save()
â”‚                         profile_form.save()
â”‚                         messages.success(request, 'Tu perfil ha sido actualizado exitosamente.')
â”‚                         return redirect('intranet_core:perfil')
â”‚                     else:
â”‚                         messages.error(request, 'Por favor corrige los errores en el formulario de perfil.')
â”‚                 elif 'change_password' in request.POST:
â”‚                     password_form = PasswordChangeForm(request.user, request.POST)
â”‚                     if password_form.is_valid():
â”‚                         user = password_form.save()
â”‚                         update_session_auth_hash(request, user) 
â”‚                         messages.success(request, 'Tu contraseÃ±a ha sido cambiada exitosamente.')
â”‚                         return redirect('intranet_core:perfil')
â”‚                     else:
â”‚                         messages.error(request, 'Error al cambiar la contraseÃ±a. Por favor corrige los errores.')
â”‚             
â”‚             context = {
â”‚                 'page_title_for_header': 'Mi Perfil',
â”‚                 'active_nav': 'perfil',
â”‚                 'user_form': user_form,
â”‚                 'profile_form': profile_form,
â”‚                 'password_form': password_form,
â”‚                 'perfil_usuario_obj': user_profile, # Usado para mostrar la foto actual, etc.
â”‚             }
â”‚             return render(request, 'intranet_core/perfil_editar.html', context)
â”‚         
â”‚         # 8. MÃ³dulo de ConfiguraciÃ³n
â”‚         @login_required
â”‚         def configuracion_view(request):
â”‚             context = {
â”‚                 'page_title_for_header': 'ConfiguraciÃ³n',
â”‚                 'active_nav': 'configuracion'
â”‚             }
â”‚             messages.info(request, "La secciÃ³n de ConfiguraciÃ³n estÃ¡ en desarrollo.")
â”‚             return render(request, 'intranet_core/configuracion.html', context)
â”‚       --- FIN CONTENIDO (views.py) ---


â”œâ”€â”€ intranet_gem
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   ðŸ“„ (Archivo vacÃ­o)

â”‚   â”œâ”€â”€ asgi.py
â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (asgi.py):
â”‚   â”‚     """
â”‚   â”‚     ASGI config for intranet_gem project.
â”‚   â”‚     
â”‚   â”‚     It exposes the ASGI callable as a module-level variable named ``application``.
â”‚   â”‚     
â”‚   â”‚     For more information on this file, see
â”‚   â”‚     https://docs.djangoproject.com/en/5.2/howto/deployment/asgi/
â”‚   â”‚     """
â”‚   â”‚     
â”‚   â”‚     import os
â”‚   â”‚     
â”‚   â”‚     from django.core.asgi import get_asgi_application
â”‚   â”‚     
â”‚   â”‚     os.environ.setdefault("DJANGO_SETTINGS_MODULE", "intranet_gem.settings")
â”‚   â”‚     
â”‚   â”‚     application = get_asgi_application()
â”‚   â”‚   --- FIN CONTENIDO (asgi.py) ---

â”‚   â”œâ”€â”€ settings.py
â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (settings.py):
â”‚   â”‚     # UbicaciÃ³n: /workspaces/intranet_gem/intranet_gem/settings.py
â”‚   â”‚     import os
â”‚   â”‚     from pathlib import Path
â”‚   â”‚     
â”‚   â”‚     BASE_DIR = Path(__file__).resolve().parent.parent
â”‚   â”‚     SECRET_KEY = 'django-insecure_CAMBIA_ESTA_CLAVE_SECRETA_POR_UNA_NUEVA_Y_UNICA' # Â¡GENERA UNA NUEVA!
â”‚   â”‚     DEBUG = True
â”‚   â”‚     
â”‚   â”‚     ALLOWED_HOSTS = ['localhost', '127.0.0.1',]
â”‚   â”‚     CSRF_TRUSTED_ORIGINS = [
â”‚   â”‚         'http://localhost:8000', 'http://127.0.0.1:8000',
â”‚   â”‚         'https://localhost:8000', 'https://127.0.0.1:8000',
â”‚   â”‚     ]
â”‚   â”‚     
â”‚   â”‚     if 'CODESPACE_NAME' in os.environ and 'GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN' in os.environ:
â”‚   â”‚         CODESPACE_URL_PRIMARY = f"{os.environ['CODESPACE_NAME']}.{os.environ['GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN']}"
â”‚   â”‚         ALLOWED_HOSTS.append(CODESPACE_URL_PRIMARY)
â”‚   â”‚         CSRF_TRUSTED_ORIGINS.append(f'https://{CODESPACE_URL_PRIMARY}')
â”‚   â”‚         CODESPACE_URL_WITH_PORT = f"https://{os.environ['CODESPACE_NAME']}-8000.{os.environ['GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN']}"
â”‚   â”‚         ALLOWED_HOSTS.append(CODESPACE_URL_WITH_PORT)
â”‚   â”‚         CSRF_TRUSTED_ORIGINS.append(CODESPACE_URL_WITH_PORT)
â”‚   â”‚     
â”‚   â”‚     INSTALLED_APPS = [
â”‚   â”‚         'django.contrib.admin', 'django.contrib.auth', 'django.contrib.contenttypes',
â”‚   â”‚         'django.contrib.sessions', 'django.contrib.messages', 'django.contrib.staticfiles',
â”‚   â”‚         'intranet_core',
â”‚   â”‚     ]
â”‚   â”‚     MIDDLEWARE = [
â”‚   â”‚         'django.middleware.security.SecurityMiddleware',
â”‚   â”‚         'django.contrib.sessions.middleware.SessionMiddleware',
â”‚   â”‚         'django.middleware.common.CommonMiddleware',
â”‚   â”‚         'django.middleware.csrf.CsrfViewMiddleware',
â”‚   â”‚         'django.contrib.auth.middleware.AuthenticationMiddleware',
â”‚   â”‚         'django.contrib.messages.middleware.MessageMiddleware',
â”‚   â”‚         'django.middleware.clickjacking.XFrameOptionsMiddleware',
â”‚   â”‚     ]
â”‚   â”‚     ROOT_URLCONF = 'intranet_gem.urls'
â”‚   â”‚     TEMPLATES = [{'BACKEND': 'django.template.backends.django.DjangoTemplates','DIRS': [os.path.join(BASE_DIR, 'templates')],'APP_DIRS': True,
â”‚   â”‚         'OPTIONS': {
â”‚   â”‚             'context_processors': [
â”‚   â”‚                 'django.template.context_processors.debug',
â”‚   â”‚                 'django.template.context_processors.request',
â”‚   â”‚                 'django.contrib.auth.context_processors.auth',
â”‚   â”‚                 'django.contrib.messages.context_processors.messages',
â”‚   â”‚             ],
â”‚   â”‚         },
â”‚   â”‚     }]
â”‚   â”‚     WSGI_APPLICATION = 'intranet_gem.wsgi.application'
â”‚   â”‚     DATABASES = {'default': {'ENGINE': 'django.db.backends.sqlite3','NAME': BASE_DIR / 'db.sqlite3',}}
â”‚   â”‚     AUTH_PASSWORD_VALIDATORS = [
â”‚   â”‚         {'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',},
â”‚   â”‚         {'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',},
â”‚   â”‚         {'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',},
â”‚   â”‚         {'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',},
â”‚   â”‚     ]
â”‚   â”‚     LANGUAGE_CODE = 'es-cl'
â”‚   â”‚     TIME_ZONE = 'America/Santiago'
â”‚   â”‚     USE_I18N = True
â”‚   â”‚     USE_L10N = True
â”‚   â”‚     USE_TZ = True
â”‚   â”‚     STATIC_URL = '/static/'
â”‚   â”‚     STATICFILES_DIRS = [os.path.join(BASE_DIR, 'static'),]
â”‚   â”‚     MEDIA_URL = '/media/'
â”‚   â”‚     MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
â”‚   â”‚     DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
â”‚   â”‚     LOGIN_URL = '/accounts/login/'
â”‚   â”‚     LOGIN_REDIRECT_URL = 'intranet_core:dashboard'
â”‚   â”‚     LOGOUT_REDIRECT_URL = 'intranet_core:dashboard'
â”‚   â”‚   --- FIN CONTENIDO (settings.py) ---

â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (urls.py):
â”‚   â”‚     # /workspaces/intranet_gem/intranet_gem/urls.py
â”‚   â”‚     from django.contrib import admin
â”‚   â”‚     from django.urls import path, include
â”‚   â”‚     from django.conf import settings
â”‚   â”‚     from django.conf.urls.static import static
â”‚   â”‚     
â”‚   â”‚     urlpatterns = [
â”‚   â”‚         path('admin/', admin.site.urls),
â”‚   â”‚         path('accounts/', include('django.contrib.auth.urls')),
â”‚   â”‚     
â”‚   â”‚         # InclusiÃ³n explÃ­cita del namespace para intranet_core
â”‚   â”‚         # El segundo 'intranet_core' en la tupla es el app_name que Django usarÃ¡ para construir el namespace completo.
â”‚   â”‚         # El 'namespace' kwarg es el instance namespace. Para una sola instancia de la app, suelen ser iguales.
â”‚   â”‚         path('', include(('intranet_core.urls', 'intranet_core'), namespace='intranet_core')),
â”‚   â”‚     ]
â”‚   â”‚     
â”‚   â”‚     if settings.DEBUG:
â”‚   â”‚         urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
â”‚   â”‚   --- FIN CONTENIDO (urls.py) ---

â”‚   â””â”€â”€ wsgi.py
â”‚       ðŸ“„ CONTENIDO DEL ARCHIVO (wsgi.py):
â”‚         """
â”‚         WSGI config for intranet_gem project.
â”‚         
â”‚         It exposes the WSGI callable as a module-level variable named ``application``.
â”‚         
â”‚         For more information on this file, see
â”‚         https://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/
â”‚         """
â”‚         
â”‚         import os
â”‚         
â”‚         from django.core.wsgi import get_wsgi_application
â”‚         
â”‚         os.environ.setdefault("DJANGO_SETTINGS_MODULE", "intranet_gem.settings")
â”‚         
â”‚         application = get_wsgi_application()
â”‚       --- FIN CONTENIDO (wsgi.py) ---


â”œâ”€â”€ manage.py
â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (manage.py):
â”‚     #!/usr/bin/env python
â”‚     """Django's command-line utility for administrative tasks."""
â”‚     import os
â”‚     import sys
â”‚     
â”‚     
â”‚     def main():
â”‚         """Run administrative tasks."""
â”‚         os.environ.setdefault("DJANGO_SETTINGS_MODULE", "intranet_gem.settings")
â”‚         try:
â”‚             from django.core.management import execute_from_command_line
â”‚         except ImportError as exc:
â”‚             raise ImportError(
â”‚                 "Couldn't import Django. Are you sure it's installed and "
â”‚                 "available on your PYTHONPATH environment variable? Did you "
â”‚                 "forget to activate a virtual environment?"
â”‚             ) from exc
â”‚         execute_from_command_line(sys.argv)
â”‚     
â”‚     
â”‚     if __name__ == "__main__":
â”‚         main()
â”‚   --- FIN CONTENIDO (manage.py) ---

â”œâ”€â”€ media
â”‚   â””â”€â”€ archivos
â”‚       â””â”€â”€ user_1
â”‚           â”œâ”€â”€ 292643574_389398936508841_592385954277519704_n.jpg

â”‚           â”œâ”€â”€ descarga.png

â”‚           â”œâ”€â”€ descarga_NU3DW0s.png

â”‚           â””â”€â”€ drive-download-20241107T110122Z-001.zip




â”œâ”€â”€ static
â”‚   â”œâ”€â”€ css
â”‚   â”‚   â””â”€â”€ intranet_styles.css
â”‚   â”‚       ðŸ“„ CONTENIDO DEL ARCHIVO (intranet_styles.css):
â”‚   â”‚         /* static/css/intranet_styles.css */
â”‚   â”‚         body {
â”‚   â”‚             font-family: 'Inter', sans-serif;
â”‚   â”‚             transition: background-color 0.3s, color 0.3s;
â”‚   â”‚         }
â”‚   â”‚         /* Colores Institucionales (Ejemplo Gobierno de Chile, adaptables) */
â”‚   â”‚         :root {
â”‚   â”‚             --main-primary-bg: #0033A0; /* Azul principal */
â”‚   â”‚             --main-primary-text: #0033A0;
â”‚   â”‚             --main-primary-border: #0033A0;
â”‚   â”‚             --main-primary-dark-bg: #00227A; /* Azul mÃ¡s oscuro para hover/active */
â”‚   â”‚         
â”‚   â”‚             --main-secondary-bg: #D90F2C; /* Rojo secundario/acento */
â”‚   â”‚             --main-secondary-text: #D90F2C;
â”‚   â”‚             --main-secondary-border: #D90F2C;
â”‚   â”‚             --main-secondary-dark-bg: #B00C24;
â”‚   â”‚             
â”‚   â”‚             --main-white-text: #FFFFFF;
â”‚   â”‚             --main-white-bg: #FFFFFF;
â”‚   â”‚         
â”‚   â”‚             --text-color: #1f2937; /* Tailwind gray-800 */
â”‚   â”‚             --bg-color: #f9fafb; /* Tailwind gray-50 */
â”‚   â”‚             --card-bg-color: #FFFFFF;
â”‚   â”‚             --sidebar-bg-color: var(--main-primary-bg);
â”‚   â”‚             --sidebar-text-color: var(--main-white-text); /* Color de texto por defecto para la sidebar */
â”‚   â”‚             --sidebar-header-bg-color: #002a80; /* Un azul un poco mÃ¡s oscuro para el header del sidebar */
â”‚   â”‚             --header-bg-color: var(--main-white-bg);
â”‚   â”‚             --header-text-color: var(--main-primary-text);
â”‚   â”‚         }
â”‚   â”‚         
â”‚   â”‚         body.dark-mode {
â”‚   â”‚             --text-color: #d1d5db; /* Tailwind gray-300 */
â”‚   â”‚             --bg-color: #111827; /* Tailwind gray-900 */
â”‚   â”‚             --card-bg-color: #1f2937; /* Tailwind gray-800 */
â”‚   â”‚             --sidebar-bg-color: #1f2937; /* Un gris oscuro para el sidebar en modo oscuro */
â”‚   â”‚             --sidebar-text-color: #e5e7eb; /* Tailwind gray-200 */
â”‚   â”‚             --sidebar-header-bg-color: #111827; /* MÃ¡s oscuro */
â”‚   â”‚             --header-bg-color: #1f2937;
â”‚   â”‚             --header-text-color: var(--main-white-text);
â”‚   â”‚         }
â”‚   â”‚         
â”‚   â”‚         /* AplicaciÃ³n de variables CSS */
â”‚   â”‚         body { background-color: var(--bg-color); color: var(--text-color); }
â”‚   â”‚         .bg-card { background-color: var(--card-bg-color); }
â”‚   â”‚         .text-default { color: var(--text-color); }
â”‚   â”‚         .text-muted { color: var(--text-color); opacity: 0.7; }
â”‚   â”‚         
â”‚   â”‚         .bg-sidebar { background-color: var(--sidebar-bg-color); }
â”‚   â”‚         .text-sidebar { color: var(--sidebar-text-color); }
â”‚   â”‚         .bg-sidebar-header { background-color: var(--sidebar-header-bg-color); }
â”‚   â”‚         
â”‚   â”‚         .bg-header { background-color: var(--header-bg-color); }
â”‚   â”‚         .text-header-title { color: var(--header-text-color); }
â”‚   â”‚         
â”‚   â”‚         
â”‚   â”‚         .bg-main-primary { background-color: var(--main-primary-bg); }
â”‚   â”‚         .text-main-primary { color: var(--main-primary-text); }
â”‚   â”‚         .border-main-primary { border-color: var(--main-primary-border); }
â”‚   â”‚         .hover\:bg-main-primary-dark:hover { background-color: var(--main-primary-dark-bg); }
â”‚   â”‚         .bg-main-primary-dark { background-color: var(--main-primary-dark-bg); } 
â”‚   â”‚         
â”‚   â”‚         .bg-main-secondary { background-color: var(--main-secondary-bg); }
â”‚   â”‚         .text-main-secondary { color: var(--main-secondary-text); }
â”‚   â”‚         .border-main-secondary { border-color: var(--main-secondary-border); }
â”‚   â”‚         .hover\:bg-main-secondary-dark:hover { background-color: var(--main-secondary-dark-bg); }
â”‚   â”‚         
â”‚   â”‚         .text-main-white { color: var(--main-white-text); }
â”‚   â”‚         .bg-main-white { background-color: var(--main-white-bg); }
â”‚   â”‚         
â”‚   â”‚         
â”‚   â”‚         /* Estilo para la barra de scroll */
â”‚   â”‚         ::-webkit-scrollbar { width: 8px; height: 8px; }
â”‚   â”‚         ::-webkit-scrollbar-track { background: #f0f4f8; }
â”‚   â”‚         body.dark-mode ::-webkit-scrollbar-track { background: #2d3748; }
â”‚   â”‚         ::-webkit-scrollbar-thumb { background: #a0aec0; border-radius: 4px; }
â”‚   â”‚         body.dark-mode ::-webkit-scrollbar-thumb { background: #4b5563; }
â”‚   â”‚         ::-webkit-scrollbar-thumb:hover { background: #718096; }
â”‚   â”‚         body.dark-mode ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
â”‚   â”‚         
â”‚   â”‚         @media print { .print-hidden { display: none !important; } }
â”‚   â”‚         
â”‚   â”‚         .calendar-grid { display: grid; grid-template-columns: repeat(7, minmax(0, 1fr)); gap: 1px; background-color: #e2e8f0; border: 1px solid #e2e8f0; }
â”‚   â”‚         body.dark-mode .calendar-grid { background-color: #374151; border-color: #374151; }
â”‚   â”‚         .calendar-day-header, .calendar-day { background-color: var(--card-bg-color); padding: 0.75rem; text-align: center; font-size: 0.875rem; }
â”‚   â”‚         .calendar-day-header { font-weight: 600; color: var(--text-color); opacity: 0.8; }
â”‚   â”‚         .calendar-day { min-height: 6rem; color: var(--text-color); }
â”‚   â”‚         .calendar-day.other-month { color: var(--text-color); opacity: 0.5; background-color: var(--bg-color); }
â”‚   â”‚         .calendar-day .event { display: block; font-size: 0.75rem; padding: 0.25rem; margin-top: 0.25rem; border-radius: 0.25rem; color: white; }
â”‚   â”‚         
â”‚   â”‚         .form-field-palette-item { cursor: grab; }
â”‚   â”‚         .form-canvas { min-height: 200px; border: 2px dashed #cbd5e0; }
â”‚   â”‚         body.dark-mode .form-canvas { border-color: #4b5563; }
â”‚   â”‚         
â”‚   â”‚         #notifications-panel {
â”‚   â”‚             max-height: 400px;
â”‚   â”‚             overflow-y: auto;
â”‚   â”‚         }
â”‚   â”‚       --- FIN CONTENIDO (intranet_styles.css) ---


â”‚   â”œâ”€â”€ images

â”‚   â””â”€â”€ js
â”‚       â””â”€â”€ intranet_scripts.js
â”‚           ðŸ“„ CONTENIDO DEL ARCHIVO (intranet_scripts.js):
â”‚             // static/js/intranet_scripts.js
â”‚             document.addEventListener('DOMContentLoaded', function () {
â”‚                 const userMenuButton = document.getElementById('user-menu-button');
â”‚                 const userMenu = document.getElementById('user-menu');
â”‚                 const sidebarToggle = document.getElementById('sidebar-toggle');
â”‚                 const sidebar = document.getElementById('sidebar');
â”‚             
â”‚                 const themeToggleButton = document.getElementById('theme-toggle');
â”‚                 const themeToggleIcon = themeToggleButton ? themeToggleButton.querySelector('i') : null;
â”‚                 const notificationsButton = document.getElementById('notifications-button');
â”‚                 const notificationsPanel = document.getElementById('notifications-panel');
â”‚                 const currentYearSpan = document.getElementById('currentYear');
â”‚             
â”‚                 if (currentYearSpan) {
â”‚                     currentYearSpan.textContent = new Date().getFullYear();
â”‚                 }
â”‚                 
â”‚                 const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
â”‚                 if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && prefersDark.matches)) {
â”‚                     document.body.classList.add('dark-mode');
â”‚                     if (themeToggleIcon) {
â”‚                         themeToggleIcon.classList.remove('fa-moon');
â”‚                         themeToggleIcon.classList.add('fa-sun');
â”‚                     }
â”‚                 }
â”‚             
â”‚                 if (themeToggleButton) {
â”‚                     themeToggleButton.addEventListener('click', () => {
â”‚                         document.body.classList.toggle('dark-mode');
â”‚                         const isDarkMode = document.body.classList.contains('dark-mode');
â”‚                         localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
â”‚                         if (themeToggleIcon) {
â”‚                             themeToggleIcon.classList.toggle('fa-moon', !isDarkMode);
â”‚                             themeToggleIcon.classList.toggle('fa-sun', isDarkMode);
â”‚                         }
â”‚                     });
â”‚                 }
â”‚                 
â”‚                 if (userMenuButton && userMenu) {
â”‚                     userMenuButton.addEventListener('click', (event) => {
â”‚                         event.stopPropagation(); 
â”‚                         userMenu.classList.toggle('hidden');
â”‚                         if (notificationsPanel && !notificationsPanel.classList.contains('hidden')) {
â”‚                             notificationsPanel.classList.add('hidden');
â”‚                         }
â”‚                     });
â”‚                 }
â”‚             
â”‚                 if (notificationsButton && notificationsPanel) {
â”‚                     notificationsButton.addEventListener('click', (event) => {
â”‚                         event.stopPropagation(); 
â”‚                         notificationsPanel.classList.toggle('hidden');
â”‚                         if (userMenu && !userMenu.classList.contains('hidden')) {
â”‚                             userMenu.classList.add('hidden');
â”‚                         }
â”‚                     });
â”‚                 }
â”‚             
â”‚                 document.addEventListener('click', (event) => {
â”‚                     if (userMenuButton && userMenu && !userMenu.classList.contains('hidden') && !userMenuButton.contains(event.target) && !userMenu.contains(event.target)) {
â”‚                         userMenu.classList.add('hidden');
â”‚                     }
â”‚                     if (notificationsButton && notificationsPanel && !notificationsPanel.classList.contains('hidden') && !notificationsButton.contains(event.target) && !notificationsPanel.contains(event.target)) {
â”‚                         notificationsPanel.classList.add('hidden');
â”‚                     }
â”‚                 });
â”‚             
â”‚                 if (sidebarToggle && sidebar) {
â”‚                     sidebarToggle.addEventListener('click', () => {
â”‚                         sidebar.classList.toggle('-translate-x-full'); 
â”‚                     });
â”‚                 }
â”‚             
â”‚                 const navLinksForMobileSidebar = document.querySelectorAll('#sidebar .nav-link');
â”‚                 navLinksForMobileSidebar.forEach(link => {
â”‚                     link.addEventListener('click', (e) => {
â”‚                         if (link.getAttribute('href') && link.getAttribute('href') !== '#') {
â”‚                             if (sidebar && window.innerWidth < 768 && !sidebar.classList.contains('-translate-x-full')) { 
â”‚                                 sidebar.classList.add('-translate-x-full');
â”‚                             }
â”‚                         }
â”‚                         const notificationsNavLink = link.closest('#notifications-panel');
â”‚                         if (notificationsNavLink && notificationsPanel && !notificationsPanel.classList.contains('hidden')) {
â”‚                              notificationsPanel.classList.add('hidden');
â”‚                         }
â”‚                     });
â”‚                 });
â”‚             
â”‚                 const fileUploadInput = document.getElementById('file-upload');
â”‚                 const fileListDisplay = document.getElementById('file-list-display');
â”‚                 if (fileUploadInput && fileListDisplay) {
â”‚                     fileUploadInput.addEventListener('change', function() {
â”‚                         if (this.files && this.files.length > 0) {
â”‚                             let fileNames = Array.from(this.files).map(file => file.name).join(', ');
â”‚                             fileListDisplay.textContent = 'Archivos seleccionados: ' + fileNames;
â”‚                         } else { 
â”‚                             fileListDisplay.textContent = ''; 
â”‚                         }
â”‚                     });
â”‚                 }
â”‚             });
â”‚           --- FIN CONTENIDO (intranet_scripts.js) ---



â”œâ”€â”€ templates
â”‚   â”œâ”€â”€ base.html
â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (base.html):
â”‚   â”‚     {% load static %}
â”‚   â”‚     <!DOCTYPE html>
â”‚   â”‚     <html lang="es">
â”‚   â”‚     <head>
â”‚   â”‚         <meta charset="UTF-8">
â”‚   â”‚         <meta name="viewport" content="width=device-width, initial-scale=1.0">
â”‚   â”‚         <title>{% block title_tag %}Intranet Profesional{% endblock %} - InstituciÃ³n Mejorada</title>
â”‚   â”‚         <script src="https://cdn.tailwindcss.com"></script>
â”‚   â”‚         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
â”‚   â”‚         <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
â”‚   â”‚         <link rel="stylesheet" href="{% static 'css/intranet_styles.css' %}">
â”‚   â”‚     </head>
â”‚   â”‚     <body class="bg-gray-100">
â”‚   â”‚         <div class="flex h-screen">
â”‚   â”‚             <aside id="sidebar" class="w-64 bg-sidebar text-sidebar flex-col print-hidden transition-transform duration-300 ease-in-out transform -translate-x-full md:translate-x-0 md:flex">
â”‚   â”‚                 <div class="h-20 flex items-center justify-center bg-sidebar-header">
â”‚   â”‚                     <svg class="h-10 w-10 text-main-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
â”‚   â”‚                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h6.75M9 12.75h6.75M9 18h6.75M5.25 6h.008v.008H5.25V6zm0 6h.008v.008H5.25v-6zm0 6h.008v.008H5.25v-6z"/>
â”‚   â”‚                     </svg>
â”‚   â”‚                     <span class="ml-2 text-xl font-semibold text-main-white">Intranet</span>
â”‚   â”‚                 </div>
â”‚   â”‚                 <nav class="flex-1 px-2 py-4 space-y-1 overflow-y-auto">
â”‚   â”‚                     <a href="{% url 'intranet_core:dashboard' %}" class="nav-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors duration-150 {% if active_nav == 'dashboard' %}bg-main-primary-dark text-white{% else %}text-gray-200 hover:bg-main-primary-dark hover:text-white{% endif %}"><i class="fas fa-tachometer-alt w-5 h-5 mr-3"></i> Panel Principal</a>
â”‚   â”‚                     <a href="{% url 'intranet_core:carga_archivos' %}" class="nav-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors duration-150 {% if active_nav == 'carga_archivos' %}bg-main-primary-dark text-white{% else %}text-gray-200 hover:bg-main-primary-dark hover:text-white{% endif %}"><i class="fas fa-folder-open w-5 h-5 mr-3"></i> Gestor de Archivos</a>
â”‚   â”‚                     <a href="{% url 'intranet_core:formularios' %}" class="nav-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors duration-150 {% if active_nav == 'formularios' %}bg-main-primary-dark text-white{% else %}text-gray-200 hover:bg-main-primary-dark hover:text-white{% endif %}"><i class="fas fa-edit w-5 h-5 mr-3"></i> Creador Formularios</a>
â”‚   â”‚                     <a href="{% url 'intranet_core:calendario' %}" class="nav-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors duration-150 {% if active_nav == 'calendario' %}bg-main-primary-dark text-white{% else %}text-gray-200 hover:bg-main-primary-dark hover:text-white{% endif %}"><i class="fas fa-calendar-alt w-5 h-5 mr-3"></i> Calendario Actividades</a>
â”‚   â”‚                     <a href="{% url 'intranet_core:responsabilidades' %}" class="nav-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors duration-150 {% if active_nav == 'responsabilidades' %}bg-main-primary-dark text-white{% else %}text-gray-200 hover:bg-main-primary-dark hover:text-white{% endif %}"><i class="fas fa-sitemap w-5 h-5 mr-3"></i> GestiÃ³n Responsabilidades</a>
â”‚   â”‚                     <a href="{% url 'intranet_core:directorio' %}" class="nav-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors duration-150 {% if active_nav == 'directorio' %}bg-main-primary-dark text-white{% else %}text-gray-200 hover:bg-main-primary-dark hover:text-white{% endif %}"><i class="fas fa-address-book w-5 h-5 mr-3"></i> Directorio Usuarios</a>
â”‚   â”‚                     <a href="{% url 'intranet_core:reservas' %}" class="nav-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors duration-150 {% if active_nav == 'reservas' %}bg-main-primary-dark text-white{% else %}text-gray-200 hover:bg-main-primary-dark hover:text-white{% endif %}"><i class="fas fa-calendar-check w-5 h-5 mr-3"></i> Reserva de Recursos</a>
â”‚   â”‚                     <a href="{% url 'intranet_core:wiki' %}" class="nav-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors duration-150 {% if active_nav == 'wiki' %}bg-main-primary-dark text-white{% else %}text-gray-200 hover:bg-main-primary-dark hover:text-white{% endif %}"><i class="fas fa-book-open w-5 h-5 mr-3"></i> Base de Conocimiento</a>
â”‚   â”‚                     <a href="{% url 'intranet_core:notificaciones_page' %}" class="nav-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors duration-150 {% if active_nav == 'notificaciones_page' %}bg-main-primary-dark text-white{% else %}text-gray-200 hover:bg-main-primary-dark hover:text-white{% endif %}">
â”‚   â”‚                         <i class="fas fa-bell w-5 h-5 mr-3"></i> Notificaciones
â”‚   â”‚                         <span class="ml-auto inline-block py-0.5 px-2 text-xs font-semibold text-main-secondary bg-main-white rounded-full">{{ notification_count|default:0 }}</span>
â”‚   â”‚                     </a>
â”‚   â”‚                     <div class="pt-4 mt-4 border-t" style="border-color: var(--main-primary-dark-bg);">
â”‚   â”‚                         <h6 class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider" style="color: var(--main-white-text); opacity:0.7;">AdministraciÃ³n</h6>
â”‚   â”‚                         <a href="{% url 'intranet_core:usuarios_gestion' %}" class="nav-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors duration-150 {% if active_nav == 'usuarios_gestion' %}bg-main-primary-dark text-white{% else %}text-gray-200 hover:bg-main-primary-dark hover:text-white{% endif %}"><i class="fas fa-users-cog w-5 h-5 mr-3"></i> GestiÃ³n Usuarios</a>
â”‚   â”‚                     </div>
â”‚   â”‚                 </nav>
â”‚   â”‚                 <div class="p-4 border-t mt-auto" style="border-color: var(--main-primary-dark-bg);"><p class="text-xs" style="color: var(--main-white-text); opacity:0.7;">&copy; <span id="currentYear"></span> Nuestra InstituciÃ³n</p></div>
â”‚   â”‚             </aside>
â”‚   â”‚             <div class="flex-1 flex flex-col overflow-hidden">
â”‚   â”‚                 <header class="bg-header shadow-md p-4 flex justify-between items-center print-hidden">
â”‚   â”‚                     <div class="flex items-center">
â”‚   â”‚                         <button id="sidebar-toggle" class="text-default hover:text-main-primary focus:outline-none md:hidden"><i class="fas fa-bars fa-lg"></i></button>
â”‚   â”‚                         <h1 id="main-title" class="text-2xl font-semibold text-header-title ml-2 md:ml-0">{% block page_title_header %}{{ page_title_for_header|default:"Panel Principal" }}{% endblock %}</h1>
â”‚   â”‚                     </div>
â”‚   â”‚                     <div class="flex items-center space-x-3 md:space-x-4">
â”‚   â”‚                         <button id="search-button" class="text-default hover:text-main-primary focus:outline-none"> <i class="fas fa-search fa-lg"></i> </button>
â”‚   â”‚                         <button id="theme-toggle" class="text-default hover:text-main-primary focus:outline-none"><i class="fas fa-moon fa-lg"></i></button>
â”‚   â”‚                         <div class="relative">
â”‚   â”‚                             <button id="notifications-button" class="text-default hover:text-main-primary focus:outline-none">
â”‚   â”‚                                 <i class="fas fa-bell fa-lg"></i>
â”‚   â”‚                                 <span class="absolute -top-1 -right-1 flex h-3 w-3">
â”‚   â”‚                                     <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-main-secondary opacity-75"></span>
â”‚   â”‚                                     <span class="relative inline-flex rounded-full h-3 w-3 bg-main-secondary"></span>
â”‚   â”‚                                 </span>
â”‚   â”‚                             </button>
â”‚   â”‚                             <div id="notifications-panel" class="hidden absolute right-0 mt-2 w-80 md:w-96 bg-card rounded-md shadow-xl z-50 border border-gray-200 dark:border-gray-700">
â”‚   â”‚                                 <div class="p-3 border-b border-gray-200 dark:border-gray-700"><h6 class="font-semibold text-default">Notificaciones</h6></div>
â”‚   â”‚                                 <div class="divide-y divide-gray-100 dark:divide-gray-700 max-h-80 overflow-y-auto">
â”‚   â”‚                                     <a href="#" class="block p-3 hover:bg-gray-50 dark:hover:bg-gray-700"><p class="text-sm font-medium text-default">Nueva tarea asignada: <span class="font-bold">Revisar informe</span></p><p class="text-xs text-muted">Hace 5 minutos</p></a>
â”‚   â”‚                                     <a href="#" class="block p-3 hover:bg-gray-50 dark:hover:bg-gray-700"><p class="text-sm text-default">Recordatorio: <span class="font-bold">ReuniÃ³n de equipo</span> maÃ±ana a las 10 AM.</p><p class="text-xs text-muted">Hace 1 hora</p></a>
â”‚   â”‚                                 </div>
â”‚   â”‚                                 <div class="p-2 text-center border-t border-gray-200 dark:border-gray-700"><a href="{% url 'intranet_core:notificaciones_page' %}" class="text-sm text-main-primary hover:underline nav-link">Ver todas</a></div>
â”‚   â”‚                             </div>
â”‚   â”‚                         </div>
â”‚   â”‚                         <div class="relative">
â”‚   â”‚                             <button id="user-menu-button" class="flex items-center space-x-2 focus:outline-none">
â”‚   â”‚                                 <img src="{% static 'images/default_avatar.png' %}" alt="Avatar Usuario" class="w-9 h-9 rounded-full border-2 border-gray-300 hover:border-main-primary transition-colors">
â”‚   â”‚                                 <span class="text-sm font-medium text-default hidden md:block">{% if user.is_authenticated %}{{ user.get_full_name|default:user.username }}{% else %}Invitado{% endif %}</span>
â”‚   â”‚                                 <i class="fas fa-chevron-down text-xs text-default opacity-70"></i>
â”‚   â”‚                             </button>
â”‚   â”‚                             <div id="user-menu" class="hidden absolute right-0 mt-2 w-56 bg-card rounded-md shadow-xl py-1 z-50 border border-gray-200 dark:border-gray-700">
â”‚   â”‚                                 {% if user.is_authenticated %}
â”‚   â”‚                                     <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700"><p class="text-sm font-semibold text-main-primary">{{ user.get_full_name|default:user.username }}</p><p class="text-xs text-muted">{{ user.email|default:"-" }}</p></div>
â”‚   â”‚                                     <a href="{% url 'intranet_core:perfil' %}" class="block px-4 py-2 text-sm text-default hover:bg-main-primary hover:text-main-white transition-colors">Mi Perfil</a>
â”‚   â”‚                                     <a href="{% url 'intranet_core:configuracion' %}" class="block px-4 py-2 text-sm text-default hover:bg-main-primary hover:text-main-white transition-colors">ConfiguraciÃ³n</a>
â”‚   â”‚                                     <hr class="my-1 border-gray-200 dark:border-gray-700">
â”‚   â”‚                                     <form method="post" action="{% url 'logout' %}">{% csrf_token %}<button type="submit" id="logout-button" class="w-full text-left block px-4 py-2 text-sm text-main-secondary hover:bg-main-secondary hover:text-main-white transition-colors">Cerrar SesiÃ³n</button></form>
â”‚   â”‚                                 {% else %}
â”‚   â”‚                                      <a href="{% url 'login' %}" class="block px-4 py-2 text-sm text-main-primary hover:bg-main-primary hover:text-main-white transition-colors">Iniciar SesiÃ³n</a>
â”‚   â”‚                                 {% endif %}
â”‚   â”‚                             </div>
â”‚   â”‚                         </div>
â”‚   â”‚                     </div>
â”‚   â”‚                 </header>
â”‚   â”‚                 <main class="flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-6 lg:p-8">
â”‚   â”‚                     {% block content %}{% endblock %}
â”‚   â”‚                 </main>
â”‚   â”‚             </div>
â”‚   â”‚         </div>
â”‚   â”‚         <script src="{% static 'js/intranet_scripts.js' %}"></script>
â”‚   â”‚         {% block extra_js %}{% endblock %}
â”‚   â”‚     </body>
â”‚   â”‚     </html>
â”‚   â”‚   --- FIN CONTENIDO (base.html) ---

â”‚   â”œâ”€â”€ intranet_core
â”‚   â”‚   â”œâ”€â”€ calendario.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (calendario.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Calendario de Actividades{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Calendario de Actividades{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="content-section">
â”‚   â”‚   â”‚         <div class="flex justify-between items-center mb-6">
â”‚   â”‚   â”‚             <h2 class="text-xl md:text-2xl font-semibold text-main-primary">Calendario de Actividades</h2>
â”‚   â”‚   â”‚             <button class="bg-main-secondary hover:bg-main-secondary-dark text-main-white font-medium py-2 px-4 rounded-md flex items-center">
â”‚   â”‚   â”‚                 <i class="fas fa-plus mr-2"></i> Nueva Actividad
â”‚   â”‚   â”‚             </button>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚          <div class="bg-card p-4 md:p-6 rounded-xl shadow-lg">
â”‚   â”‚   â”‚             <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md p-8 text-center">
â”‚   â”‚   â”‚                 <i class="fas fa-calendar-alt fa-3x text-gray-400 mb-4"></i>
â”‚   â”‚   â”‚                 <p class="text-muted py-8">Un calendario interactivo (como FullCalendar.js o similar) se integrarÃ­a aquÃ­.</p>
â”‚   â”‚   â”‚                 <p class="text-sm text-muted mt-2">La implementaciÃ³n de un calendario funcional requiere una librerÃ­a de JavaScript y lÃ³gica de backend para manejar eventos.</p>
â”‚   â”‚   â”‚                 <div class="mt-6">
â”‚   â”‚   â”‚                     <div class="flex justify-between items-center mb-4">
â”‚   â”‚   â”‚                         <button class="text-main-primary"><i class="fas fa-chevron-left"></i> Mes Anterior</button>
â”‚   â”‚   â”‚                         <h3 class="text-lg font-semibold text-default">Mayo 2025</h3>
â”‚   â”‚   â”‚                         <button class="text-main-primary">Mes Siguiente <i class="fas fa-chevron-right"></i></button>
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                     <div class="calendar-grid">
â”‚   â”‚   â”‚                         <div class="calendar-day-header">Lun</div>
â”‚   â”‚   â”‚                         <div class="calendar-day-header">Mar</div>
â”‚   â”‚   â”‚                         <div class="calendar-day-header">MiÃ©</div>
â”‚   â”‚   â”‚                         <div class="calendar-day-header">Jue</div>
â”‚   â”‚   â”‚                         <div class="calendar-day-header">Vie</div>
â”‚   â”‚   â”‚                         <div class="calendar-day-header">SÃ¡b</div>
â”‚   â”‚   â”‚                         <div class="calendar-day-header">Dom</div>
â”‚   â”‚   â”‚                         
â”‚   â”‚   â”‚                         {% for day in ""|center:35 %} {# Simula celdas de un mes #}
â”‚   â”‚   â”‚                         <div class="calendar-day {% if forloop.counter < 5 or forloop.counter > 32 %}other-month{% endif %}">
â”‚   â”‚   â”‚                             <span class="text-sm">{{ forloop.counter0|add:28|remainder:31|add:1 }}</span>
â”‚   â”‚   â”‚                             {% if forloop.counter == 15 %}
â”‚   â”‚   â”‚                             <span class="event bg-blue-500">ReuniÃ³n Equipo</span>
â”‚   â”‚   â”‚                             {% endif %}
â”‚   â”‚   â”‚                             {% if forloop.counter == 22 %}
â”‚   â”‚   â”‚                             <span class="event bg-red-500">Entrega Informe</span>
â”‚   â”‚   â”‚                             {% endif %}
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                         {% endfor %}
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚          </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (calendario.html) ---

â”‚   â”‚   â”œâ”€â”€ carga_archivos.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (carga_archivos.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Gestor de Archivos{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Gestor de Archivos{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
â”‚   â”‚   â”‚         <h2 class="text-2xl font-semibold text-main-primary dark:text-blue-400">Gestor de Archivos</h2>
â”‚   â”‚   â”‚         <button type="button" onclick="document.getElementById('modal-crear-carpeta').classList.remove('hidden'); document.getElementById('modal-crear-carpeta').querySelector('input[name=\'nombre\']').focus();" 
â”‚   â”‚   â”‚                 class="bg-main-secondary hover:bg-main-secondary-dark text-main-white font-medium py-2 px-4 rounded-md flex items-center text-sm transition-colors duration-150">
â”‚   â”‚   â”‚             <i class="fas fa-folder-plus mr-2"></i> Nueva Carpeta
â”‚   â”‚   â”‚         </button>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {# Modal para Crear Carpeta #}
â”‚   â”‚   â”‚     <div id="modal-crear-carpeta" class="fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full flex items-center justify-center hidden z-50 transition-opacity duration-300 ease-out" onclick="event.target === this && this.classList.add('hidden')">
â”‚   â”‚   â”‚         <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-card dark:bg-gray-800" onclick="event.stopPropagation();">
â”‚   â”‚   â”‚             <div class="mt-3">
â”‚   â”‚   â”‚                 <div class="flex justify-between items-center mb-4">
â”‚   â”‚   â”‚                     <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">Crear Nueva Carpeta</h3>
â”‚   â”‚   â”‚                     <button type="button" onclick="document.getElementById('modal-crear-carpeta').classList.add('hidden')" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
â”‚   â”‚   â”‚                         <i class="fas fa-times fa-lg"></i>
â”‚   â”‚   â”‚                     </button>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚                 <form method="POST" action="{% url 'intranet_core:carga_archivos' %}" class="space-y-4">
â”‚   â”‚   â”‚                     {% csrf_token %}
â”‚   â”‚   â”‚                     <input type="hidden" name="action" value="create_folder">
â”‚   â”‚   â”‚                     <div>
â”‚   â”‚   â”‚                         <label for="{{ form_crear_carpeta.nombre.id_for_label }}" class="sr-only">{{ form_crear_carpeta.nombre.label }}</label>
â”‚   â”‚   â”‚                         {{ form_crear_carpeta.nombre }} {# Widget ya tiene clases de forms.py #}
â”‚   â”‚   â”‚                         {% if form_crear_carpeta.nombre.errors %}
â”‚   â”‚   â”‚                             {% for error in form_crear_carpeta.nombre.errors %}
â”‚   â”‚   â”‚                                 <p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>
â”‚   â”‚   â”‚                             {% endfor %}
â”‚   â”‚   â”‚                         {% endif %}
â”‚   â”‚   â”‚                          {% if form_crear_carpeta.non_field_errors %} {# Errores generales del form de carpeta, ej. unique_together #}
â”‚   â”‚   â”‚                             {% for error in form_crear_carpeta.non_field_errors %}
â”‚   â”‚   â”‚                                 <p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>
â”‚   â”‚   â”‚                             {% endfor %}
â”‚   â”‚   â”‚                         {% endif %}
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                     <div class="flex justify-end items-center pt-3 space-x-3">
â”‚   â”‚   â”‚                         <button type="button" onclick="document.getElementById('modal-crear-carpeta').classList.add('hidden')" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 text-base font-medium rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 dark:focus:ring-offset-gray-800">
â”‚   â”‚   â”‚                             Cancelar
â”‚   â”‚   â”‚                         </button>
â”‚   â”‚   â”‚                         <button id="ok-btn-crear-carpeta" type="submit" class="px-4 py-2 bg-main-primary text-white text-base font-medium rounded-md hover:bg-main-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-main-primary-dark dark:focus:ring-offset-gray-800">
â”‚   â”‚   â”‚                             Crear Carpeta
â”‚   â”‚   â”‚                         </button>
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                 </form>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {# SecciÃ³n de mensajes de Django #}
â”‚   â”‚   â”‚     <div id="django-messages-container" class="mb-6 space-y-3">
â”‚   â”‚   â”‚     {% if messages %}
â”‚   â”‚   â”‚         {% for message in messages %}
â”‚   â”‚   â”‚             <div class="p-4 rounded-md text-sm {% if message.tags == 'success' %}bg-green-100 border border-green-300 text-green-700 dark:bg-green-800 dark:border-green-600 dark:text-green-200{% elif message.tags == 'error' %}bg-red-100 border border-red-300 text-red-700 dark:bg-red-800 dark:border-red-600 dark:text-red-200{% else %}bg-blue-100 border border-blue-300 text-blue-700 dark:bg-blue-800 dark:border-blue-600 dark:text-blue-200{% endif %}" role="alert">
â”‚   â”‚   â”‚                 <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} mr-2"></i>
â”‚   â”‚   â”‚                 {{ message }}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         {% endfor %}
â”‚   â”‚   â”‚     {% endif %}
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {# Formulario para subir archivos #}
â”‚   â”‚   â”‚     <div class="bg-card dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg mb-8">
â”‚   â”‚   â”‚         <h3 class="text-xl font-semibold text-default dark:text-gray-100 mb-5 border-b border-gray-200 dark:border-gray-700 pb-3">Subir Nuevo Archivo</h3>
â”‚   â”‚   â”‚         <form method="POST" enctype="multipart/form-data" action="{% url 'intranet_core:carga_archivos' %}" class="space-y-6">
â”‚   â”‚   â”‚             {% csrf_token %} {# No action input aquÃ­, la vista lo detectarÃ¡ como subida de archivo por defecto #}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             {% if form_carga_archivo.non_field_errors %}
â”‚   â”‚   â”‚                 <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 dark:bg-red-800 dark:border-red-600 dark:text-red-200" role="alert">
â”‚   â”‚   â”‚                     <p class="font-bold">Error general al subir archivo:</p>
â”‚   â”‚   â”‚                     <ul class="mt-1 list-disc list-inside text-sm">
â”‚   â”‚   â”‚                     {% for error in form_carga_archivo.non_field_errors %}
â”‚   â”‚   â”‚                         <li>{{ error }}</li>
â”‚   â”‚   â”‚                     {% endfor %}
â”‚   â”‚   â”‚                     </ul>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form_carga_archivo.nombre_descriptivo.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form_carga_archivo.nombre_descriptivo.label }}</label>
â”‚   â”‚   â”‚                 {{ form_carga_archivo.nombre_descriptivo }}
â”‚   â”‚   â”‚                 {% if form_carga_archivo.nombre_descriptivo.help_text %}<p class="mt-2 text-xs text-gray-500 dark:text-gray-400">{{ form_carga_archivo.nombre_descriptivo.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                 {% for error in form_carga_archivo.nombre_descriptivo.errors %}<p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form_carga_archivo.archivo_subido.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form_carga_archivo.archivo_subido.label }}</label>
â”‚   â”‚   â”‚                 {{ form_carga_archivo.archivo_subido }}
â”‚   â”‚   â”‚                 <p id="file-upload-filename" class="mt-2 text-xs text-gray-500 dark:text-gray-400"></p>
â”‚   â”‚   â”‚                 {% if form_carga_archivo.archivo_subido.help_text %}<p class="mt-2 text-xs text-gray-500 dark:text-gray-400">{{ form_carga_archivo.archivo_subido.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                 {% for error in form_carga_archivo.archivo_subido.errors %}<p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             {% if form_carga_archivo.fields.carpeta %}
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form_carga_archivo.carpeta.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form_carga_archivo.carpeta.label }}</label>
â”‚   â”‚   â”‚                 {{ form_carga_archivo.carpeta }}
â”‚   â”‚   â”‚                 {% if form_carga_archivo.carpeta.help_text %}<p class="mt-2 text-xs text-gray-500 dark:text-gray-400">{{ form_carga_archivo.carpeta.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                 {% for error in form_carga_archivo.carpeta.errors %}<p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div class="pt-2">
â”‚   â”‚   â”‚                 <button type="submit" class="w-full md:w-auto bg-main-primary hover:bg-main-primary-dark text-main-white font-semibold py-2.5 px-6 rounded-lg flex items-center justify-center text-sm transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-main-primary-dark dark:focus:ring-offset-gray-800">
â”‚   â”‚   â”‚                     <i class="fas fa-upload mr-2"></i> Subir Archivo
â”‚   â”‚   â”‚                 </button>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </form>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {# Listado de Carpetas y Archivos #}
â”‚   â”‚   â”‚     <div class="bg-card dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚         <h3 class="text-xl font-semibold text-default dark:text-gray-100 mb-5 border-b border-gray-200 dark:border-gray-700 pb-3">
â”‚   â”‚   â”‚             Mis Archivos y Carpetas (RaÃ­z)
â”‚   â”‚   â”‚             {# AquÃ­ irÃ­an breadcrumbs si se implementa navegaciÃ³n de carpetas #}
â”‚   â”‚   â”‚         </h3>
â”‚   â”‚   â”‚         
â”‚   â”‚   â”‚         {% if carpetas %}
â”‚   â”‚   â”‚         <div class="mb-8">
â”‚   â”‚   â”‚             <h4 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-3">Carpetas</h4>
â”‚   â”‚   â”‚             <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
â”‚   â”‚   â”‚                 {% for carpeta_item in carpetas %}
â”‚   â”‚   â”‚                 {# El enlace '#' es un placeholder. Para navegaciÃ³n real, apuntarÃ­a a una URL con el ID de la carpeta. #}
â”‚   â”‚   â”‚                 <a href="#" class="group block p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200 ease-in-out shadow hover:shadow-md text-center">
â”‚   â”‚   â”‚                     <i class="fas fa-folder fa-3x text-yellow-500 dark:text-yellow-400 mb-2 group-hover:scale-110 transition-transform"></i>
â”‚   â”‚   â”‚                     <span class="text-sm font-medium text-gray-800 dark:text-gray-200 block truncate" title="{{ carpeta_item.nombre }}">{{ carpeta_item.nombre }}</span>
â”‚   â”‚   â”‚                 </a>
â”‚   â”‚   â”‚                 {% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         <h4 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 {% if carpetas %}mt-8 pt-4 border-t border-gray-200 dark:border-gray-700{% endif %}">Archivos en RaÃ­z</h4>
â”‚   â”‚   â”‚         {% if archivos_subidos %}
â”‚   â”‚   â”‚             <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700">
â”‚   â”‚   â”‚                 <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                     <thead class="bg-gray-50 dark:bg-gray-750">
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Nombre Descriptivo</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Archivo Original</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Subido el</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Acciones</th>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                     </thead>
â”‚   â”‚   â”‚                     <tbody id="file-list-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                         {% for archivo in archivos_subidos %}
â”‚   â”‚   â”‚                         <tr id="archivo-row-{{ archivo.id }}" class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-100">
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">{{ archivo.nombre_descriptivo|truncatechars:40|default:"-" }}</td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300">{{ archivo.nombre_original_archivo|truncatechars:30 }}</td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300">{{ archivo.fecha_subida|date:"d/m/Y, H:i" }}</td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
â”‚   â”‚   â”‚                                 <div class="flex justify-center items-center space-x-3">
â”‚   â”‚   â”‚                                     {# BotÃ³n Ver #}
â”‚   â”‚   â”‚                                     {% if archivo.is_viewable_in_browser %}
â”‚   â”‚   â”‚                                         <a href="{{ archivo.get_view_url }}" target="_blank" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 transition-colors duration-150" title="Ver {{ archivo.nombre_original_archivo }}">
â”‚   â”‚   â”‚                                             <i class="fas fa-eye fa-fw"></i>
â”‚   â”‚   â”‚                                         </a>
â”‚   â”‚   â”‚                                     {% else %}
â”‚   â”‚   â”‚                                         {# Opcional: mostrar un Ã­cono deshabilitado si no es visualizable, o no mostrar nada #}
â”‚   â”‚   â”‚                                         <span class="text-gray-400 dark:text-gray-500 cursor-not-allowed" title="Vista previa no disponible">
â”‚   â”‚   â”‚                                             <i class="fas fa-eye-slash fa-fw"></i>
â”‚   â”‚   â”‚                                         </span>
â”‚   â”‚   â”‚                                     {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚                                     {# BotÃ³n Editar #}
â”‚   â”‚   â”‚                                     <a href="{{ archivo.get_edit_url }}" class="text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300 transition-colors duration-150" title="Editar {{ archivo.nombre_descriptivo|default:archivo.nombre_original_archivo }}">
â”‚   â”‚   â”‚                                         <i class="fas fa-edit fa-fw"></i>
â”‚   â”‚   â”‚                                     </a>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚                                     {# BotÃ³n Descargar #}
â”‚   â”‚   â”‚                                     <a href="{{ archivo.archivo_subido.url }}" download="{{ archivo.nombre_original_archivo }}" class="text-main-primary hover:text-main-primary-dark dark:text-blue-400 dark:hover:text-blue-300 transition-colors duration-150" title="Descargar {{ archivo.nombre_original_archivo }}">
â”‚   â”‚   â”‚                                         <i class="fas fa-download fa-fw"></i>
â”‚   â”‚   â”‚                                     </a>
â”‚   â”‚   â”‚                                     
â”‚   â”‚   â”‚                                     {# Formulario Eliminar #}
â”‚   â”‚   â”‚                                     <form action="{% url 'intranet_core:carga_archivos' %}" method="POST" class="inline delete-file-form" data-confirm-message="Â¿EstÃ¡s seguro de que quieres eliminar '{{ archivo.nombre_descriptivo|escapejs|default:archivo.nombre_original_archivo|escapejs }}'? Esta acciÃ³n no se puede deshacer.">
â”‚   â”‚   â”‚                                         {% csrf_token %}
â”‚   â”‚   â”‚                                         <input type="hidden" name="action" value="delete_file">
â”‚   â”‚   â”‚                                         <input type="hidden" name="file_id" value="{{ archivo.id }}">
â”‚   â”‚   â”‚                                         <button type="submit" class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 transition-colors duration-150" title="Eliminar {{ archivo.nombre_descriptivo|default:archivo.nombre_original_archivo }}">
â”‚   â”‚   â”‚                                             <i class="fas fa-trash-alt fa-fw"></i>
â”‚   â”‚   â”‚                                         </button>
â”‚   â”‚   â”‚                                     </form>
â”‚   â”‚   â”‚                                 </div>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                         {% endfor %}
â”‚   â”‚   â”‚                     </tbody>
â”‚   â”‚   â”‚                 </table>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚         
â”‚   â”‚   â”‚         {% if not carpetas and not archivos_subidos %}
â”‚   â”‚   â”‚              <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-10 text-center mt-8">
â”‚   â”‚   â”‚                 <i class="fas fa-folder-open fa-3x text-gray-400 dark:text-gray-500 mb-4"></i>
â”‚   â”‚   â”‚                 <p class="text-lg font-medium text-gray-700 dark:text-gray-300">Tu gestor de archivos estÃ¡ vacÃ­o.</p>
â”‚   â”‚   â”‚                 <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Empieza creando una carpeta o subiendo un archivo.</p>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         {% elif not archivos_subidos and carpetas %}
â”‚   â”‚   â”‚             <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-10 text-center mt-4">
â”‚   â”‚   â”‚                 <i class="fas fa-file-alt fa-3x text-gray-400 dark:text-gray-500 mb-4"></i>
â”‚   â”‚   â”‚                 <p class="text-lg font-medium text-gray-700 dark:text-gray-300">No hay archivos en la raÃ­z.</p>
â”‚   â”‚   â”‚                 <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Puedes subir archivos a la raÃ­z o dentro de las carpetas existentes.</p>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block extra_js %}
â”‚   â”‚   â”‚     <script>
â”‚   â”‚   â”‚     document.addEventListener('DOMContentLoaded', function () {
â”‚   â”‚   â”‚         // Mostrar nombre de archivo seleccionado en el formulario de subida principal
â”‚   â”‚   â”‚         const fileInputPrincipal = document.querySelector('form[action="{% url "intranet_core:carga_archivos" %}"] input[type="file"][name="archivo_subido"]');
â”‚   â”‚   â”‚         const fileUploadFilenameDisplayPrincipal = document.getElementById('file-upload-filename');
â”‚   â”‚   â”‚         if (fileInputPrincipal && fileUploadFilenameDisplayPrincipal) {
â”‚   â”‚   â”‚             fileInputPrincipal.addEventListener('change', function(e) {
â”‚   â”‚   â”‚                 if (e.target.files && e.target.files.length > 0) {
â”‚   â”‚   â”‚                     fileUploadFilenameDisplayPrincipal.textContent = 'Seleccionado: ' + e.target.files[0].name;
â”‚   â”‚   â”‚                 } else {
â”‚   â”‚   â”‚                     fileUploadFilenameDisplayPrincipal.textContent = '';
â”‚   â”‚   â”‚                 }
â”‚   â”‚   â”‚             });
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         // Manejo de mensajes de Django dinÃ¡micos para AJAX
â”‚   â”‚   â”‚         const messagesContainer = document.getElementById('django-messages-container');
â”‚   â”‚   â”‚         function showDynamicMessage(message, tags) {
â”‚   â”‚   â”‚             if (!messagesContainer) return;
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             let bgColor, borderColor, textColor, iconClass;
â”‚   â”‚   â”‚             if (tags.includes('success')) {
â”‚   â”‚   â”‚                 bgColor = 'bg-green-100 dark:bg-green-800';
â”‚   â”‚   â”‚                 borderColor = 'border-green-300 dark:border-green-600';
â”‚   â”‚   â”‚                 textColor = 'text-green-700 dark:text-green-200';
â”‚   â”‚   â”‚                 iconClass = 'fa-check-circle';
â”‚   â”‚   â”‚             } else if (tags.includes('error')) {
â”‚   â”‚   â”‚                 bgColor = 'bg-red-100 dark:bg-red-800';
â”‚   â”‚   â”‚                 borderColor = 'border-red-300 dark:border-red-600';
â”‚   â”‚   â”‚                 textColor = 'text-red-700 dark:text-red-200';
â”‚   â”‚   â”‚                 iconClass = 'fa-exclamation-circle';
â”‚   â”‚   â”‚             } else {
â”‚   â”‚   â”‚                 bgColor = 'bg-blue-100 dark:bg-blue-800';
â”‚   â”‚   â”‚                 borderColor = 'border-blue-300 dark:border-blue-600';
â”‚   â”‚   â”‚                 textColor = 'text-blue-700 dark:text-blue-200';
â”‚   â”‚   â”‚                 iconClass = 'fa-info-circle';
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             const messageDiv = document.createElement('div');
â”‚   â”‚   â”‚             messageDiv.className = `p-4 rounded-md text-sm ${bgColor} border ${borderColor} ${textColor} shadow`;
â”‚   â”‚   â”‚             messageDiv.setAttribute('role', 'alert');
â”‚   â”‚   â”‚             messageDiv.innerHTML = `<i class="fas ${iconClass} mr-2"></i> ${message}`;
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             messagesContainer.insertBefore(messageDiv, messagesContainer.firstChild);
â”‚   â”‚   â”‚             setTimeout(() => {
â”‚   â”‚   â”‚                 messageDiv.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
â”‚   â”‚   â”‚                 messageDiv.style.opacity = '0';
â”‚   â”‚   â”‚                 messageDiv.style.transform = 'translateY(-20px)';
â”‚   â”‚   â”‚                 setTimeout(() => messageDiv.remove(), 500);
â”‚   â”‚   â”‚             }, 5000);
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         // EliminaciÃ³n de archivos con AJAX
â”‚   â”‚   â”‚         const fileListBody = document.getElementById('file-list-body');
â”‚   â”‚   â”‚         if (fileListBody) {
â”‚   â”‚   â”‚             fileListBody.addEventListener('submit', function(event) {
â”‚   â”‚   â”‚                 if (!event.target.classList.contains('delete-file-form')) {
â”‚   â”‚   â”‚                     return;
â”‚   â”‚   â”‚                 }
â”‚   â”‚   â”‚                 event.preventDefault();
â”‚   â”‚   â”‚                 const form = event.target;
â”‚   â”‚   â”‚                 
â”‚   â”‚   â”‚                 const confirmMessage = form.getAttribute('data-confirm-message');
â”‚   â”‚   â”‚                 if (!confirm(confirmMessage)) {
â”‚   â”‚   â”‚                     return;
â”‚   â”‚   â”‚                 }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚                 const formData = new FormData(form);
â”‚   â”‚   â”‚                 const url = form.action;
â”‚   â”‚   â”‚                 // const fileId = formData.get('file_id'); // No es necesario aquÃ­ si se usa data.file_id de la respuesta
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚                 fetch(url, {
â”‚   â”‚   â”‚                     method: 'POST',
â”‚   â”‚   â”‚                     body: formData,
â”‚   â”‚   â”‚                     headers: {
â”‚   â”‚   â”‚                         'X-CSRFToken': formData.get('csrfmiddlewaretoken'), 
â”‚   â”‚   â”‚                         'X-Requested-With': 'XMLHttpRequest',
â”‚   â”‚   â”‚                     }
â”‚   â”‚   â”‚                 })
â”‚   â”‚   â”‚                 .then(response => {
â”‚   â”‚   â”‚                     if (!response.ok) {
â”‚   â”‚   â”‚                         // Intenta parsear el error JSON si existe, sino lanza error genÃ©rico
â”‚   â”‚   â”‚                         return response.json().then(errData => { 
â”‚   â”‚   â”‚                             throw {jsonError: errData, status: response.status}; 
â”‚   â”‚   â”‚                         }).catch(() => {
â”‚   â”‚   â”‚                             throw {message: `Error HTTP ${response.status}`, status: response.status};
â”‚   â”‚   â”‚                         });
â”‚   â”‚   â”‚                     }
â”‚   â”‚   â”‚                     return response.json();
â”‚   â”‚   â”‚                 })
â”‚   â”‚   â”‚                 .then(data => {
â”‚   â”‚   â”‚                     if (data.status === 'success') {
â”‚   â”‚   â”‚                         const rowToRemove = document.getElementById('archivo-row-' + data.file_id);
â”‚   â”‚   â”‚                         if (rowToRemove) {
â”‚   â”‚   â”‚                             rowToRemove.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
â”‚   â”‚   â”‚                             rowToRemove.style.opacity = '0';
â”‚   â”‚   â”‚                             rowToRemove.style.transform = 'scale(0.95)';
â”‚   â”‚   â”‚                             setTimeout(() => rowToRemove.remove(), 300);
â”‚   â”‚   â”‚                         }
â”‚   â”‚   â”‚                         showDynamicMessage(data.message, 'success');
â”‚   â”‚   â”‚                     } else {
â”‚   â”‚   â”‚                         showDynamicMessage(data.message || 'Error desconocido al procesar la solicitud.', 'error');
â”‚   â”‚   â”‚                     }
â”‚   â”‚   â”‚                 })
â”‚   â”‚   â”‚                 .catch(errorInfo => {
â”‚   â”‚   â”‚                     console.error('Error en la peticiÃ³n AJAX:', errorInfo);
â”‚   â”‚   â”‚                     let errorMessageToShow = 'Error de conexiÃ³n o respuesta inesperada del servidor.';
â”‚   â”‚   â”‚                     if (errorInfo && errorInfo.jsonError && errorInfo.jsonError.message) {
â”‚   â”‚   â”‚                         errorMessageToShow = errorInfo.jsonError.message;
â”‚   â”‚   â”‚                     } else if (errorInfo && errorInfo.message) {
â”‚   â”‚   â”‚                         errorMessageToShow = errorInfo.message;
â”‚   â”‚   â”‚                     }
â”‚   â”‚   â”‚                     showDynamicMessage(errorMessageToShow, 'error');
â”‚   â”‚   â”‚                 });
â”‚   â”‚   â”‚             });
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         // LÃ³gica para mostrar el modal de creaciÃ³n de carpeta si hay errores en ese formulario
â”‚   â”‚   â”‚         // Esto es Ãºtil si la pÃ¡gina se recarga despuÃ©s de un intento fallido de crear carpeta
â”‚   â”‚   â”‚         const modalCrearCarpeta = document.getElementById('modal-crear-carpeta');
â”‚   â”‚   â”‚         if (modalCrearCarpeta) {
â”‚   â”‚   â”‚             const carpetaFormErrores = modalCrearCarpeta.querySelectorAll('.text-red-600'); // Busca cualquier mensaje de error
â”‚   â”‚   â”‚             if (carpetaFormErrores.length > 0) {
â”‚   â”‚   â”‚                 // Verifica si la acciÃ³n que causÃ³ el error fue 'create_folder'
â”‚   â”‚   â”‚                 // Esto es un poco heurÃ­stico. Una mejor manera serÃ­a si la vista aÃ±ade una variable de contexto especÃ­fica.
â”‚   â”‚   â”‚                 // Por ahora, si hay errores en el form_crear_carpeta Y el modal estÃ¡ oculto, lo mostramos.
â”‚   â”‚   â”‚                 const urlParams = new URLSearchParams(window.location.search); // Para evitar mostrarlo si fue otra acciÃ³n
â”‚   â”‚   â”‚                 if (modalCrearCarpeta.classList.contains('hidden') && !urlParams.has('upload_success')) { 
â”‚   â”‚   â”‚                     // Solo mostrar si no venimos de una subida exitosa (para evitar reabrirlo innecesariamente)
â”‚   â”‚   â”‚                     // Esta lÃ³gica puede necesitar refinamiento para saber exactamente cuÃ¡ndo mostrarlo.
â”‚   â”‚   â”‚                     // Si el form de carpeta tiene errores (lo cual es detectado por los mensajes de error dentro del modal),
â”‚   â”‚   â”‚                     // y no hay un mensaje de Ã©xito de OTRA operaciÃ³n, podrÃ­a ser una indicaciÃ³n.
â”‚   â”‚   â”‚                     // Comprobamos especÃ­ficamente el error del campo nombre.
â”‚   â”‚   â”‚                     const nombreInput = modalCrearCarpeta.querySelector('input[name="nombre"]');
â”‚   â”‚   â”‚                     const sibling = nombreInput.nextElementSibling; // Asumiendo que el error estÃ¡ justo despuÃ©s
â”‚   â”‚   â”‚                     if (sibling && sibling.classList.contains('text-red-600')) {
â”‚   â”‚   â”‚                          // modalCrearCarpeta.classList.remove('hidden'); // Descomentar si quieres este comportamiento con mÃ¡s precisiÃ³n
â”‚   â”‚   â”‚                     }
â”‚   â”‚   â”‚                 }
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     });
â”‚   â”‚   â”‚     </script>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (carga_archivos.html) ---

â”‚   â”‚   â”œâ”€â”€ configuracion.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (configuracion.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}ConfiguraciÃ³n{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}ConfiguraciÃ³n{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚         <h2 class="text-xl font-semibold text-main-primary mb-4">ConfiguraciÃ³n</h2>
â”‚   â”‚   â”‚         <p class="text-default">AquÃ­ irÃ¡n las opciones de configuraciÃ³n de la cuenta o la intranet.</p>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (configuracion.html) ---

â”‚   â”‚   â”œâ”€â”€ dashboard.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (dashboard.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Panel Principal{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Panel Principal{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <h2 class="text-xl md:text-2xl font-semibold text-main-primary mb-6">
â”‚   â”‚   â”‚         Bienvenido, 
â”‚   â”‚   â”‚         <span class="font-bold">
â”‚   â”‚   â”‚             {% if user.is_authenticated %}
â”‚   â”‚   â”‚                 {{ user.get_full_name|default:user.username }}
â”‚   â”‚   â”‚             {% else %}
â”‚   â”‚   â”‚                 Nombre Usuario
â”‚   â”‚   â”‚             {% endif %}
â”‚   â”‚   â”‚         </span>!
â”‚   â”‚   â”‚     </h2>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6">
â”‚   â”‚   â”‚         <div class="bg-card p-5 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300">
â”‚   â”‚   â”‚             <div class="flex items-center">
â”‚   â”‚   â”‚                 <div class="p-3 rounded-full bg-blue-100 text-main-primary mr-4"><i class="fas fa-folder-open fa-2x"></i></div>
â”‚   â”‚   â”‚                 <div>
â”‚   â”‚   â”‚                     <p class="text-3xl font-bold text-default">{{ numero_archivos_totales|default:0 }}</p>
â”‚   â”‚   â”‚                     <p class="text-sm text-muted">Archivos Totales</p>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚         <div class="bg-card p-5 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300">
â”‚   â”‚   â”‚             <div class="flex items-center">
â”‚   â”‚   â”‚                 <div class="p-3 rounded-full bg-red-100 text-main-secondary mr-4"><i class="fas fa-edit fa-2x"></i></div>
â”‚   â”‚   â”‚                 <div>
â”‚   â”‚   â”‚                     <p class="text-3xl font-bold text-default">{{ numero_formularios_creados|default:0 }}</p>
â”‚   â”‚   â”‚                     <p class="text-sm text-muted">Formularios Creados</p>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚         <div class="bg-card p-5 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300">
â”‚   â”‚   â”‚             <div class="flex items-center">
â”‚   â”‚   â”‚                 <div class="p-3 rounded-full bg-yellow-100 text-yellow-500 mr-4"><i class="fas fa-bell fa-2x"></i></div>
â”‚   â”‚   â”‚                 <div>
â”‚   â”‚   â”‚                     <p class="text-3xl font-bold text-default">{{ numero_notificaciones_nuevas|default:0 }}</p>
â”‚   â”‚   â”‚                     <p class="text-sm text-muted">Notificaciones Nuevas</p>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚         <div class="bg-card p-5 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300">
â”‚   â”‚   â”‚             <div class="flex items-center">
â”‚   â”‚   â”‚                 <div class="p-3 rounded-full bg-purple-100 text-purple-500 mr-4"><i class="fas fa-sitemap fa-2x"></i></div>
â”‚   â”‚   â”‚                 <div>
â”‚   â”‚   â”‚                     <p class="text-3xl font-bold text-default">{{ numero_responsabilidades|default:0 }}</p>
â”‚   â”‚   â”‚                     <p class="text-sm text-muted">Responsabilidades</p>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     <div class="mt-8 bg-card rounded-xl shadow-lg overflow-hidden">
â”‚   â”‚   â”‚         <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700"><h3 class="text-lg font-semibold text-main-primary">Actividad Reciente del Sistema (Placeholder)</h3></div>
â”‚   â”‚   â”‚         <div class="overflow-x-auto max-h-96">
â”‚   â”‚   â”‚             <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                 <thead class="bg-gray-50 dark:bg-gray-700 sticky top-0 z-10">
â”‚   â”‚   â”‚                     <tr>
â”‚   â”‚   â”‚                         <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">Tipo</th>
â”‚   â”‚   â”‚                         <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">DescripciÃ³n</th>
â”‚   â”‚   â”‚                         <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider hidden sm:table-cell">Usuario</th>
â”‚   â”‚   â”‚                         <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">Fecha</th>
â”‚   â”‚   â”‚                         <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider">AcciÃ³n</th>
â”‚   â”‚   â”‚                     </tr>
â”‚   â”‚   â”‚                 </thead>
â”‚   â”‚   â”‚                 <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                     <tr>
â”‚   â”‚   â”‚                         <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Carga Archivo</span></td>
â”‚   â”‚   â”‚                         <td class="px-6 py-4 whitespace-nowrap text-sm text-default">Informe_Mensual.pdf</td>
â”‚   â”‚   â”‚                         <td class="px-6 py-4 whitespace-nowrap text-sm text-muted hidden sm:table-cell">j.perez</td>
â”‚   â”‚   â”‚                         <td class="px-6 py-4 whitespace-nowrap text-sm text-muted">15/05/2025 10:30</td>
â”‚   â”‚   â”‚                         <td class="px-6 py-4 whitespace-nowrap text-sm font-medium"><a href="#" class="text-main-primary hover:underline">Ver</a></td>
â”‚   â”‚   â”‚                     </tr>
â”‚   â”‚   â”‚                     <tr>
â”‚   â”‚   â”‚                         <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200">Formulario</span></td>
â”‚   â”‚   â”‚                         <td class="px-6 py-4 whitespace-nowrap text-sm text-default">Encuesta de SatisfacciÃ³n creada</td>
â”‚   â”‚   â”‚                         <td class="px-6 py-4 whitespace-nowrap text-sm text-muted hidden sm:table-cell">m.diaz</td>
â”‚   â”‚   â”‚                         <td class="px-6 py-4 whitespace-nowrap text-sm text-muted">15/05/2025 09:45</td>
â”‚   â”‚   â”‚                         <td class="px-6 py-4 whitespace-nowrap text-sm font-medium"><a href="#" class="text-main-primary hover:underline">Editar</a></td>
â”‚   â”‚   â”‚                     </tr>
â”‚   â”‚   â”‚                 </tbody>
â”‚   â”‚   â”‚             </table>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚         <div class="px-6 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700 text-right">
â”‚   â”‚   â”‚             <button class="text-sm text-main-primary hover:underline font-medium">Ver todo &rarr;</button>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (dashboard.html) ---

â”‚   â”‚   â”œâ”€â”€ directorio.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (directorio.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Directorio de Usuarios{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Directorio de Usuarios{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="content-section">
â”‚   â”‚   â”‚         <h2 class="text-xl md:text-2xl font-semibold text-main-primary mb-6">Directorio de Usuarios</h2>
â”‚   â”‚   â”‚         <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚             <p class="text-muted mb-4">Busque usuarios en la instituciÃ³n o explore el organigrama.</p>
â”‚   â”‚   â”‚             <div class="mb-6">
â”‚   â”‚   â”‚                 <input type="text" placeholder="Buscar por nombre, departamento, cargo..." class="w-full p-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-main-primary focus:border-transparent">
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md p-8 text-center">
â”‚   â”‚   â”‚                 <i class="fas fa-address-book fa-3x text-gray-400 mb-4"></i>
â”‚   â”‚   â”‚                 <p class="text-muted">VisualizaciÃ³n del organigrama y listado de usuarios (con filtros y bÃºsqueda avanzada) aparecerÃ¡ aquÃ­.</p>
â”‚   â”‚   â”‚                 <p class="text-sm text-muted mt-2">RequerirÃ­a modelos de datos para usuarios, departamentos, y posiblemente una librerÃ­a JS para el organigrama.</p>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div class="mt-8">
â”‚   â”‚   â”‚                 <h3 class="text-lg font-semibold text-default mb-4">Listado de Usuarios (Ejemplo)</h3>
â”‚   â”‚   â”‚                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
â”‚   â”‚   â”‚                     <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg shadow">
â”‚   â”‚   â”‚                         <div class="flex items-center space-x-3">
â”‚   â”‚   â”‚                             <img src="{% static 'images/default_avatar.png' %}" alt="Avatar" class="w-12 h-12 rounded-full">
â”‚   â”‚   â”‚                             <div>
â”‚   â”‚   â”‚                                 <h4 class="text-md font-semibold text-default">Juan PÃ©rez</h4>
â”‚   â”‚   â”‚                                 <p class="text-sm text-muted">Desarrollador Senior</p>
â”‚   â”‚   â”‚                                 <p class="text-xs text-main-primary">juan.perez@example.com</p>
â”‚   â”‚   â”‚                             </div>
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                     <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg shadow">
â”‚   â”‚   â”‚                         <div class="flex items-center space-x-3">
â”‚   â”‚   â”‚                             <img src="{% static 'images/default_avatar.png' %}" alt="Avatar" class="w-12 h-12 rounded-full"> <div>
â”‚   â”‚   â”‚                                 <h4 class="text-md font-semibold text-default">Maria GonzÃ¡lez</h4>
â”‚   â”‚   â”‚                                 <p class="text-sm text-muted">Jefa de Proyecto</p>
â”‚   â”‚   â”‚                                 <p class="text-xs text-main-primary">maria.gonzalez@example.com</p>
â”‚   â”‚   â”‚                             </div>
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                      <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg shadow">
â”‚   â”‚   â”‚                         <div class="flex items-center space-x-3">
â”‚   â”‚   â”‚                             <img src="{% static 'images/default_avatar.png' %}" alt="Avatar" class="w-12 h-12 rounded-full"> <div>
â”‚   â”‚   â”‚                                 <h4 class="text-md font-semibold text-default">Luis Rodriguez</h4>
â”‚   â”‚   â”‚                                 <p class="text-sm text-muted">Analista de Sistemas</p>
â”‚   â”‚   â”‚                                 <p class="text-xs text-main-primary">luis.rodriguez@example.com</p>
â”‚   â”‚   â”‚                             </div>
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (directorio.html) ---

â”‚   â”‚   â”œâ”€â”€ editar_archivo.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (editar_archivo.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Editar Archivo - {{ archivo.nombre_descriptivo|default:archivo.nombre_original_archivo }}{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Editar Archivo{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="bg-card dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
â”‚   â”‚   â”‚         <h2 class="text-xl md:text-2xl font-semibold text-main-primary dark:text-blue-400 mb-3">
â”‚   â”‚   â”‚             Editando: <span class="font-normal">{{ archivo.nombre_descriptivo|default:archivo.nombre_original_archivo }}</span>
â”‚   â”‚   â”‚         </h2>
â”‚   â”‚   â”‚         {% if archivo.archivo_subido %}
â”‚   â”‚   â”‚             <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Archivo actual:
â”‚   â”‚   â”‚                 <a href="{{ archivo.archivo_subido.url }}" target="_blank" class="text-main-primary hover:underline">
â”‚   â”‚   â”‚                     {{ archivo.nombre_original_archivo }}
â”‚   â”‚   â”‚                 </a> ({{ archivo.archivo_subido.size|filesizeformat }})
â”‚   â”‚   â”‚             </p>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚         <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">Subido el: {{ archivo.fecha_subida|date:"d M Y, H:i" }}</p>
â”‚   â”‚   â”‚         
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         <form method="POST" enctype="multipart/form-data" class="space-y-6">
â”‚   â”‚   â”‚             {% csrf_token %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             {% if form.non_field_errors %}
â”‚   â”‚   â”‚                 <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 dark:bg-red-800 dark:border-red-600 dark:text-red-200" role="alert">
â”‚   â”‚   â”‚                     <p class="font-bold">Error general:</p>
â”‚   â”‚   â”‚                     <ul class="mt-1 list-disc list-inside text-sm">
â”‚   â”‚   â”‚                     {% for error in form.non_field_errors %}
â”‚   â”‚   â”‚                         <li>{{ error }}</li>
â”‚   â”‚   â”‚                     {% endfor %}
â”‚   â”‚   â”‚                     </ul>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             {# Nombre Descriptivo #}
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form.nombre_descriptivo.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form.nombre_descriptivo.label }}</label>
â”‚   â”‚   â”‚                 {{ form.nombre_descriptivo }}
â”‚   â”‚   â”‚                 {% if form.nombre_descriptivo.help_text %}<p class="mt-2 text-xs text-gray-500 dark:text-gray-400">{{ form.nombre_descriptivo.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                 {% for error in form.nombre_descriptivo.errors %}<p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             {# Carpeta #}
â”‚   â”‚   â”‚             {% if form.fields.carpeta %}
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form.carpeta.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form.carpeta.label }}</label>
â”‚   â”‚   â”‚                 {{ form.carpeta }}
â”‚   â”‚   â”‚                 {% if form.carpeta.help_text %}<p class="mt-2 text-xs text-gray-500 dark:text-gray-400">{{ form.carpeta.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                 {% for error in form.carpeta.errors %}<p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             {# Reemplazar Archivo #}
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form.archivo_subido.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form.archivo_subido.label }}</label>
â”‚   â”‚   â”‚                 {{ form.archivo_subido }}
â”‚   â”‚   â”‚                 <p id="file-edit-filename" class="mt-2 text-xs text-gray-500 dark:text-gray-400"></p>
â”‚   â”‚   â”‚                 {% if form.archivo_subido.help_text %}<p class="mt-2 text-xs text-gray-500 dark:text-gray-400">{{ form.archivo_subido.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                 {% for error in form.archivo_subido.errors %}<p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div class="pt-4 flex items-center space-x-4">
â”‚   â”‚   â”‚                 <button type="submit" class="bg-main-primary hover:bg-main-primary-dark text-main-white font-semibold py-2 px-5 rounded-md text-sm transition-colors duration-150">
â”‚   â”‚   â”‚                     <i class="fas fa-save mr-2"></i> Guardar Cambios
â”‚   â”‚   â”‚                 </button>
â”‚   â”‚   â”‚                 <a href="{% url 'intranet_core:carga_archivos' %}" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100 text-sm">
â”‚   â”‚   â”‚                     Cancelar
â”‚   â”‚   â”‚                 </a>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </form>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block extra_js %}
â”‚   â”‚   â”‚     <script>
â”‚   â”‚   â”‚     document.addEventListener('DOMContentLoaded', function () {
â”‚   â”‚   â”‚         const fileInput = document.querySelector('input[type="file"][name="archivo_subido"]'); // Puede haber otro en la misma pÃ¡gina base
â”‚   â”‚   â”‚         const fileEditFilenameDisplay = document.getElementById('file-edit-filename');
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         if (fileInput && fileEditFilenameDisplay) {
â”‚   â”‚   â”‚             fileInput.addEventListener('change', function(e) {
â”‚   â”‚   â”‚                 if (e.target.files && e.target.files.length > 0) {
â”‚   â”‚   â”‚                     fileEditFilenameDisplay.textContent = 'Nuevo archivo seleccionado: ' + e.target.files[0].name;
â”‚   â”‚   â”‚                 } else {
â”‚   â”‚   â”‚                     // Si el usuario limpia la selecciÃ³n (ej. con ClearableFileInput), el texto podrÃ­a borrarse
â”‚   â”‚   â”‚                     // o indicar "No se reemplazarÃ¡ el archivo"
â”‚   â”‚   â”‚                     fileEditFilenameDisplay.textContent = 'No se ha seleccionado un nuevo archivo para reemplazar.';
â”‚   â”‚   â”‚                 }
â”‚   â”‚   â”‚             });
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     });
â”‚   â”‚   â”‚     </script>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (editar_archivo.html) ---

â”‚   â”‚   â”œâ”€â”€ formulario_crear.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (formulario_crear.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% block title_tag %}Crear Formulario{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Crear Nuevo Formulario{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
â”‚   â”‚   â”‚         <form method="POST" class="space-y-6">
â”‚   â”‚   â”‚             {% csrf_token %}
â”‚   â”‚   â”‚             {% if form.non_field_errors %}
â”‚   â”‚   â”‚                 <div class="p-3 bg-red-100 text-red-700 rounded-md">
â”‚   â”‚   â”‚                     {% for error in form.non_field_errors %}{{ error }}{% endfor %}
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form.titulo.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form.titulo.label }}</label>
â”‚   â”‚   â”‚                 {{ form.titulo }}
â”‚   â”‚   â”‚                 {% for error in form.titulo.errors %}<p class="mt-1 text-xs text-red-600">{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form.descripcion.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form.descripcion.label }}</label>
â”‚   â”‚   â”‚                 {{ form.descripcion }}
â”‚   â”‚   â”‚                 {% for error in form.descripcion.errors %}<p class="mt-1 text-xs text-red-600">{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form.fecha_limite.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form.fecha_limite.label }}</label>
â”‚   â”‚   â”‚                 {{ form.fecha_limite }}
â”‚   â”‚   â”‚                 {% if form.fecha_limite.help_text %}<p class="mt-1 text-xs text-gray-500">{{ form.fecha_limite.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                 {% for error in form.fecha_limite.errors %}<p class="mt-1 text-xs text-red-600">{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             <div class="flex items-center">
â”‚   â”‚   â”‚                 {{ form.activo }}
â”‚   â”‚   â”‚                 <label for="{{ form.activo.id_for_label }}" class="ml-2 block text-sm text-gray-900 dark:text-gray-200">{{ form.activo.label }}</label>
â”‚   â”‚   â”‚                  {% for error in form.activo.errors %}<p class="ml-2 text-xs text-red-600">{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div class="pt-4 flex items-center space-x-4">
â”‚   â”‚   â”‚                 <button type="submit" class="btn-primary"><i class="fas fa-plus-circle mr-2"></i> Crear y DiseÃ±ar Campos</button>
â”‚   â”‚   â”‚                 <a href="{% url 'intranet_core:formularios' %}" class="btn-secondary-outline">Cancelar</a>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </form>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (formulario_crear.html) ---

â”‚   â”‚   â”œâ”€â”€ formulario_disenar.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (formulario_disenar.html):
â”‚   â”‚   â”‚     {% raw %}{% block extra_css %}
â”‚   â”‚   â”‚     <style>
â”‚   â”‚   â”‚         .form-builder-container { 
â”‚   â”‚   â”‚             display: flex; 
â”‚   â”‚   â”‚             gap: 1.5rem; 
â”‚   â”‚   â”‚             flex-wrap: wrap; /* Permite que la paleta se mueva abajo en pantallas pequeÃ±as por defecto */
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .form-fields-palette {
â”‚   â”‚   â”‚             width: 100%; /* Ancho completo por defecto para mÃ³viles */
â”‚   â”‚   â”‚             flex-shrink: 0;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .form-canvas {
â”‚   â”‚   â”‚             flex-grow: 1;
â”‚   â”‚   â”‚             min-height: 400px;
â”‚   â”‚   â”‚             width: 100%; 
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         @media (min-width: 768px) { 
â”‚   â”‚   â”‚             .form-builder-container {
â”‚   â”‚   â”‚                 flex-wrap: nowrap; 
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚             .form-fields-palette {
â”‚   â”‚   â”‚                 width: 280px; 
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         .campo-form-item {
â”‚   â”‚   â”‚             border: 1px solid #e2e8f0;
â”‚   â”‚   â”‚             background-color: #f9fafb;
â”‚   â”‚   â”‚             padding: 1rem;
â”‚   â”‚   â”‚             border-radius: 0.5rem;
â”‚   â”‚   â”‚             margin-bottom: 1rem;
â”‚   â”‚   â”‚             position: relative;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .dark .campo-form-item {
â”‚   â”‚   â”‚             border-color: #4b5563;
â”‚   â”‚   â”‚             background-color: #374151;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .campo-form-item .field-controls {
â”‚   â”‚   â”‚             position: absolute;
â”‚   â”‚   â”‚             top: 0.5rem;
â”‚   â”‚   â”‚             right: 0.5rem;
â”‚   â”‚   â”‚             display: flex;
â”‚   â”‚   â”‚             gap: 0.5rem;
â”‚   â”‚   â”‚             z-index: 10;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .campo-form-item .field-controls button,
â”‚   â”‚   â”‚         .campo-form-item .field-delete-existing-container input[type="checkbox"] {
â”‚   â”‚   â”‚             background-color: #e5e7eb;
â”‚   â”‚   â”‚             border: none;
â”‚   â”‚   â”‚             border-radius: 0.25rem;
â”‚   â”‚   â”‚             padding: 0.25rem 0.5rem;
â”‚   â”‚   â”‚             cursor: pointer;
â”‚   â”‚   â”‚             font-size: 0.75rem;
â”‚   â”‚   â”‚             color: #374151;
â”‚   â”‚   â”‚             line-height: 1;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .campo-form-item .field-delete-existing-container input[type="checkbox"] {
â”‚   â”‚   â”‚             padding: 0;
â”‚   â”‚   â”‚             height: 1rem; width: 1rem;
â”‚   â”‚   â”‚             margin-right: 0.25rem;
â”‚   â”‚   â”‚             vertical-align: middle;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .dark .campo-form-item .field-controls button,
â”‚   â”‚   â”‚         .dark .campo-form-item .field-delete-existing-container input[type="checkbox"] {
â”‚   â”‚   â”‚             background-color: #4b5563;
â”‚   â”‚   â”‚             color: #e5e7eb;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .dark .campo-form-item .field-delete-existing-container input[type="checkbox"] {
â”‚   â”‚   â”‚              border-color: #6b7280;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .campo-form-item .field-controls button:hover {
â”‚   â”‚   â”‚             background-color: #d1d5db;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .dark .campo-form-item .field-controls button:hover {
â”‚   â”‚   â”‚             background-color: #6b7280;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .field-drag-handle { cursor: grab; margin-right: 0.5rem; color: #9ca3af; padding: 0.5rem; }
â”‚   â”‚   â”‚         .sortable-ghost { 
â”‚   â”‚   â”‚             opacity: 0.4; 
â”‚   â”‚   â”‚             background: #e0f2fe !important; 
â”‚   â”‚   â”‚             border: 1px dashed #0ea5e9 !important; 
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .sortable-chosen { 
â”‚   â”‚   â”‚           box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
â”‚   â”‚   â”‚           opacity: 0.9;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         .palette-button {
â”‚   â”‚   â”‚             display: flex;
â”‚   â”‚   â”‚             align-items: center;
â”‚   â”‚   â”‚             width: 100%;
â”‚   â”‚   â”‚             text-align: left;
â”‚   â”‚   â”‚             padding: 0.65rem 1rem;
â”‚   â”‚   â”‚             margin-bottom: 0.5rem;
â”‚   â”‚   â”‚             border-radius: 0.375rem;
â”‚   â”‚   â”‚             background-color: #e9ecef; 
â”‚   â”‚   â”‚             color: #495057; 
â”‚   â”‚   â”‚             border: 1px solid #ced4da; 
â”‚   â”‚   â”‚             transition: background-color 0.2s;
â”‚   â”‚   â”‚             font-size: 0.875rem;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .dark .palette-button {
â”‚   â”‚   â”‚             background-color: #495057; 
â”‚   â”‚   â”‚             color: #f8f9fa; 
â”‚   â”‚   â”‚             border-color: #6c757d;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .palette-button:hover {
â”‚   â”‚   â”‚             background-color: #dde1e5; 
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .dark .palette-button:hover {
â”‚   â”‚   â”‚             background-color: #5a6268;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .palette-button i {
â”‚   â”‚   â”‚             margin-right: 0.75rem;
â”‚   â”‚   â”‚             width: 1.25em; 
â”‚   â”‚   â”‚             text-align: center;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .field-delete-existing-label {
â”‚   â”‚   â”‚             display: inline-flex;
â”‚   â”‚   â”‚             align-items: center;
â”‚   â”‚   â”‚             font-size: 0.75rem;
â”‚   â”‚   â”‚             color: #ef4444;
â”‚   â”‚   â”‚             cursor: pointer;
â”‚   â”‚   â”‚             padding: 0.25rem 0.5rem;
â”‚   â”‚   â”‚             background-color: #fee2e2;
â”‚   â”‚   â”‚             border-radius: 0.25rem;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .dark .field-delete-existing-label {
â”‚   â”‚   â”‚             color: #fca5a5;
â”‚   â”‚   â”‚             background-color: #7f1d1d;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .field-delete-existing-label:hover {
â”‚   â”‚   â”‚             background-color: #fecaca;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .dark .field-delete-existing-label:hover {
â”‚   â”‚   â”‚             background-color: #991b1b;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .field-delete-existing-label input[type="checkbox"] {
â”‚   â”‚   â”‚             margin-right: 0.375rem;
â”‚   â”‚   â”‚             height: 1em; width: 1em;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         /* Si necesitas las clases btn-primary y btn-secondary-outline, defÃ­nelas aquÃ­ o globalmente */
â”‚   â”‚   â”‚         /* Por ejemplo: */
â”‚   â”‚   â”‚         .btn-primary {
â”‚   â”‚   â”‚             background-color: var(--main-primary-bg, #0033A0); /* Usando fallback */
â”‚   â”‚   â”‚             color: var(--main-white-text, #FFFFFF);
â”‚   â”‚   â”‚             padding: 0.5rem 1rem; /* py-2 px-4 */
â”‚   â”‚   â”‚             border-radius: 0.375rem; /* rounded-md */
â”‚   â”‚   â”‚             font-weight: 500; /* font-medium */
â”‚   â”‚   â”‚             transition: background-color 0.2s;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .btn-primary:hover {
â”‚   â”‚   â”‚             background-color: var(--main-primary-dark-bg, #00227A);
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         .btn-secondary-outline {
â”‚   â”‚   â”‚             background-color: transparent;
â”‚   â”‚   â”‚             /* Usa las variables CSS de tu tema para el color del texto y el borde */
â”‚   â”‚   â”‚             color: var(--main-primary-text, #0033A0); 
â”‚   â”‚   â”‚             border: 1px solid var(--main-primary-border, #0033A0);
â”‚   â”‚   â”‚             padding: 0.5rem 1rem;
â”‚   â”‚   â”‚             border-radius: 0.375rem;
â”‚   â”‚   â”‚             font-weight: 500;
â”‚   â”‚   â”‚             transition: background-color 0.2s, color 0.2s, border-color 0.2s;
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .btn-secondary-outline:hover {
â”‚   â”‚   â”‚             background-color: var(--main-primary-bg, #0033A0);
â”‚   â”‚   â”‚             color: var(--main-white-text, #FFFFFF);
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .dark .btn-secondary-outline {
â”‚   â”‚   â”‚             /* Ajusta para modo oscuro si es necesario, o hereda de .btn-secondary-outline si las variables CSS ya manejan el modo oscuro */
â”‚   â”‚   â”‚             color: var(--main-primary-text, #7dd3fc); /* Ejemplo para texto azul claro en modo oscuro */
â”‚   â”‚   â”‚             border-color: var(--main-primary-border, #7dd3fc);
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         .dark .btn-secondary-outline:hover {
â”‚   â”‚   â”‚              background-color: var(--main-primary-text, #7dd3fc);
â”‚   â”‚   â”‚              color: var(--header-bg-color); /* Usar el color de fondo del header oscuro para el texto */
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     </style>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="mb-6 p-4 border border-gray-200 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-700/30">
â”‚   â”‚   â”‚         <div class="flex justify-between items-start">
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <h2 class="text-lg font-semibold text-default mb-1">{{ formulario.titulo }}</h2>
â”‚   â”‚   â”‚                 <p class="text-sm text-muted">{{ formulario.descripcion|default:"Sin descripciÃ³n." }}</p>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             <a href="{% url 'intranet_core:formulario_llenar' formulario.id %}" target="_blank" class="text-sm btn-secondary-outline whitespace-nowrap ml-4">
â”‚   â”‚   â”‚                 <i class="fas fa-eye mr-1"></i> Vista Previa
â”‚   â”‚   â”‚             </a>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚         <div class="mt-2 text-xs text-muted">
â”‚   â”‚   â”‚             <span>Creado: {{ formulario.creado_el|date:"d M Y, H:i" }}</span>
â”‚   â”‚   â”‚             {% if formulario.fecha_limite %} | <span>LÃ­mite: {{ formulario.fecha_limite|date:"d M Y, H:i" }}</span>{% endif %}
â”‚   â”‚   â”‚             | <span>Estado: {% if formulario.activo %}Activo{% else %}Inactivo{% endif %}</span>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% if messages %}
â”‚   â”‚   â”‚         <div class="mb-6 space-y-3">
â”‚   â”‚   â”‚         {% for message in messages %}
â”‚   â”‚   â”‚             <div class="p-4 rounded-md text-sm {% if message.tags == 'success' %}bg-green-100 border border-green-300 text-green-700 dark:bg-green-800 dark:border-green-600 dark:text-green-200{% elif message.tags == 'error' %}bg-red-100 border border-red-300 text-red-700 dark:bg-red-800 dark:border-red-600 dark:text-red-200{% else %}bg-blue-100 border border-blue-300 text-blue-700 dark:bg-blue-800 dark:border-blue-600 dark:text-blue-200{% endif %}" role="alert">
â”‚   â”‚   â”‚                 <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} mr-2"></i>
â”‚   â”‚   â”‚                 {{ message }}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         {% endfor %}
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     <form method="POST" enctype="multipart/form-data" id="camposFormset">
â”‚   â”‚   â”‚         {% csrf_token %}
â”‚   â”‚   â”‚         {{ formset.management_form }}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         <div class="form-builder-container md:flex-row flex-col">
â”‚   â”‚   â”‚             <div class="form-fields-palette bg-card dark:bg-gray-800 p-4 rounded-lg shadow-md mb-6 md:mb-0 md:sticky md:top-6 self-start">
â”‚   â”‚   â”‚                 <h3 class="text-md font-semibold text-default mb-3 border-b border-gray-200 dark:border-gray-600 pb-2">AÃ±adir Campo</h3>
â”‚   â”‚   â”‚                 {% for value, text in campo_tipos %}
â”‚   â”‚   â”‚                 <button type="button" class="palette-button add-field-from-palette" data-field-type="{{ value }}" title="AÃ±adir campo de tipo: {{text}}">
â”‚   â”‚   â”‚                     <i class="fas {% if value == 'TEXTO_CORTO' %}fa-font{% elif value == 'TEXTO_LARGO' %}fa-paragraph{% elif value == 'NUMERO' %}fa-hashtag{% elif value == 'EMAIL' %}fa-at{% elif value == 'FECHA' %}fa-calendar-alt{% elif value == 'HORA' %}fa-clock{% elif value == 'OPCION_MULTIPLE' %}fa-dot-circle{% elif value == 'CASILLAS' %}fa-check-square{% elif value == 'DESPLEGABLE' %}fa-caret-square-down{% elif value == 'ARCHIVO' %}fa-file-upload{% else %}fa-question-circle{% endif %}"></i> {{ text }}
â”‚   â”‚   â”‚                 </button>
â”‚   â”‚   â”‚                 {% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div class="form-canvas flex-grow">
â”‚   â”‚   â”‚                 <div id="formset-container" class="space-y-3">
â”‚   â”‚   â”‚                     {% if not formset.forms and not formset.non_form_errors %}
â”‚   â”‚   â”‚                     <div id="no-fields-message" class="text-center py-10 text-gray-500 dark:text-gray-400 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700/30">
â”‚   â”‚   â”‚                         <i class="fas fa-hand-pointer fa-3x mb-3"></i>
â”‚   â”‚   â”‚                         <p>Haz clic en un tipo de campo de la paleta para comenzar a construir tu formulario.</p>
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                     {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚                     {% for form_campo in formset %}
â”‚   â”‚   â”‚                     <div class="campo-form-item" data-form-id="{{ form_campo.prefix }}">
â”‚   â”‚   â”‚                         {{ form_campo.id }} {# Necesario para modelformset #}
â”‚   â”‚   â”‚                         {{ form_campo.orden }} {# Campo oculto para el orden #}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚                         <div class="field-controls">
â”‚   â”‚   â”‚                             <button type="button" class="field-control-button move-field-up" title="Mover Arriba"><i class="fas fa-arrow-up"></i></button>
â”‚   â”‚   â”‚                             <button type="button" class="field-control-button move-field-down" title="Mover Abajo"><i class="fas fa-arrow-down"></i></button>
â”‚   â”‚   â”‚                             {% if formset.can_delete %}
â”‚   â”‚   â”‚                                 {% if form_campo.instance.pk %} {# Si el campo ya existe en la BD #}
â”‚   â”‚   â”‚                                 <span class="field-delete-existing-container" title="Marcar para Eliminar">
â”‚   â”‚   â”‚                                     {{ form_campo.DELETE }}
â”‚   â”‚   â”‚                                     <label for="{{ form_campo.DELETE.id_for_label }}" class="field-delete-existing-label"><i class="fas fa-trash-alt ml-1"></i></label>
â”‚   â”‚   â”‚                                 </span>
â”‚   â”‚   â”‚                                 {% else %} {# Es un campo nuevo, no guardado aÃºn #}
â”‚   â”‚   â”‚                                 <button type="button" class="field-control-button delete-new-campo-button text-red-600 hover:text-red-700" title="Eliminar Campo"><i class="fas fa-trash-alt"></i></button>
â”‚   â”‚   â”‚                                 {% endif %}
â”‚   â”‚   â”‚                             {% endif %}
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                         
â”‚   â”‚   â”‚                         <div class="flex items-center mb-3">
â”‚   â”‚   â”‚                             <span class="field-drag-handle" title="Reordenar (arrastrar)"><i class="fas fa-grip-vertical"></i></span>
â”‚   â”‚   â”‚                             <h5 class="text-sm font-semibold text-default">Campo #<span class="field-number">{{ forloop.counter }}</span>: <span class="field-type-display">{{ form_campo.instance.get_tipo_campo_display|default:"Nuevo Campo" }}</span></h5>
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚                         {% if form_campo.non_field_errors %}
â”‚   â”‚   â”‚                             <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-3 rounded mb-3 text-xs" role="alert">
â”‚   â”‚   â”‚                                 <strong>Errores generales para este campo:</strong>
â”‚   â”‚   â”‚                                 <ul class="list-disc list-inside ml-4">{% for error in form_campo.non_field_errors %}<li>{{ error }}</li>{% endfor %}</ul>
â”‚   â”‚   â”‚                             </div>
â”‚   â”‚   â”‚                         {% endif %}
â”‚   â”‚   â”‚                          {% for field in form_campo %}
â”‚   â”‚   â”‚                             {% if field.name not in "id,orden,DELETE" %} {# No renderizar campos ocultos o el de borrar aquÃ­ explÃ­citamente #}
â”‚   â”‚   â”‚                                 <div class="mb-3 {% if field.name == 'opciones_choices' %} md:col-span-2 campo-opciones-container {% if form_campo.instance.tipo_campo not in 'OPCION_MULTIPLE,CASILLAS,DESPLEGABLE' and not form_campo.initial.tipo_campo in 'OPCION_MULTIPLE,CASILLAS,DESPLEGABLE' %}hidden{% endif %} {% elif field.name == 'etiqueta' %} md:col-span-2 {% elif field.name == 'es_obligatorio' %} md:col-span-2 flex items-center {% endif %}">
â”‚   â”‚   â”‚                                     <label for="{{ field.id_for_label }}" class="block text-xs font-medium text-gray-600 dark:text-gray-400 {% if field.name == 'es_obligatorio' %}ml-2{% else %}mb-1{% endif %}">{{ field.label }} {% if field.field.required and field.name != 'es_obligatorio' %}<span class="text-red-500">*</span>{% endif %}</label>
â”‚   â”‚   â”‚                                     {{ field }}
â”‚   â”‚   â”‚                                     {% if field.help_text %}<p class="mt-1 text-xs text-gray-500 dark:text-gray-400">{{ field.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                                     {% for error in field.errors %}<p class="mt-1 text-xs text-red-500 dark:text-red-400">{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚                                 </div>
â”‚   â”‚   â”‚                             {% endif %}
â”‚   â”‚   â”‚                         {% endfor %}
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                     {% endfor %}
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         <div id="empty-form-template" class="hidden">
â”‚   â”‚   â”‚             {# El contenido de este div se clona con JS para aÃ±adir nuevos campos #}
â”‚   â”‚   â”‚             {# Los nombres y IDs usarÃ¡n el prefijo del formset y '__prefix__' que JS reemplazarÃ¡ #}
â”‚   â”‚   â”‚             <div class="campo-form-item" data-form-id="{{ formset.empty_form.prefix }}">
â”‚   â”‚   â”‚                 {{ formset.empty_form.id }} 
â”‚   â”‚   â”‚                 {{ formset.empty_form.orden }} 
â”‚   â”‚   â”‚                 <div class="field-controls">
â”‚   â”‚   â”‚                      <button type="button" class="field-control-button move-field-up" title="Mover Arriba"><i class="fas fa-arrow-up"></i></button>
â”‚   â”‚   â”‚                      <button type="button" class="field-control-button move-field-down" title="Mover Abajo"><i class="fas fa-arrow-down"></i></button>
â”‚   â”‚   â”‚                      <button type="button" class="field-control-button delete-new-campo-button text-red-600 hover:text-red-700" title="Eliminar Campo"><i class="fas fa-trash-alt"></i></button>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚                 <div class="flex items-center mb-3">
â”‚   â”‚   â”‚                     <span class="field-drag-handle" title="Reordenar"><i class="fas fa-grip-vertical"></i></span>
â”‚   â”‚   â”‚                     <h5 class="text-sm font-semibold text-default">Campo #<span class="field-number"></span>: <span class="field-type-display"></span></h5>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚                 <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-3">
â”‚   â”‚   â”‚                     {% for field in formset.empty_form %}
â”‚   â”‚   â”‚                         {% if field.name not in "id,orden,DELETE" %}
â”‚   â”‚   â”‚                         <div class="mb-3 {% if field.name == 'opciones_choices' %} md:col-span-2 campo-opciones-container hidden {% elif field.name == 'etiqueta' %} md:col-span-2 {% elif field.name == 'es_obligatorio' %} md:col-span-2 flex items-center {% endif %}">
â”‚   â”‚   â”‚                             <label for="{{ field.id_for_label }}" class="block text-xs font-medium text-gray-600 dark:text-gray-400 {% if field.name == 'es_obligatorio' %}ml-2{% else %}mb-1{% endif %}">{{ field.label }} {% if field.field.required and field.name != 'es_obligatorio' %}<span class="text-red-500">*</span>{% endif %}</label>
â”‚   â”‚   â”‚                             {{ field }}
â”‚   â”‚   â”‚                             {% if field.help_text %}<p class="mt-1 text-xs text-gray-500 dark:text-gray-400">{{ field.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                         {% endif %}
â”‚   â”‚   â”‚                     {% endfor %}
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         <div class="mt-8 flex items-center justify-end space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700">
â”‚   â”‚   â”‚             <a href="{% url 'intranet_core:formularios' %}" class="btn-secondary-outline text-sm">Cancelar y Volver</a>
â”‚   â”‚   â”‚             <button type="submit" class="btn-primary text-sm">
â”‚   â”‚   â”‚                 <i class="fas fa-save mr-2"></i> Guardar DiseÃ±o del Formulario
â”‚   â”‚   â”‚             </button>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </form>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block extra_js %}
â”‚   â”‚   â”‚     <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
â”‚   â”‚   â”‚     <script>
â”‚   â”‚   â”‚     document.addEventListener('DOMContentLoaded', function () {
â”‚   â”‚   â”‚         const formsetContainer = document.getElementById('formset-container');
â”‚   â”‚   â”‚         const totalFormsInput = document.querySelector('input[name$="-TOTAL_FORMS"]'); // MÃ¡s genÃ©rico para encontrarlo
â”‚   â”‚   â”‚         const formsetPrefix = '{{ formset.prefix }}';
â”‚   â”‚   â”‚         const emptyFormHtmlTemplate = document.getElementById('empty-form-template').innerHTML;
â”‚   â”‚   â”‚         const noFieldsMessage = document.getElementById('no-fields-message');
â”‚   â”‚   â”‚         
â”‚   â”‚   â”‚         const campoTiposJsonString = '{{ campo_tipos_json_string|escapejs|default:"{}" }}'; // AÃ±adido default
â”‚   â”‚   â”‚         let campoTiposText = {};
â”‚   â”‚   â”‚         try {
â”‚   â”‚   â”‚             campoTiposText = JSON.parse(campoTiposJsonString);
â”‚   â”‚   â”‚         } catch (e) {
â”‚   â”‚   â”‚             console.error("Error al parsear campo_tipos_json_string:", e, "Valor recibido:", campoTiposJsonString);
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         function updateFormPresentation() {
â”‚   â”‚   â”‚             const campoForms = formsetContainer.querySelectorAll('.campo-form-item');
â”‚   â”‚   â”‚             campoForms.forEach((form, index) => {
â”‚   â”‚   â”‚                 const fieldNumberSpan = form.querySelector('.field-number');
â”‚   â”‚   â”‚                 if (fieldNumberSpan) fieldNumberSpan.textContent = index + 1;
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚                 const orderInput = form.querySelector('input[name$="-orden"]');
â”‚   â”‚   â”‚                 if (orderInput) orderInput.value = index;
â”‚   â”‚   â”‚                 
â”‚   â”‚   â”‚                 const upButton = form.querySelector('.move-field-up');
â”‚   â”‚   â”‚                 const downButton = form.querySelector('.move-field-down');
â”‚   â”‚   â”‚                 if (upButton) upButton.disabled = (index === 0);
â”‚   â”‚   â”‚                 if (downButton) downButton.disabled = (index === campoForms.length - 1);
â”‚   â”‚   â”‚             });
â”‚   â”‚   â”‚             if (noFieldsMessage) {
â”‚   â”‚   â”‚                 noFieldsMessage.style.display = campoForms.length === 0 ? 'block' : 'none';
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         
â”‚   â”‚   â”‚         function updateFormElementPrefixes(formElement, newIndex) {
â”‚   â”‚   â”‚             const currentPrefixMatch = formElement.dataset.formId ? formElement.dataset.formId.match(new RegExp(formsetPrefix + '-(\\d+|__prefix__)')) : null;
â”‚   â”‚   â”‚             const oldIndexPattern = currentPrefixMatch ? currentPrefixMatch[1] : '__prefix__';
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             formElement.dataset.formId = `${formsetPrefix}-${newIndex}`;
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             formElement.querySelectorAll('[name]').forEach(input => {
â”‚   â”‚   â”‚                 const oldName = input.getAttribute('name');
â”‚   â”‚   â”‚                 if (oldName) {
â”‚   â”‚   â”‚                     input.setAttribute('name', oldName.replace(new RegExp(`${formsetPrefix}-${oldIndexPattern}-`), `${formsetPrefix}-${newIndex}-`));
â”‚   â”‚   â”‚                 }
â”‚   â”‚   â”‚             });
â”‚   â”‚   â”‚             formElement.querySelectorAll('[id]').forEach(el => {
â”‚   â”‚   â”‚                 const oldId = el.getAttribute('id');
â”‚   â”‚   â”‚                 if (oldId) {
â”‚   â”‚   â”‚                      const newId = oldId.replace(new RegExp(`id_${formsetPrefix}-${oldIndexPattern}-`), `id_${formsetPrefix}-${newIndex}-`);
â”‚   â”‚   â”‚                      el.setAttribute('id', newId);
â”‚   â”‚   â”‚                      const label = document.querySelector(`label[for="${oldId}"]`);
â”‚   â”‚   â”‚                      if(label) label.setAttribute('for', newId);
â”‚   â”‚   â”‚                 }
â”‚   â”‚   â”‚             });
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         function reindexAllForms() {
â”‚   â”‚   â”‚             const campoForms = formsetContainer.querySelectorAll('.campo-form-item');
â”‚   â”‚   â”‚             totalFormsInput.value = campoForms.length; // Actualizar TOTAL_FORMS con el nÃºmero actual de forms visibles
â”‚   â”‚   â”‚             campoForms.forEach((form, index) => {
â”‚   â”‚   â”‚                 updateFormElementPrefixes(form, index);
â”‚   â”‚   â”‚             });
â”‚   â”‚   â”‚             updateFormPresentation();
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         
â”‚   â”‚   â”‚         function toggleOpcionesVisibility(tipoCampoSelect) {
â”‚   â”‚   â”‚             const campoFormDiv = tipoCampoSelect.closest('.campo-form-item');
â”‚   â”‚   â”‚             const opcionesDiv = campoFormDiv.querySelector('.campo-opciones-container');
â”‚   â”‚   â”‚             const tiposConOpciones = ['OPCION_MULTIPLE', 'CASILLAS', 'DESPLEGABLE'];
â”‚   â”‚   â”‚             if (opcionesDiv) {
â”‚   â”‚   â”‚                 opcionesDiv.classList.toggle('hidden', !tiposConOpciones.includes(tipoCampoSelect.value));
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         function addNewForm(fieldType = '', fieldLabelText = '') {
â”‚   â”‚   â”‚             if (!emptyFormHtmlTemplate) {
â”‚   â”‚   â”‚                 console.error("Plantilla de formulario vacÃ­o no encontrada."); return;
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚             let formIdx = 0;
â”‚   â”‚   â”‚             // Encontrar el prÃ³ximo Ã­ndice disponible basado en los existentes o TOTAL_FORMS
â”‚   â”‚   â”‚             const existingForms = formsetContainer.querySelectorAll('.campo-form-item');
â”‚   â”‚   â”‚             formIdx = existingForms.length; // El nuevo form serÃ¡ el siguiente al Ãºltimo actual
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             const tempDiv = document.createElement('div');
â”‚   â”‚   â”‚             // Reemplazar el prefijo placeholder con el nuevo Ã­ndice
â”‚   â”‚   â”‚             tempDiv.innerHTML = emptyFormHtmlTemplate.replace(/{{ formset.empty_form.prefix }}/g, `${formsetPrefix}-${formIdx}`);
â”‚   â”‚   â”‚             const newFormElement = tempDiv.firstElementChild;
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             // Actualizar el dataset para la lÃ³gica de reindexaciÃ³n
â”‚   â”‚   â”‚             newFormElement.dataset.formId = `${formsetPrefix}-${formIdx}`;
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             const tipoCampoSelect = newFormElement.querySelector(`select[name$="-tipo_campo"]`);
â”‚   â”‚   â”‚             const fieldTypeDisplaySpan = newFormElement.querySelector('.field-type-display');
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             if (tipoCampoSelect && fieldType) {
â”‚   â”‚   â”‚                 tipoCampoSelect.value = fieldType;
â”‚   â”‚   â”‚                 if (fieldTypeDisplaySpan && campoTiposText[fieldType]) {
â”‚   â”‚   â”‚                     fieldTypeDisplaySpan.textContent = campoTiposText[fieldType];
â”‚   â”‚   â”‚                 } else if (fieldTypeDisplaySpan) {
â”‚   â”‚   â”‚                     fieldTypeDisplaySpan.textContent = "Campo";
â”‚   â”‚   â”‚                 }
â”‚   â”‚   â”‚             } else if (fieldTypeDisplaySpan) {
â”‚   â”‚   â”‚                  fieldTypeDisplaySpan.textContent = "Nuevo Campo";
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             if(fieldLabelText){
â”‚   â”‚   â”‚                 const etiquetaInput = newFormElement.querySelector(`input[name$="-etiqueta"]`);
â”‚   â”‚   â”‚                 if(etiquetaInput) etiquetaInput.value = fieldLabelText;
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             // Asignar el campo 'orden' inicial
â”‚   â”‚   â”‚             const orderInput = newFormElement.querySelector('input[name$="-orden"]');
â”‚   â”‚   â”‚             if (orderInput) orderInput.value = formIdx;
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             formsetContainer.appendChild(newFormElement);
â”‚   â”‚   â”‚             totalFormsInput.value = formIdx + 1; // Incrementar el contador de formularios totales
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             initializeEventHandlersForField(newFormElement);
â”‚   â”‚   â”‚             updateFormPresentation(); // Actualizar numeraciÃ³n y botones
â”‚   â”‚   â”‚             if(tipoCampoSelect) toggleOpcionesVisibility(tipoCampoSelect);
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             if (noFieldsMessage) noFieldsMessage.style.display = 'none';
â”‚   â”‚   â”‚             newFormElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
â”‚   â”‚   â”‚             const firstInput = newFormElement.querySelector('input[type="text"], textarea, select');
â”‚   â”‚   â”‚             if (firstInput) firstInput.focus();
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         document.querySelectorAll('.add-field-from-palette').forEach(button => {
â”‚   â”‚   â”‚             button.addEventListener('click', function() {
â”‚   â”‚   â”‚                 const fieldType = this.dataset.fieldType;
â”‚   â”‚   â”‚                 const fieldLabel = campoTiposText[fieldType] || "Nuevo Campo";
â”‚   â”‚   â”‚                 addNewForm(fieldType, `Pregunta para ${fieldLabel.toLowerCase()}`);
â”‚   â”‚   â”‚             });
â”‚   â”‚   â”‚         });
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         function initializeEventHandlersForField(formElement) {
â”‚   â”‚   â”‚             const deleteButton = formElement.querySelector('.delete-new-campo-button');
â”‚   â”‚   â”‚             if (deleteButton) {
â”‚   â”‚   â”‚                 deleteButton.addEventListener('click', function () {
â”‚   â”‚   â”‚                     formElement.remove();
â”‚   â”‚   â”‚                     reindexAllForms(); // Reindexar y actualizar TOTAL_FORMS
â”‚   â”‚   â”‚                 });
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             const tipoCampoSelect = formElement.querySelector('select[name$="-tipo_campo"]');
â”‚   â”‚   â”‚             if (tipoCampoSelect) {
â”‚   â”‚   â”‚                 tipoCampoSelect.addEventListener('change', function() {
â”‚   â”‚   â”‚                     toggleOpcionesVisibility(this);
â”‚   â”‚   â”‚                     const fieldTypeDisplay = formElement.querySelector('.field-type-display');
â”‚   â”‚   â”‚                      if (fieldTypeDisplay && campoTiposText[this.value]) {
â”‚   â”‚   â”‚                         fieldTypeDisplay.textContent = campoTiposText[this.value];
â”‚   â”‚   â”‚                     } else if (fieldTypeDisplay) {
â”‚   â”‚   â”‚                         fieldTypeDisplay.textContent = "Personalizado";
â”‚   â”‚   â”‚                     }
â”‚   â”‚   â”‚                 });
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             formElement.querySelector('.move-field-up')?.addEventListener('click', () => moveField(formElement, 'up'));
â”‚   â”‚   â”‚             formElement.querySelector('.move-field-down')?.addEventListener('click', () => moveField(formElement, 'down'));
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚         
â”‚   â”‚   â”‚         function moveField(fieldElement, direction) {
â”‚   â”‚   â”‚             if (direction === 'up' && fieldElement.previousElementSibling) {
â”‚   â”‚   â”‚                 formsetContainer.insertBefore(fieldElement, fieldElement.previousElementSibling);
â”‚   â”‚   â”‚             } else if (direction === 'down' && fieldElement.nextElementSibling) {
â”‚   â”‚   â”‚                 formsetContainer.insertBefore(fieldElement.nextElementSibling, fieldElement);
â”‚   â”‚   â”‚             }
â”‚   â”‚   â”‚             reindexAllForms(); 
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         formsetContainer.querySelectorAll('.campo-form-item').forEach(form => {
â”‚   â”‚   â”‚             initializeEventHandlersForField(form);
â”‚   â”‚   â”‚             const tipoSelect = form.querySelector('select[name$="-tipo_campo"]');
â”‚   â”‚   â”‚             if(tipoSelect) toggleOpcionesVisibility(tipoSelect);
â”‚   â”‚   â”‚         });
â”‚   â”‚   â”‚         
â”‚   â”‚   â”‚         reindexAllForms(); 
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         if (typeof Sortable !== 'undefined' && formsetContainer) {
â”‚   â”‚   â”‚             new Sortable(formsetContainer, {
â”‚   â”‚   â”‚                 animation: 150,
â”‚   â”‚   â”‚                 handle: '.field-drag-handle',
â”‚   â”‚   â”‚                 ghostClass: 'sortable-ghost',
â”‚   â”‚   â”‚                 chosenClass: 'sortable-chosen',
â”‚   â”‚   â”‚                 onUpdate: function () { 
â”‚   â”‚   â”‚                     reindexAllForms(); 
â”‚   â”‚   â”‚                 }
â”‚   â”‚   â”‚             });
â”‚   â”‚   â”‚         }
â”‚   â”‚   â”‚     });
â”‚   â”‚   â”‚     </script>
â”‚   â”‚   â”‚     {% endblock %}{% endraw %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (formulario_disenar.html) ---

â”‚   â”‚   â”œâ”€â”€ formularios.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (formularios.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Creador de Formularios{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Creador de Formularios{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="content-section">
â”‚   â”‚   â”‚         <div class="flex justify-between items-center mb-6">
â”‚   â”‚   â”‚             <h2 class="text-xl md:text-2xl font-semibold text-main-primary">Creador de Formularios DinÃ¡micos</h2>
â”‚   â”‚   â”‚             <button class="bg-main-secondary hover:bg-main-secondary-dark text-main-white font-medium py-2 px-4 rounded-md flex items-center">
â”‚   â”‚   â”‚                 <i class="fas fa-plus mr-2"></i> Crear Nuevo Formulario
â”‚   â”‚   â”‚             </button>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚         <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg mb-8">
â”‚   â”‚   â”‚             <h3 class="text-lg font-semibold text-default mb-4">Mis Formularios</h3>
â”‚   â”‚   â”‚             <div class="overflow-x-auto">
â”‚   â”‚   â”‚                 <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                     <thead class="bg-gray-50 dark:bg-gray-700">
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">TÃ­tulo</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Fecha CreaciÃ³n</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Estado</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Respuestas</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Acciones</th>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                     </thead>
â”‚   â”‚   â”‚                     <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-default">Encuesta de Clima Laboral</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 text-sm text-muted">10/05/2025</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2"><span class="px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Activo</span></td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 text-sm text-muted">152</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 whitespace-nowrap text-sm space-x-2">
â”‚   â”‚   â”‚                                 <button class="text-main-primary hover:underline" title="Editar"><i class="fas fa-edit"></i></button>
â”‚   â”‚   â”‚                                 <button class="text-green-600 hover:underline" title="Ver Respuestas"><i class="fas fa-poll"></i></button>
â”‚   â”‚   â”‚                                 <button class="text-blue-600 hover:underline" title="Obtener Enlace"><i class="fas fa-link"></i></button>
â”‚   â”‚   â”‚                                 <button class="text-gray-500 hover:underline" title="Desactivar"><i class="fas fa-toggle-off"></i></button>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                         </tbody>
â”‚   â”‚   â”‚                 </table>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚         <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚             <h3 class="text-lg font-semibold text-default mb-4" id="form-builder-title">Crear Nuevo Formulario</h3>
â”‚   â”‚   â”‚             <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md p-8 text-center">
â”‚   â”‚   â”‚                 <i class="fas fa-tools fa-3x text-gray-400 mb-4"></i>
â”‚   â”‚   â”‚                 <p class="text-muted">Interfaz de creaciÃ³n de formularios (arrastrar y soltar campos, configuraciÃ³n, etc.) aparecerÃ¡ aquÃ­.</p>
â”‚   â”‚   â”‚                 <p class="text-sm text-muted mt-2">Esta secciÃ³n requerirÃ¡ una implementaciÃ³n de JavaScript mÃ¡s avanzada (ej. con librerÃ­as como FormBuilder.js o similar) para la funcionalidad de "arrastrar y soltar".</p>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (formularios.html) ---

â”‚   â”‚   â”œâ”€â”€ formularios_lista.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (formularios_lista.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Mis Formularios{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Mis Formularios{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚         <div class="flex justify-between items-center mb-6">
â”‚   â”‚   â”‚             <h2 class="text-xl md:text-2xl font-semibold text-main-primary">Mis Formularios Creados</h2>
â”‚   â”‚   â”‚             <a href="{% url 'intranet_core:formulario_crear' %}" class="bg-main-secondary hover:bg-main-secondary-dark text-main-white font-medium py-2 px-4 rounded-md flex items-center">
â”‚   â”‚   â”‚                 <i class="fas fa-plus mr-2"></i> Crear Nuevo Formulario
â”‚   â”‚   â”‚             </a>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         {% if messages %}
â”‚   â”‚   â”‚             {% for message in messages %}
â”‚   â”‚   â”‚                 <div class="p-4 mb-4 text-sm rounded-lg {% if message.tags == 'success' %}bg-green-100 text-green-700{% elif message.tags == 'error' %}bg-red-100 text-red-700{% else %}bg-blue-100 text-blue-700{% endif %}" role="alert">
â”‚   â”‚   â”‚                     {{ message }}
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             {% endfor %}
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         {% if formularios %}
â”‚   â”‚   â”‚             <div class="overflow-x-auto">
â”‚   â”‚   â”‚                 <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                     <thead class="bg-gray-50 dark:bg-gray-700">
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">TÃ­tulo</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Creado el</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Activo</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Respuestas</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Acciones</th>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                     </thead>
â”‚   â”‚   â”‚                     <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                         {% for formulario_obj in formularios %}
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-default">
â”‚   â”‚   â”‚                                 <a href="{{ formulario_obj.get_absolute_url }}" class="text-main-primary hover:underline">{{ formulario_obj.titulo }}</a>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                             <td class="px-4 py-3 whitespace-nowrap text-sm text-muted">{{ formulario_obj.creado_el|date:"d/m/Y H:i" }}</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-3 whitespace-nowrap text-sm text-muted">{% if formulario_obj.activo %}SÃ­{% else %}No{% endif %}</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-3 whitespace-nowrap text-sm text-muted">{{ formulario_obj.respuestas_recibidas.count }}</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-3 whitespace-nowrap text-sm space-x-2">
â”‚   â”‚   â”‚                                 <a href="{% url 'intranet_core:formulario_disenar' formulario_obj.id %}" class="text-yellow-600 hover:text-yellow-800" title="DiseÃ±ar Campos"><i class="fas fa-drafting-compass"></i></a>
â”‚   â”‚   â”‚                                 <a href="{% url 'intranet_core:formulario_respuestas' formulario_obj.id %}" class="text-green-600 hover:text-green-800" title="Ver Respuestas"><i class="fas fa-poll-h"></i></a>
â”‚   â”‚   â”‚                                 {# <a href="{% url 'intranet_core:formulario_editar' formulario_obj.id %}" class="text-blue-600 hover:text-blue-800" title="Editar ConfiguraciÃ³n"><i class="fas fa-cog"></i></a> #}
â”‚   â”‚   â”‚                                 {# <a href="{% url 'intranet_core:formulario_eliminar' formulario_obj.id %}" class="text-red-600 hover:text-red-800" title="Eliminar"><i class="fas fa-trash"></i></a> #}
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                         {% endfor %}
â”‚   â”‚   â”‚                     </tbody>
â”‚   â”‚   â”‚                 </table>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         {% else %}
â”‚   â”‚   â”‚             <div class="text-center py-8">
â”‚   â”‚   â”‚                 <i class="fas fa-file-alt fa-3x text-gray-400 mb-4"></i>
â”‚   â”‚   â”‚                 <p class="text-muted">No has creado ningÃºn formulario todavÃ­a.</p>
â”‚   â”‚   â”‚                 <a href="{% url 'intranet_core:formulario_crear' %}" class="mt-4 inline-block bg-main-primary hover:bg-main-primary-dark text-white font-medium py-2 px-4 rounded-md">
â”‚   â”‚   â”‚                     Crear mi primer formulario
â”‚   â”‚   â”‚                 </a>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (formularios_lista.html) ---

â”‚   â”‚   â”œâ”€â”€ notificaciones_page.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (notificaciones_page.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Notificaciones{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Notificaciones y Anuncios{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="flex justify-between items-center mb-6">
â”‚   â”‚   â”‚         <h2 class="text-xl md:text-2xl font-semibold text-main-primary dark:text-blue-400">Tus Notificaciones</h2>
â”‚   â”‚   â”‚         {% if notificaciones_no_leidas %}
â”‚   â”‚   â”‚         <form method="POST" action="{% url 'intranet_core:marcar_todas_notificaciones_leidas' %}">
â”‚   â”‚   â”‚             {% csrf_token %}
â”‚   â”‚   â”‚             <button type="submit" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-default font-medium py-2 px-4 rounded-md text-sm">
â”‚   â”‚   â”‚                 Marcar todas como leÃ­das
â”‚   â”‚   â”‚             </button>
â”‚   â”‚   â”‚         </form>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% if messages %}
â”‚   â”‚   â”‚         <div class="mb-6 space-y-3">
â”‚   â”‚   â”‚         {% for message in messages %}
â”‚   â”‚   â”‚             <div class="p-4 rounded-md text-sm {% if message.tags == 'success' %}bg-green-100 border border-green-300 text-green-700 dark:bg-green-800 dark:border-green-600 dark:text-green-200{% elif message.tags == 'error' %}bg-red-100 border border-red-300 text-red-700 dark:bg-red-800 dark:border-red-600 dark:text-red-200{% else %}bg-blue-100 border border-blue-300 text-blue-700 dark:bg-blue-800 dark:border-blue-600 dark:text-blue-200{% endif %}" role="alert">
â”‚   â”‚   â”‚                 <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} mr-2"></i>
â”‚   â”‚   â”‚                 {{ message }}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         {% endfor %}
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     <div class="space-y-6">
â”‚   â”‚   â”‚         {# Notificaciones No LeÃ­das #}
â”‚   â”‚   â”‚         {% if notificaciones_no_leidas %}
â”‚   â”‚   â”‚         <section>
â”‚   â”‚   â”‚             <h3 class="text-lg font-semibold text-default dark:text-gray-100 mb-3">Nuevas</h3>
â”‚   â”‚   â”‚             <div class="bg-card dark:bg-gray-800 p-4 md:p-6 rounded-xl shadow-lg space-y-3">
â”‚   â”‚   â”‚                 {% for notificacion in notificaciones_no_leidas %}
â”‚   â”‚   â”‚                 <div class="p-4 rounded-md bg-blue-50 dark:bg-blue-900/50 border-l-4 border-main-primary dark:border-blue-500 flex justify-between items-center">
â”‚   â”‚   â”‚                     <div>
â”‚   â”‚   â”‚                         <p class="text-sm text-gray-800 dark:text-gray-200">{{ notificacion.mensaje }}</p>
â”‚   â”‚   â”‚                         <span class="text-xs text-gray-500 dark:text-gray-400">{{ notificacion.fecha_creacion|date:"d M Y, H:i" }}</span>
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                     <a href="{% url 'intranet_core:marcar_notificacion_leida' notificacion.id %}" class="text-xs bg-main-primary text-white hover:bg-main-primary-dark py-1 px-2 rounded-full whitespace-nowrap">
â”‚   â”‚   â”‚                         {% if notificacion.url_destino %}Ver y Marcar LeÃ­da{% else %}Marcar LeÃ­da{% endif %}
â”‚   â”‚   â”‚                     </a>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚                 {% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </section>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         {# Notificaciones LeÃ­das (Historial) #}
â”‚   â”‚   â”‚         <section>
â”‚   â”‚   â”‚             <h3 class="text-lg font-semibold text-default dark:text-gray-100 mb-3">Historial (LeÃ­das)</h3>
â”‚   â”‚   â”‚             {% if notificaciones_leidas %}
â”‚   â”‚   â”‚             <div class="bg-card dark:bg-gray-800 p-4 md:p-6 rounded-xl shadow-lg space-y-3">
â”‚   â”‚   â”‚                 {% for notificacion in notificaciones_leidas %}
â”‚   â”‚   â”‚                 <div class="p-4 rounded-md bg-gray-100 dark:bg-gray-700/50 opacity-75">
â”‚   â”‚   â”‚                     <p class="text-sm text-gray-700 dark:text-gray-300">{{ notificacion.mensaje }}</p>
â”‚   â”‚   â”‚                     <span class="text-xs text-gray-500 dark:text-gray-400">{{ notificacion.fecha_creacion|date:"d M Y, H:i" }} - LeÃ­da</span>
â”‚   â”‚   â”‚                      {% if notificacion.url_destino %}
â”‚   â”‚   â”‚                         <a href="{{ notificacion.url_destino }}" class="text-xs text-main-primary hover:underline ml-2">Ir al enlace</a>
â”‚   â”‚   â”‚                     {% endif %}
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚                 {% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             {% else %}
â”‚   â”‚   â”‚                  <div class="bg-card dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg text-center">
â”‚   â”‚   â”‚                     <p class="text-gray-500 dark:text-gray-400">No hay notificaciones leÃ­das en tu historial reciente.</p>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             {% endif %}
â”‚   â”‚   â”‚         </section>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         {% if not notificaciones_no_leidas and not notificaciones_leidas %}
â”‚   â”‚   â”‚         <div class="bg-card dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg text-center">
â”‚   â”‚   â”‚             <i class="fas fa-bell-slash fa-3x text-gray-400 dark:text-gray-500 mb-4"></i>
â”‚   â”‚   â”‚             <p class="text-gray-600 dark:text-gray-400">No tienes notificaciones en este momento.</p>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (notificaciones_page.html) ---

â”‚   â”‚   â”œâ”€â”€ perfil.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (perfil.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Mi Perfil{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Mi Perfil{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚         <h2 class="text-xl font-semibold text-main-primary mb-4">Mi Perfil</h2>
â”‚   â”‚   â”‚         <p class="text-default">AquÃ­ irÃ¡ la informaciÃ³n y configuraciÃ³n del perfil del usuario.</p>
â”‚   â”‚   â”‚         {% if user.is_authenticated %}
â”‚   â”‚   â”‚         <p class="text-default">Nombre: {{ user.get_full_name|default:user.username }}</p>
â”‚   â”‚   â”‚         <p class="text-default">Email: {{ user.email }}</p>
â”‚   â”‚   â”‚         {% else %}
â”‚   â”‚   â”‚         <p class="text-default">Inicia sesiÃ³n para ver tu perfil.</p>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (perfil.html) ---

â”‚   â”‚   â”œâ”€â”€ reservas.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (reservas.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Reserva de Recursos{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Reserva de Recursos{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="content-section">
â”‚   â”‚   â”‚         <h2 class="text-xl md:text-2xl font-semibold text-main-primary mb-6">Reserva de Recursos</h2>
â”‚   â”‚   â”‚         <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚             <p class="text-muted mb-4">Consulte la disponibilidad y reserve salas de reuniones, equipos y otros recursos compartidos.</p>
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md p-8 text-center">
â”‚   â”‚   â”‚                 <i class="fas fa-calendar-check fa-3x text-gray-400 mb-4"></i>
â”‚   â”‚   â”‚                 <p class="text-muted">Interfaz de calendario de reservas (similar a la de actividades, pero para recursos) y listado de recursos disponibles aparecerÃ¡ aquÃ­.</p>
â”‚   â”‚   â”‚                 <p class="text-sm text-muted mt-2">NecesitarÃ¡ modelos para recursos, tipos de recursos, y reservas, ademÃ¡s de una librerÃ­a JS para el calendario.</p>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
â”‚   â”‚   â”‚                 <div>
â”‚   â”‚   â”‚                     <h3 class="text-lg font-semibold text-default mb-4">Recursos Disponibles</h3>
â”‚   â”‚   â”‚                     <ul class="space-y-2">
â”‚   â”‚   â”‚                         <li class="p-3 bg-gray-50 dark:bg-gray-700 rounded-md shadow-sm">
â”‚   â”‚   â”‚                             <span class="font-medium text-default">Sala de Reuniones A</span> - Capacidad: 10
â”‚   â”‚   â”‚                         </li>
â”‚   â”‚   â”‚                         <li class="p-3 bg-gray-50 dark:bg-gray-700 rounded-md shadow-sm">
â”‚   â”‚   â”‚                             <span class="font-medium text-default">Proyector Multimedia P-100</span> - Disponible
â”‚   â”‚   â”‚                         </li>
â”‚   â”‚   â”‚                         <li class="p-3 bg-gray-50 dark:bg-gray-700 rounded-md shadow-sm">
â”‚   â”‚   â”‚                             <span class="font-medium text-default">VehÃ­culo Institucional V-01</span> - En uso hasta 16/05
â”‚   â”‚   â”‚                         </li>
â”‚   â”‚   â”‚                     </ul>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚                 <div>
â”‚   â”‚   â”‚                     <h3 class="text-lg font-semibold text-default mb-4">Realizar una Reserva</h3>
â”‚   â”‚   â”‚                     <form class="space-y-4">
â”‚   â”‚   â”‚                         <div>
â”‚   â”‚   â”‚                             <label for="recurso" class="block text-sm font-medium text-muted">Recurso</label>
â”‚   â”‚   â”‚                             <select id="recurso" name="recurso" class="mt-1 block w-full p-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-main-primary focus:border-main-primary">
â”‚   â”‚   â”‚                                 <option>Seleccione un recurso...</option>
â”‚   â”‚   â”‚                                 <option>Sala de Reuniones A</option>
â”‚   â”‚   â”‚                                 <option>Proyector Multimedia P-100</option>
â”‚   â”‚   â”‚                             </select>
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                         <div>
â”‚   â”‚   â”‚                             <label for="fecha_reserva" class="block text-sm font-medium text-muted">Fecha</label>
â”‚   â”‚   â”‚                             <input type="date" id="fecha_reserva" name="fecha_reserva" class="mt-1 block w-full p-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-main-primary focus:border-main-primary">
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                         <div>
â”‚   â”‚   â”‚                             <label for="hora_inicio" class="block text-sm font-medium text-muted">Hora Inicio</label>
â”‚   â”‚   â”‚                             <input type="time" id="hora_inicio" name="hora_inicio" class="mt-1 block w-full p-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-main-primary focus:border-main-primary">
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                         <div>
â”‚   â”‚   â”‚                             <label for="hora_fin" class="block text-sm font-medium text-muted">Hora Fin</label>
â”‚   â”‚   â”‚                             <input type="time" id="hora_fin" name="hora_fin" class="mt-1 block w-full p-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-main-primary focus:border-main-primary">
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                         <div class="flex justify-end">
â”‚   â”‚   â”‚                             <button type="submit" class="bg-main-primary hover:bg-main-primary-dark text-main-white font-medium py-2 px-4 rounded-md">
â”‚   â”‚   â”‚                                 Solicitar Reserva
â”‚   â”‚   â”‚                             </button>
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                     </form>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (reservas.html) ---

â”‚   â”‚   â”œâ”€â”€ responsabilidades.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (responsabilidades.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}GestiÃ³n de Responsabilidades{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}GestiÃ³n de Responsabilidades{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="content-section">
â”‚   â”‚   â”‚         <div class="flex justify-between items-center mb-6">
â”‚   â”‚   â”‚             <h2 class="text-xl md:text-2xl font-semibold text-main-primary">GestiÃ³n de Responsabilidades</h2>
â”‚   â”‚   â”‚             <button class="bg-main-secondary hover:bg-main-secondary-dark text-main-white font-medium py-2 px-4 rounded-md flex items-center">
â”‚   â”‚   â”‚                 <i class="fas fa-plus mr-2"></i> Nueva Responsabilidad
â”‚   â”‚   â”‚             </button>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚          <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚             <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md p-8 text-center">
â”‚   â”‚   â”‚                 <i class="fas fa-sitemap fa-3x text-gray-400 mb-4"></i>
â”‚   â”‚   â”‚                 <p class="text-muted py-8">Interfaz para asignar, transferir y seguir responsabilidades (organigramas, listas de tareas asignadas, etc.) aparecerÃ¡ aquÃ­.</p>
â”‚   â”‚   â”‚                 <p class="text-sm text-muted mt-2">Esto implicarÃ­a modelos de datos para usuarios, tareas, roles y flujos de trabajo.</p>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             <div class="mt-8">
â”‚   â”‚   â”‚                 <h3 class="text-lg font-semibold text-default mb-4">Responsabilidades Asignadas</h3>
â”‚   â”‚   â”‚                 <div class="overflow-x-auto">
â”‚   â”‚   â”‚                     <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                         <thead class="bg-gray-50 dark:bg-gray-700">
â”‚   â”‚   â”‚                             <tr>
â”‚   â”‚   â”‚                                 <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Tarea</th>
â”‚   â”‚   â”‚                                 <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Asignado a</th>
â”‚   â”‚   â”‚                                 <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Fecha LÃ­mite</th>
â”‚   â”‚   â”‚                                 <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Estado</th>
â”‚   â”‚   â”‚                                 <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Acciones</th>
â”‚   â”‚   â”‚                             </tr>
â”‚   â”‚   â”‚                         </thead>
â”‚   â”‚   â”‚                         <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                             <tr>
â”‚   â”‚   â”‚                                 <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-default">Elaborar informe trimestral</td>
â”‚   â”‚   â”‚                                 <td class="px-4 py-2 text-sm text-muted">Ana PÃ©rez</td>
â”‚   â”‚   â”‚                                 <td class="px-4 py-2 text-sm text-muted">30/06/2025</td>
â”‚   â”‚   â”‚                                 <td class="px-4 py-2"><span class="px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">En Progreso</span></td>
â”‚   â”‚   â”‚                                 <td class="px-4 py-2 whitespace-nowrap text-sm space-x-2">
â”‚   â”‚   â”‚                                     <button class="text-main-primary hover:underline" title="Ver Detalles"><i class="fas fa-eye"></i></button>
â”‚   â”‚   â”‚                                     <button class="text-red-500 hover:underline" title="Reasignar"><i class="fas fa-random"></i></button>
â”‚   â”‚   â”‚                                 </td>
â”‚   â”‚   â”‚                             </tr>
â”‚   â”‚   â”‚                             <tr>
â”‚   â”‚   â”‚                                 <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-default">Actualizar documentaciÃ³n API</td>
â”‚   â”‚   â”‚                                 <td class="px-4 py-2 text-sm text-muted">Carlos LÃ³pez</td>
â”‚   â”‚   â”‚                                 <td class="px-4 py-2 text-sm text-muted">15/07/2025</td>
â”‚   â”‚   â”‚                                 <td class="px-4 py-2"><span class="px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Completada</span></td>
â”‚   â”‚   â”‚                                 <td class="px-4 py-2 whitespace-nowrap text-sm space-x-2">
â”‚   â”‚   â”‚                                     <button class="text-main-primary hover:underline" title="Ver Detalles"><i class="fas fa-eye"></i></button>
â”‚   â”‚   â”‚                                 </td>
â”‚   â”‚   â”‚                             </tr>
â”‚   â”‚   â”‚                         </tbody>
â”‚   â”‚   â”‚                     </table>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (responsabilidades.html) ---

â”‚   â”‚   â”œâ”€â”€ responsabilidades_lista.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (responsabilidades_lista.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}GestiÃ³n de Responsabilidades{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}{{ page_title_for_header|default:"GestiÃ³n de Responsabilidades" }}{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="bg-card dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚         <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
â”‚   â”‚   â”‚             <h2 class="text-2xl font-semibold text-main-primary dark:text-blue-400">{{ page_title_for_header|default:"GestiÃ³n de Responsabilidades" }}</h2>
â”‚   â”‚   â”‚             <a href="{% url 'intranet_core:tarea_crear' %}" class="btn-primary text-sm">
â”‚   â”‚   â”‚                 <i class="fas fa-plus mr-2"></i> Nueva Tarea
â”‚   â”‚   â”‚             </a>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         {% if messages %}
â”‚   â”‚   â”‚             <div class="mb-6 space-y-3">
â”‚   â”‚   â”‚             {% for message in messages %}
â”‚   â”‚   â”‚                 <div class="p-4 rounded-md text-sm {% if message.tags == 'success' %}bg-green-100 border border-green-300 text-green-700 dark:bg-green-800 dark:border-green-600 dark:text-green-200{% elif message.tags == 'error' %}bg-red-100 border border-red-300 text-red-700 dark:bg-red-800 dark:border-red-600 dark:text-red-200{% else %}bg-blue-100 border border-blue-300 text-blue-700 dark:bg-blue-800 dark:border-blue-600 dark:text-blue-200{% endif %}" role="alert">
â”‚   â”‚   â”‚                     <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} mr-2"></i>
â”‚   â”‚   â”‚                     {{ message }}
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             {% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         <div class="mb-6">
â”‚   â”‚   â”‚             <div class="flex space-x-2 border-b border-gray-200 dark:border-gray-700 pb-3 mb-3">
â”‚   â”‚   â”‚                 <a href="?filter=mis_tareas" class="px-3 py-2 rounded-md text-sm font-medium {% if current_filter == 'mis_tareas' %}bg-main-primary text-white{% else %}text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}">Mis Tareas</a>
â”‚   â”‚   â”‚                 <a href="?filter=creadas_por_mi" class="px-3 py-2 rounded-md text-sm font-medium {% if current_filter == 'creadas_por_mi' %}bg-main-primary text-white{% else %}text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}">Creadas por MÃ­</a>
â”‚   â”‚   â”‚                 {% if user.is_staff %}
â”‚   â”‚   â”‚                 <a href="?filter=todas" class="px-3 py-2 rounded-md text-sm font-medium {% if current_filter == 'todas' %}bg-main-primary text-white{% else %}text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}">Todas</a>
â”‚   â”‚   â”‚                 {% endif %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         <div class="mb-8">
â”‚   â”‚   â”‚             <h3 class="text-lg font-semibold text-default dark:text-gray-100 mb-4">Tareas Pendientes/En Progreso</h3>
â”‚   â”‚   â”‚             {% if tareas_pendientes %}
â”‚   â”‚   â”‚             <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700">
â”‚   â”‚   â”‚                 <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                     <thead class="bg-gray-50 dark:bg-gray-750">
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">TÃ­tulo</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Asignado a</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Fecha LÃ­mite</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Prioridad</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Estado</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Acciones</th>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                     </thead>
â”‚   â”‚   â”‚                     <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                         {% for tarea in tareas_pendientes %}
â”‚   â”‚   â”‚                         <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-100">
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">
â”‚   â”‚   â”‚                                 <a href="{% url 'intranet_core:tarea_detalle' tarea.id %}" class="text-main-primary hover:underline">{{ tarea.titulo|truncatechars:50 }}</a>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300">{{ tarea.asignado_a.get_full_name|default:tarea.asignado_a.username|default:"Sin asignar" }}</td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300">{{ tarea.fecha_limite|date:"d/m/Y"|default:"N/A" }}</td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm">
â”‚   â”‚   â”‚                                 <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
â”‚   â”‚   â”‚                                     {% if tarea.prioridad == tarea.PrioridadTarea.ALTA or tarea.prioridad == tarea.PrioridadTarea.URGENTE %} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 
â”‚   â”‚   â”‚                                     {% elif tarea.prioridad == tarea.PrioridadTarea.MEDIA %} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200
â”‚   â”‚   â”‚                                     {% else %} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 {% endif %}">
â”‚   â”‚   â”‚                                     {{ tarea.get_prioridad_display }}
â”‚   â”‚   â”‚                                 </span>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm">
â”‚   â”‚   â”‚                                 <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
â”‚   â”‚   â”‚                                     {% if tarea.estado == tarea.EstadoTarea.EN_PROGRESO %} bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200
â”‚   â”‚   â”‚                                     {% else %} bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200 {% endif %}">
â”‚   â”‚   â”‚                                     {{ tarea.get_estado_display }}
â”‚   â”‚   â”‚                                 </span>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
â”‚   â”‚   â”‚                                 <div class="flex justify-center items-center space-x-3">
â”‚   â”‚   â”‚                                     <a href="{% url 'intranet_core:tarea_detalle' tarea.id %}" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300" title="Ver Detalles"><i class="fas fa-eye fa-fw"></i></a>
â”‚   â”‚   â”‚                                     {% if user == tarea.creado_por or user.is_staff or user == tarea.asignado_a %}
â”‚   â”‚   â”‚                                     <a href="{% url 'intranet_core:tarea_editar' tarea.id %}" class="text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300" title="Editar"><i class="fas fa-edit fa-fw"></i></a>
â”‚   â”‚   â”‚                                     {% endif %}
â”‚   â”‚   â”‚                                 </div>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                         {% endfor %}
â”‚   â”‚   â”‚                     </tbody>
â”‚   â”‚   â”‚                 </table>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             {% else %}
â”‚   â”‚   â”‚             <div class="text-center py-6">
â”‚   â”‚   â”‚                 <i class="fas fa-check-circle fa-3x text-green-500 mb-3"></i>
â”‚   â”‚   â”‚                 <p class="text-muted">No tienes tareas pendientes o en progreso.</p>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             {% endif %}
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         <div class="mt-8">
â”‚   â”‚   â”‚             <h3 class="text-lg font-semibold text-default dark:text-gray-100 mb-4">Tareas Completadas (Ãšltimas 20)</h3>
â”‚   â”‚   â”‚             {% if tareas_completadas %}
â”‚   â”‚   â”‚             <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700">
â”‚   â”‚   â”‚                 <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                      <thead class="bg-gray-50 dark:bg-gray-750">
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">TÃ­tulo</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Asignado a</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Fecha LÃ­mite</th>
â”‚   â”‚   â”‚                             <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Prioridad</th>
â”‚   â”‚   â”‚                              <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Acciones</th>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                     </thead>
â”‚   â”‚   â”‚                     <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                         {% for tarea in tareas_completadas %}
â”‚   â”‚   â”‚                          <tr class="opacity-70 hover:opacity-100 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-100">
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-700 dark:text-gray-300">
â”‚   â”‚   â”‚                                 <a href="{% url 'intranet_core:tarea_detalle' tarea.id %}" class="hover:underline">{{ tarea.titulo|truncatechars:50 }}</a>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ tarea.asignado_a.get_full_name|default:tarea.asignado_a.username|default:"Sin asignar" }}</td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ tarea.fecha_limite|date:"d/m/Y"|default:"N/A" }}</td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"> {{ tarea.get_prioridad_display }}</td>
â”‚   â”‚   â”‚                             <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
â”‚   â”‚   â”‚                                 <a href="{% url 'intranet_core:tarea_detalle' tarea.id %}" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300" title="Ver Detalles"><i class="fas fa-eye fa-fw"></i></a>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                         {% endfor %}
â”‚   â”‚   â”‚                     </tbody>
â”‚   â”‚   â”‚                 </table>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             {% else %}
â”‚   â”‚   â”‚             <p class="text-muted text-center py-6">No hay tareas completadas recientemente.</p>
â”‚   â”‚   â”‚             {% endif %}
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (responsabilidades_lista.html) ---

â”‚   â”‚   â”œâ”€â”€ usuarios_gestion.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (usuarios_gestion.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}GestiÃ³n de Usuarios{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}GestiÃ³n de Usuarios{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="content-section">
â”‚   â”‚   â”‚         <div class="flex justify-between items-center mb-6">
â”‚   â”‚   â”‚             <h2 class="text-xl md:text-2xl font-semibold text-main-primary">GestiÃ³n de Usuarios</h2>
â”‚   â”‚   â”‚             <button class="bg-main-secondary hover:bg-main-secondary-dark text-main-white font-medium py-2 px-4 rounded-md flex items-center">
â”‚   â”‚   â”‚                 <i class="fas fa-user-plus mr-2"></i> Nuevo Usuario
â”‚   â”‚   â”‚             </button>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚          <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚             <p class="text-muted mb-6">Panel para administradores: crear, editar, activar/desactivar cuentas de usuarios y asignar roles/permisos.</p>
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md p-8 text-center">
â”‚   â”‚   â”‚                 <i class="fas fa-users-cog fa-3x text-gray-400 mb-4"></i>
â”‚   â”‚   â”‚                 <p class="text-muted">Una tabla interactiva con todos los usuarios, filtros, paginaciÃ³n y acciones (editar, desactivar, cambiar rol) aparecerÃ¡ aquÃ­.</p>
â”‚   â”‚   â”‚                 <p class="text-sm text-muted mt-2">Esto se conectarÃ­a directamente con el modelo de Usuario de Django y posiblemente un modelo de Perfil.</p>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div class="mt-8 overflow-x-auto">
â”‚   â”‚   â”‚                 <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                     <thead class="bg-gray-50 dark:bg-gray-700">
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Nombre</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Email</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Rol</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Estado</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Acciones</th>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                     </thead>
â”‚   â”‚   â”‚                     <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-default">Admin Intranet</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 text-sm text-muted">admin@example.com</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 text-sm text-muted">Administrador</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2"><span class="px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Activo</span></td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 whitespace-nowrap text-sm space-x-2">
â”‚   â”‚   â”‚                                 <button class="text-main-primary hover:underline" title="Editar"><i class="fas fa-edit"></i></button>
â”‚   â”‚   â”‚                                 <button class="text-red-500 hover:underline" title="Desactivar"><i class="fas fa-user-slash"></i></button>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-default">Usuario Ejemplo</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 text-sm text-muted">usuario@example.com</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 text-sm text-muted">Empleado</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2"><span class="px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">Inactivo</span></td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 whitespace-nowrap text-sm space-x-2">
â”‚   â”‚   â”‚                                 <button class="text-main-primary hover:underline" title="Editar"><i class="fas fa-edit"></i></button>
â”‚   â”‚   â”‚                                 <button class="text-green-500 hover:underline" title="Activar"><i class="fas fa-user-check"></i></button>
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                     </tbody>
â”‚   â”‚   â”‚                 </table>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (usuarios_gestion.html) ---

â”‚   â”‚   â”œâ”€â”€ usuarios_gestion_lista.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (usuarios_gestion_lista.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}GestiÃ³n de Usuarios{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}GestiÃ³n de Usuarios{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚         <div class="flex justify-between items-center mb-6">
â”‚   â”‚   â”‚             <h2 class="text-xl md:text-2xl font-semibold text-main-primary">Listado de Usuarios</h2>
â”‚   â”‚   â”‚             {# <a href="#" class="bg-main-secondary hover:bg-main-secondary-dark text-main-white font-medium py-2 px-4 rounded-md flex items-center">
â”‚   â”‚   â”‚                 <i class="fas fa-user-plus mr-2"></i> Nuevo Usuario
â”‚   â”‚   â”‚             </a> #}
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         {% if usuarios %}
â”‚   â”‚   â”‚             <div class="overflow-x-auto">
â”‚   â”‚   â”‚                 <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                     <thead class="bg-gray-50 dark:bg-gray-700">
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Username</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Nombre Completo</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Email</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Staff</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Activo</th>
â”‚   â”‚   â”‚                             <th class="px-4 py-2 text-left text-xs font-medium text-muted uppercase">Acciones</th>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                     </thead>
â”‚   â”‚   â”‚                     <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
â”‚   â”‚   â”‚                         {% for u in usuarios %}
â”‚   â”‚   â”‚                         <tr>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-default">{{ u.username }}</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 text-sm text-muted">{{ u.get_full_name|default:"N/A" }}</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 text-sm text-muted">{{ u.email }}</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 text-sm text-muted">{% if u.is_staff %}SÃ­{% else %}No{% endif %}</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 text-sm text-muted">{% if u.is_active %}SÃ­{% else %}No{% endif %}</td>
â”‚   â”‚   â”‚                             <td class="px-4 py-2 whitespace-nowrap text-sm space-x-2">
â”‚   â”‚   â”‚                                 <a href="{% url 'intranet_core:usuario_gestion_editar' u.id %}" class="text-main-primary hover:underline" title="Editar"><i class="fas fa-edit"></i></a>
â”‚   â”‚   â”‚                                 {# MÃ¡s acciones aquÃ­ #}
â”‚   â”‚   â”‚                             </td>
â”‚   â”‚   â”‚                         </tr>
â”‚   â”‚   â”‚                         {% endfor %}
â”‚   â”‚   â”‚                     </tbody>
â”‚   â”‚   â”‚                 </table>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         {% else %}
â”‚   â”‚   â”‚             <p class="text-muted">No hay usuarios para mostrar.</p>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (usuarios_gestion_lista.html) ---

â”‚   â”‚   â”œâ”€â”€ wiki.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (wiki.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Base de Conocimiento{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Base de Conocimiento (Wiki){% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="content-section">
â”‚   â”‚   â”‚         <h2 class="text-xl md:text-2xl font-semibold text-main-primary mb-6">Base de Conocimiento (Wiki)</h2>
â”‚   â”‚   â”‚         <div class="bg-card p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚             <p class="text-muted mb-4">Encuentre manuales, guÃ­as, procedimientos y preguntas frecuentes de la instituciÃ³n.</p>
â”‚   â”‚   â”‚             <div class="mb-6">
â”‚   â”‚   â”‚                 <input type="text" placeholder="Buscar en la base de conocimiento..." class="w-full p-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-main-primary focus:border-transparent">
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md p-8 text-center">
â”‚   â”‚   â”‚                 <i class="fas fa-book-open fa-3x text-gray-400 mb-4"></i>
â”‚   â”‚   â”‚                 <p class="text-muted">ArtÃ­culos y categorÃ­as de la wiki (con editor de texto enriquecido para crear/editar artÃ­culos) aparecerÃ¡n aquÃ­.</p>
â”‚   â”‚   â”‚                 <p class="text-sm text-muted mt-2">Una wiki funcional requiere modelos para artÃ­culos, categorÃ­as, versiones, y un buen editor WYSIWYG.</p>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
â”‚   â”‚   â”‚                 <div>
â”‚   â”‚   â”‚                     <h3 class="text-lg font-semibold text-default mb-3">CategorÃ­as Populares</h3>
â”‚   â”‚   â”‚                     <ul class="space-y-2">
â”‚   â”‚   â”‚                         <li><a href="#" class="text-main-primary hover:underline">Procedimientos Internos</a></li>
â”‚   â”‚   â”‚                         <li><a href="#" class="text-main-primary hover:underline">GuÃ­as de Software</a></li>
â”‚   â”‚   â”‚                         <li><a href="#" class="text-main-primary hover:underline">Recursos Humanos</a></li>
â”‚   â”‚   â”‚                         <li><a href="#" class="text-main-primary hover:underline">Preguntas Frecuentes TI</a></li>
â”‚   â”‚   â”‚                     </ul>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚                 <div class="md:col-span-2">
â”‚   â”‚   â”‚                     <h3 class="text-lg font-semibold text-default mb-3">ArtÃ­culos Recientes</h3>
â”‚   â”‚   â”‚                     <div class="space-y-4">
â”‚   â”‚   â”‚                         <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-md shadow-sm">
â”‚   â”‚   â”‚                             <a href="#" class="font-medium text-default hover:text-main-primary block">CÃ³mo solicitar vacaciones</a>
â”‚   â”‚   â”‚                             <p class="text-xs text-muted mt-1">Actualizado el 10/05/2025 por Admin</p>
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                         <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-md shadow-sm">
â”‚   â”‚   â”‚                             <a href="#" class="font-medium text-default hover:text-main-primary block">GuÃ­a de uso del nuevo CRM</a>
â”‚   â”‚   â”‚                             <p class="text-xs text-muted mt-1">Actualizado el 05/05/2025 por Soporte TI</p>
â”‚   â”‚   â”‚                         </div>
â”‚   â”‚   â”‚                     </div>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (wiki.html) ---

â”‚   â”‚   â”œâ”€â”€ wiki_articulo_confirm_delete.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (wiki_articulo_confirm_delete.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}Confirmar EliminaciÃ³n - {{ articulo.titulo }}{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}Confirmar EliminaciÃ³n de ArtÃ­culo{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="bg-card dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg max-w-lg mx-auto text-center">
â”‚   â”‚   â”‚         <i class="fas fa-exclamation-triangle fa-3x text-red-500 mb-4"></i>
â”‚   â”‚   â”‚         <h2 class="text-xl font-semibold text-default dark:text-gray-100 mb-2">
â”‚   â”‚   â”‚             Â¿EstÃ¡s seguro de que quieres eliminar el artÃ­culo?
â”‚   â”‚   â”‚         </h2>
â”‚   â”‚   â”‚         <p class="text-lg text-main-primary dark:text-blue-400 mb-6">"{{ articulo.titulo }}"</p>
â”‚   â”‚   â”‚         
â”‚   â”‚   â”‚         <p class="text-gray-600 dark:text-gray-400 mb-6">Esta acciÃ³n no se puede deshacer.</p>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         <form method="POST">
â”‚   â”‚   â”‚             {% csrf_token %}
â”‚   â”‚   â”‚             <div class="flex justify-center space-x-4">
â”‚   â”‚   â”‚                 <a href="{{ articulo.get_absolute_url }}" class="px-6 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">
â”‚   â”‚   â”‚                     Cancelar
â”‚   â”‚   â”‚                 </a>
â”‚   â”‚   â”‚                 <button type="submit" class="px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
â”‚   â”‚   â”‚                     SÃ­, Eliminar
â”‚   â”‚   â”‚                 </button>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </form>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (wiki_articulo_confirm_delete.html) ---

â”‚   â”‚   â”œâ”€â”€ wiki_articulo_detalle.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (wiki_articulo_detalle.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}{{ articulo.titulo }} - Wiki{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}{{ articulo.titulo }}{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="bg-card dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚   â”‚         <div class="prose dark:prose-invert max-w-none">
â”‚   â”‚   â”‚             {# El contenido se renderiza como HTML si usaste la librerÃ­a markdown en la vista #}
â”‚   â”‚   â”‚             {# Si no, ajusta para mostrar articulo.contenido directamente o como <pre> #}
â”‚   â”‚   â”‚             {{ html_content|safe }}
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 text-sm text-gray-600 dark:text-gray-400">
â”‚   â”‚   â”‚             <p>Autor: {{ articulo.autor.get_full_name|default:articulo.autor.username|default:"Desconocido" }}</p>
â”‚   â”‚   â”‚             <p>Ãšltima actualizaciÃ³n: {{ articulo.actualizado_el|date:"d M Y, H:i" }} (Creado: {{ articulo.creado_el|date:"d M Y, H:i" }})</p>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚         {# Solo mostrar botones de editar/eliminar al autor o staff #}
â”‚   â”‚   â”‚         {% if user == articulo.autor or user.is_staff %}
â”‚   â”‚   â”‚         <div class="mt-8 flex space-x-4">
â”‚   â”‚   â”‚             <a href="{% url 'intranet_core:wiki_editar_articulo' slug=articulo.slug %}" class="bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-md text-sm flex items-center">
â”‚   â”‚   â”‚                 <i class="fas fa-edit mr-2"></i> Editar ArtÃ­culo
â”‚   â”‚   â”‚             </a>
â”‚   â”‚   â”‚             <a href="{% url 'intranet_core:wiki_eliminar_articulo' slug=articulo.slug %}" class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md text-sm flex items-center">
â”‚   â”‚   â”‚                 <i class="fas fa-trash-alt mr-2"></i> Eliminar ArtÃ­culo
â”‚   â”‚   â”‚             </a>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚         {% endif %}
â”‚   â”‚   â”‚         
â”‚   â”‚   â”‚         <div class="mt-8">
â”‚   â”‚   â”‚             <a href="{% url 'intranet_core:wiki' %}" class="text-main-primary hover:underline dark:text-blue-400">&larr; Volver a la lista de la Wiki</a>
â”‚   â”‚   â”‚         </div>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block extra_css %}
â”‚   â”‚   â”‚     {# Si usas codehilite de Markdown para sintaxis de cÃ³digo #}
â”‚   â”‚   â”‚     <link rel="stylesheet" href="{% static 'css/code_highlight_styles.css' %}"> {# NecesitarÃ¡s crear este CSS si quieres estilos personalizados #}
â”‚   â”‚   â”‚     <style>
â”‚   â”‚   â”‚     /* Estilos bÃ¡sicos para prose si no usas el plugin de Tailwind Typography */
â”‚   â”‚   â”‚     .prose h1 { font-size: 2em; margin-bottom: 0.5em; margin-top: 1em; font-weight: 600; }
â”‚   â”‚   â”‚     .prose h2 { font-size: 1.5em; margin-bottom: 0.4em; margin-top: 1em; font-weight: 600; }
â”‚   â”‚   â”‚     .prose h3 { font-size: 1.25em; margin-bottom: 0.3em; margin-top: 1em; font-weight: 600; }
â”‚   â”‚   â”‚     .prose p { margin-bottom: 1em; line-height: 1.6; }
â”‚   â”‚   â”‚     .prose ul, .prose ol { margin-bottom: 1em; margin-left: 1.5em; }
â”‚   â”‚   â”‚     .prose li { margin-bottom: 0.5em; }
â”‚   â”‚   â”‚     .prose pre { background-color: #f5f5f5; padding: 1em; border-radius: 0.375rem; overflow-x: auto; margin-bottom: 1em;}
â”‚   â”‚   â”‚     .prose code { font-family: monospace; }
â”‚   â”‚   â”‚     .prose a { color: var(--main-primary-text, #0033A0); text-decoration: underline; }
â”‚   â”‚   â”‚     .prose img { max-width: 100%; height: auto; border-radius: 0.375rem; margin-bottom: 1em;}
â”‚   â”‚   â”‚     .prose table { width: 100%; border-collapse: collapse; margin-bottom: 1em; }
â”‚   â”‚   â”‚     .prose th, .prose td { border: 1px solid #ddd; padding: 0.5em; text-align: left; }
â”‚   â”‚   â”‚     .prose th { background-color: #f9f9f9; }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     .dark .prose-invert h1, .dark .prose-invert h2, .dark .prose-invert h3 { color: #e5e7eb; }
â”‚   â”‚   â”‚     .dark .prose-invert p, .dark .prose-invert li { color: #d1d5db; }
â”‚   â”‚   â”‚     .dark .prose-invert pre { background-color: #374151; color: #e5e7eb;}
â”‚   â”‚   â”‚     .dark .prose-invert a { color: var(--main-primary-text-dark, #7dd3fc); } /* Ajustar color para modo oscuro */
â”‚   â”‚   â”‚     .dark .prose-invert th, .dark .prose-invert td { border-color: #4b5563; }
â”‚   â”‚   â”‚     .dark .prose-invert th { background-color: #374151; }
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     /* Para la extensiÃ³n codehilite de Markdown (si la usas) */
â”‚   â”‚   â”‚     .codehilite pre { padding: 1em; border-radius: 4px; overflow: auto; }
â”‚   â”‚   â”‚     /* MÃ¡s estilos para codehilite se pueden aÃ±adir o referenciar de un archivo CSS de Pygments */
â”‚   â”‚   â”‚     </style>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (wiki_articulo_detalle.html) ---

â”‚   â”‚   â”œâ”€â”€ wiki_articulo_form.html
â”‚   â”‚   â”‚   ðŸ“„ CONTENIDO DEL ARCHIVO (wiki_articulo_form.html):
â”‚   â”‚   â”‚     {% extends "base.html" %}
â”‚   â”‚   â”‚     {% load static %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block title_tag %}{% if edit_mode %}Editar ArtÃ­culo{% else %}Crear ArtÃ­culo{% endif %} - Wiki{% endblock %}
â”‚   â”‚   â”‚     {% block page_title_header %}{% if edit_mode %}Editar ArtÃ­culo: {{ articulo.titulo }}{% else %}Crear Nuevo ArtÃ­culo en la Wiki{% endif %}{% endblock %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚     {% block content %}
â”‚   â”‚   â”‚     <div class="bg-card dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg max-w-3xl mx-auto">
â”‚   â”‚   â”‚         <form method="POST" class="space-y-6">
â”‚   â”‚   â”‚             {% csrf_token %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             {% if form.non_field_errors %}
â”‚   â”‚   â”‚                 <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 dark:bg-red-800 dark:border-red-600 dark:text-red-200" role="alert">
â”‚   â”‚   â”‚                     <p class="font-bold">Error general:</p>
â”‚   â”‚   â”‚                     <ul class="mt-1 list-disc list-inside text-sm">
â”‚   â”‚   â”‚                     {% for error in form.non_field_errors %}
â”‚   â”‚   â”‚                         <li>{{ error }}</li>
â”‚   â”‚   â”‚                     {% endfor %}
â”‚   â”‚   â”‚                     </ul>
â”‚   â”‚   â”‚                 </div>
â”‚   â”‚   â”‚             {% endif %}
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             {# TÃ­tulo #}
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form.titulo.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form.titulo.label }}</label>
â”‚   â”‚   â”‚                 {{ form.titulo }}
â”‚   â”‚   â”‚                 {% if form.titulo.help_text %}<p class="mt-2 text-xs text-gray-500 dark:text-gray-400">{{ form.titulo.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                 {% for error in form.titulo.errors %}<p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             {# Contenido #}
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form.contenido.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form.contenido.label }}</label>
â”‚   â”‚   â”‚                 {{ form.contenido }}
â”‚   â”‚   â”‚                 {% if form.contenido.help_text %}<p class="mt-2 text-xs text-gray-500 dark:text-gray-400">{{ form.contenido.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                 {% for error in form.contenido.errors %}<p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚             
â”‚   â”‚   â”‚             {# Slug (generalmente oculto o solo para usuarios avanzados) #}
â”‚   â”‚   â”‚             <div>
â”‚   â”‚   â”‚                 <label for="{{ form.slug.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ form.slug.label }}</label>
â”‚   â”‚   â”‚                 {{ form.slug }}
â”‚   â”‚   â”‚                 {% if form.slug.help_text %}<p class="mt-2 text-xs text-gray-500 dark:text-gray-400">{{ form.slug.help_text }}</p>{% endif %}
â”‚   â”‚   â”‚                 {% for error in form.slug.errors %}<p class="mt-1 text-xs text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}</p>{% endfor %}
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚     
â”‚   â”‚   â”‚             <div class="pt-4 flex items-center space-x-4">
â”‚   â”‚   â”‚                 <button type="submit" class="bg-main-primary hover:bg-main-primary-dark text-main-white font-semibold py-2 px-5 rounded-md text-sm">
â”‚   â”‚   â”‚                     <i class="fas {% if edit_mode %}fa-save{% else %}fa-plus-circle{% endif %} mr-2"></i> 
â”‚   â”‚   â”‚                     {% if edit_mode %}Guardar Cambios{% else %}Crear ArtÃ­culo{% endif %}
â”‚   â”‚   â”‚                 </button>
â”‚   â”‚   â”‚                 <a href="{% if edit_mode %}{{ articulo.get_absolute_url }}{% else %}{% url 'intranet_core:wiki' %}{% endif %}" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100 text-sm">
â”‚   â”‚   â”‚                     Cancelar
â”‚   â”‚   â”‚                 </a>
â”‚   â”‚   â”‚             </div>
â”‚   â”‚   â”‚         </form>
â”‚   â”‚   â”‚     </div>
â”‚   â”‚   â”‚     {% endblock %}
â”‚   â”‚   â”‚   --- FIN CONTENIDO (wiki_articulo_form.html) ---

â”‚   â”‚   â””â”€â”€ wiki_lista.html
â”‚   â”‚       ðŸ“„ CONTENIDO DEL ARCHIVO (wiki_lista.html):
â”‚   â”‚         {% extends "base.html" %}
â”‚   â”‚         {% load static %}
â”‚   â”‚         
â”‚   â”‚         {% block title_tag %}Wiki - Base de Conocimiento{% endblock %}
â”‚   â”‚         {% block page_title_header %}Base de Conocimiento (Wiki){% endblock %}
â”‚   â”‚         
â”‚   â”‚         {% block content %}
â”‚   â”‚         <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
â”‚   â”‚             <form method="GET" action="{% url 'intranet_core:wiki' %}" class="flex-grow md:mr-4">
â”‚   â”‚                 <div class="relative">
â”‚   â”‚                     <input type="search" name="q" value="{{ search_query|default:'' }}" placeholder="Buscar artÃ­culos en la Wiki..." class="w-full p-3 pl-10 text-sm text-gray-700 bg-gray-100 dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-main-primary focus:border-main-primary">
â”‚   â”‚                     <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
â”‚   â”‚                         <i class="fas fa-search text-gray-400"></i>
â”‚   â”‚                     </div>
â”‚   â”‚                 </div>
â”‚   â”‚             </form>
â”‚   â”‚             <a href="{% url 'intranet_core:wiki_crear_articulo' %}" class="bg-main-primary hover:bg-main-primary-dark text-main-white font-medium py-2.5 px-5 rounded-md flex items-center text-sm whitespace-nowrap">
â”‚   â”‚                 <i class="fas fa-plus mr-2"></i> Crear ArtÃ­culo
â”‚   â”‚             </a>
â”‚   â”‚         </div>
â”‚   â”‚         
â”‚   â”‚         <div class="bg-card dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg">
â”‚   â”‚             {% if articulos %}
â”‚   â”‚                 <ul class="space-y-4">
â”‚   â”‚                     {% for articulo in articulos %}
â”‚   â”‚                     <li class="border-b border-gray-200 dark:border-gray-700 pb-4 last:border-b-0 last:pb-0">
â”‚   â”‚                         <a href="{{ articulo.get_absolute_url }}" class="text-lg font-semibold text-main-primary hover:underline dark:text-blue-400 dark:hover:text-blue-300">
â”‚   â”‚                             {{ articulo.titulo }}
â”‚   â”‚                         </a>
â”‚   â”‚                         <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
â”‚   â”‚                             Autor: {{ articulo.autor.get_full_name|default:articulo.autor.username|default:"Desconocido" }} | Actualizado: {{ articulo.actualizado_el|date:"d M Y, H:i" }}
â”‚   â”‚                         </p>
â”‚   â”‚                         <p class="text-sm text-gray-700 dark:text-gray-300 mt-2 line-clamp-2">
â”‚   â”‚                             {{ articulo.contenido|striptags|truncatewords:30 }}
â”‚   â”‚                         </p>
â”‚   â”‚                     </li>
â”‚   â”‚                     {% endfor %}
â”‚   â”‚                 </ul>
â”‚   â”‚             {% else %}
â”‚   â”‚                 {% if search_query %}
â”‚   â”‚                 <p class="text-center text-gray-600 dark:text-gray-400 py-8">No se encontraron artÃ­culos que coincidan con tu bÃºsqueda.</p>
â”‚   â”‚                 {% else %}
â”‚   â”‚                 <p class="text-center text-gray-600 dark:text-gray-400 py-8">AÃºn no hay artÃ­culos en la wiki. Â¡SÃ© el primero en <a href="{% url 'intranet_core:wiki_crear_articulo' %}" class="text-main-primary hover:underline">crear uno</a>!</p>
â”‚   â”‚                 {% endif %}
â”‚   â”‚             {% endif %}
â”‚   â”‚         </div>
â”‚   â”‚         {% endblock %}
â”‚   â”‚       --- FIN CONTENIDO (wiki_lista.html) ---


â”‚   â””â”€â”€ registration
â”‚       â””â”€â”€ login.html
â”‚           ðŸ“„ CONTENIDO DEL ARCHIVO (login.html):
â”‚             {# UbicaciÃ³n: /workspaces/intranet_gem/templates/registration/login.html #}
â”‚             {% extends "base.html" %}
â”‚             {% load static %}
â”‚             
â”‚             {% block title_tag %}Iniciar SesiÃ³n{% endblock %}
â”‚             
â”‚             {% block page_title_header %}Iniciar SesiÃ³n{% endblock %}
â”‚             
â”‚             {% block content %}
â”‚             <div class="flex justify-center items-center py-10">
â”‚                 <div class="bg-card p-8 rounded-xl shadow-lg w-full max-w-md">
â”‚                     <h2 class="text-2xl font-semibold text-main-primary text-center mb-6">Acceso a la Intranet</h2>
â”‚             
â”‚                     {% if form.errors %}
â”‚                         <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
â”‚                             <strong class="font-bold">Error:</strong>
â”‚                             <span class="block sm:inline">Tu nombre de usuario y contraseÃ±a no coinciden. Por favor, intÃ©ntalo de nuevo.</span>
â”‚                         </div>
â”‚                     {% endif %}
â”‚             
â”‚                     {% if next %}
â”‚                         {% if user.is_authenticated %}
â”‚                             <p class="text-center text-muted mb-4">Ya has iniciado sesiÃ³n como {{ user.username }}. Â¿Quieres acceder con otra cuenta?</p>
â”‚                         {% else %}
â”‚                             <p class="text-center text-muted mb-4">Por favor, inicia sesiÃ³n para ver esta pÃ¡gina.</p>
â”‚                         {% endif %}
â”‚                     {% endif %}
â”‚             
â”‚                     <form method="post" action="{% url 'login' %}" class="space-y-6">
â”‚                         {% csrf_token %}
â”‚             
â”‚                         <div>
â”‚                             <label for="id_username" class="block text-sm font-medium text-muted">Nombre de Usuario:</label>
â”‚                             <input type="text" name="username" autofocus autocapitalize="none" autocomplete="username" maxlength="150" required id="id_username" class="mt-1 block w-full p-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-main-primary focus:border-transparent">
â”‚                         </div>
â”‚             
â”‚                         <div>
â”‚                             <label for="id_password" class="block text-sm font-medium text-muted">ContraseÃ±a:</label>
â”‚                             <input type="password" name="password" autocomplete="current-password" required id="id_password" class="mt-1 block w-full p-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-main-primary focus:border-transparent">
â”‚                         </div>
â”‚             
â”‚                         <input type="hidden" name="next" value="{{ next|default:request.GET.next|default_if_none:'' }}">
â”‚                                      <div>
â”‚             <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm 1  font-medium text-main-white bg-main-primary hover:bg-main-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-main-primary">
â”‚             Iniciar SesiÃ³n
â”‚             </button>
â”‚             </div>
â”‚             </form>
â”‚             <p class="mt-4 text-center text-sm">
â”‚             <a href="#" class="font-medium text-main-primary hover:text-main-primary-dark">Â¿Olvidaste tu contraseÃ±a?</a>
â”‚             {# Puedes implementar la funcionalidad de reseteo de contraseÃ±a mÃ¡s adelante #}
â”‚             </p>
â”‚             </div>
â”‚             </div>
â”‚             {% endblock %} Â  
â”‚           --- FIN CONTENIDO (login.html) ---




============================================
Fin del listado.
